<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY APP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/3.3.2/jsencrypt.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #6C63FF;
            --primary-dark: #5A52D5;
            --accent: #FF6B8B;
            --success: #4CD964;
            --warning: #6699ff;
            --danger: #6699ff;
            --dark-1: #121212;
            --dark-2: #1E1E1E;
            --dark-3: #2D2D2D;
            --dark-4: #3A3A3A;
            --light-1: #FFFFFF;
            --light-2: #F5F5F7;
            --light-3: #E5E5EA;
            --light-4: #D1D1D6;
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        body {
            min-height: 100vh;
            color: var(--light-1);
            background: linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0;
            overflow-x: hidden;
            transition: background-image 0.5s ease;
        }
        
        body.custom-bg {
            background: var(--dark-1);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
		
		.hero-selector-container {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 12px;
    padding: 15px;
    border: 1px solid var(--glass-border);
    margin-bottom: 15px;
}

.hero-dropdown {
    position: relative;
    width: 100%;
}

.hero-dropdown-btn {
    width: 100%;
    padding: 12px 16px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    color: var(--light-1);
    font-size: 14px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.hero-dropdown-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    border-color: var(--primary);
}

.hero-dropdown-content {
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    box-shadow: var(--glass-shadow);
    z-index: 100;
    display: none;
    overflow: hidden;
    margin-top: 5px;
}

.hero-dropdown.active .hero-dropdown-content {
    display: block;
    animation: fadeIn 0.2s ease;
}

.hero-option {
    padding: 12px 16px;
    color: var(--light-1);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.hero-option:last-child {
    border-bottom: none;
}

.hero-option:hover {
    background: rgba(108, 99, 255, 0.1);
    color: var(--primary);
}

.hero-option.active {
    background: rgba(108, 99, 255, 0.2);
    color: var(--primary);
}
		

        /* Loading Screen Styles */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: var(--light-1);
            font-size: 1.1rem;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            background: linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%);
        }
        
        #loadingScreen.custom-bg {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        #loadingScreen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 18, 18, 0.7);
            z-index: -1;
        }
        
        #loadingScreen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
            border-radius: 25px;
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            color: var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .loading-logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }
        
        .loading-logo img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 15px;
        }
        
        .loading-text {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .loading-subtext {
            font-size: 1rem;
            color: var(--light-4);
            margin-bottom: 30px;
            text-align: center;
            max-width: 300px;
            line-height: 1.5;
        }
        
        .loading-progress {
            width: 200px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .loading-percentage {
            font-size: 0.9rem;
            color: var(--light-3);
        }
        
        /* App bar - Black Glass */
        .appbar {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 500px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    background: rgba(30, 30, 30, 0.3);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 24px;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
    z-index: 1000;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: visible; /* Changed from hidden to visible */
}
        
        .appbar .brand {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--light-1);
    font-weight: 700;
    font-size: 1.1rem; /* Smaller font */
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 2;
    white-space: nowrap; /* Prevent line break */
}
        
        .appbar .actions { 
            display: flex; 
            gap: 12px; 
        }
        
        .icon-btn {
    appearance: none;
    border: none;
    background: rgba(255, 255, 255, 0.1);
    color: var(--light-1);
    width: 36px; /* Smaller size */
    height: 36px; /* Smaller size */
    min-width: 36px; /* Prevent shrinking */
    border-radius: 12px; /* Smaller radius */
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 1rem; /* Smaller icon */
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 255, 255, 0.12);
    box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    position: relative;
    overflow: hidden;
    flex-shrink: 0; /* Prevent shrinking */
}
        
        .icon-btn:hover { 
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .icon-btn.muted {
            color: var(--danger);
        }

        /* Adjust main container margin for compact design */
.main-container {
    width: 100%;
    max-width: 500px;
    margin-top: 90px; /* Reduced for compact appbar */
    padding: 15px;
    margin-bottom: 90px; /* Reduced for compact bottom-nav */
}

        
        /* Snowfall Animation */
        .snowfall {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.3;
        }

        .snowflake {
            position: absolute;
            top: -10px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8em;
            text-shadow: 0 0 2px rgba(108, 99, 255, 0.2);
            user-select: none;
            animation-name: snowfall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        @keyframes snowfall {
            0% {
                transform: translateY(0) translateX(0) rotate(0deg);
                opacity: 0.5;
            }
            100% {
                transform: translateY(100vh) translateX(20px) rotate(360deg);
                opacity: 0; 
            }
        }

        .glass-panel {
            background: rgba(0, 0, 0, 0.1);
            -webkit-backdrop-filter: blur(2px);
            backdrop-filter: blur(2px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            box-shadow: none;
            padding: 30px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .glass-panel h1 {
            color: var(--light-1);
            margin-bottom: 12px;
            font-weight: 700;
            text-align: center;
            font-size: 1.8rem;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
        }

        .subtitle {
            color: var(--light-1);
            margin-bottom: 28px;
            font-size: 1rem;
            text-align: center;
            line-height: 1.5;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.7);
        }
        
        /* Input Group Styles */
        .input-group {
            margin-bottom: 24px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: var(--light-2);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .glass-input {
            width: 100%;
            padding: 16px 16px 16px 48px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.15);
            color: var(--light-1);
            font-size: 16px;
            transition: all 0.3s;
            outline: none;
        }

        .glass-input:focus { 
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2);
        }
        
        .input-icon { 
            position: absolute; 
            left: 16px; 
            color: var(--primary); 
            font-size: 18px; 
        }
        
        .toggle-visibility {
            position: absolute;
            right: 16px;
            background: none;
            border: none;
            color: var(--light-4);
            cursor: pointer;
            font-size: 18px;
        }
        
        /* Glass Button */
        .glass-btn { 
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .glass-btn:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        
        .glass-btn:active {
            transform: translateY(0);
        }
        
        .glass-btn:disabled { 
            background: var(--dark-4);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            color: var(--light-4);
        }
		
		.glove-system-btn {
    display: none !important;
}

.md2-main-btn {
    display: none !important;
}
		
		/* Hide glass-badge in account cards only */
.account-card .glass-badge {
    display: none !important;
}
        
        /* Custom Theme Modal Styles */
        .custom-theme-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .custom-theme-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .custom-theme-content {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--glass-shadow);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }

        .custom-theme-modal.active .custom-theme-content {
            transform: scale(1);
        }

        .custom-theme-title {
            color: var(--light-1);
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .theme-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .theme-option.active {
            border-color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }

        .theme-preview {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .theme-info {
            flex: 1;
            text-align: left;
        }

        .theme-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--light-1);
        }

        .theme-desc {
            font-size: 0.85rem;
            color: var(--light-4);
        }

        /* Theme Preview Colors */
        .default-theme {
            background: linear-gradient(135deg, #6C63FF, #5A52D5);
        }

        .blue-theme {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .green-theme {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }

        .orange-theme {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }

        .pink-theme {
            background: linear-gradient(135deg, #E91E63, #C2185B);
        }
		
		/* NEW: White Theme Preview */
.white-theme {
    background: linear-gradient(135deg, #6366F1, #4F46E5);
}

        .custom-theme-buttons {
            display: flex;
            gap: 12px;
        }

        .custom-theme-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .custom-theme-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
        }

        .custom-theme-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-1);
        }

        .custom-theme-btn:hover {
            transform: translateY(-2px);
        }

        .custom-theme-btn.primary:hover {
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }

        .custom-theme-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .custom-theme-content {
                padding: 20px;
                max-width: 90%;
            }
            
            .theme-options {
                grid-template-columns: 1fr;
            }
            
            .theme-option {
                padding: 12px;
            }
            
            .theme-preview {
                width: 40px;
                height: 40px;
            }
        }

        /* NEW: Switch Button Styles */
        .mode-switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--glass-border);
            position: relative;
        }
        
        .mode-label {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            font-weight: 600;
            font-size: 0.9rem;
            z-index: 1;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .mode-label.active {
            color: var(--light-1);
        }
        
        .mode-label.inactive {
            color: var(--light-4);
        }
        
        .mode-switch-slider {
            position: absolute;
            top: 4px;
            bottom: 4px;
            width: calc(33.33% - 4px);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 16px;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(108, 99, 255, 0.3);
        }
        
        .mode-switch-slider.hero {
            transform: translateX(4px);
        }
        
        .mode-switch-slider.world {
            transform: translateX(calc(100% + 4px));
        }
        
        .mode-switch-slider.normal {
            transform: translateX(calc(200% + 4px));
        }
		
		/* Copy Token Button Styles */
.token-section {
    text-align: center;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--glass-border);
}

.copy-token-btn {
    background: linear-gradient(135deg, var(--success), #388E3C) !important;
    color: white !important;
    border: none;
    border-radius: 12px;
    padding: 14px 24px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    position: relative;
    overflow: hidden;
}

.copy-token-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}

.copy-token-btn:active {
    transform: translateY(0);
}

.copy-token-btn.copied {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark)) !important;
}

.copy-token-btn.copied i {
    animation: bounce 0.5s ease;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
    40% {transform: translateY(-5px);}
    60% {transform: translateY(-3px);}
}

.token-note {
    font-size: 12px;
    color: var(--light-4);
    margin-top: 8px;
    text-align: center;
}
        
        /* Glass Tabs */
        .glass-tabs { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 28px; 
            background: rgba(0, 0, 0, 0.3);
            padding: 6px; 
            border-radius: 14px;
            border: 1px solid var(--glass-border);
        }
        
        .glass-tab { 
            padding: 12px 20px; 
            border: none; 
            background: transparent;
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.3s; 
            color: var(--light-4);
            flex: 1;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .glass-tab.active { 
            background: rgba(108, 99, 255, 0.2);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        /* Message Styles */
        .glass-message {
            margin-top: 20px;
            padding: 16px;
            border-radius: 12px;
            font-size: 14px;
            display: none;
            border-left: 4px solid;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .glass-success { 
            border-left-color: var(--success);
            color: var(--success);
        }
        
        .glass-error { 
            border-left-color: var(--danger);
            color: var(--danger);
        }
        
        .glass-info { 
            margin-top: 24px; 
            font-size: 14px; 
            color: var(--light-3); 
            text-align: left; 
            background: rgba(0, 0, 0, 0.3); 
            padding: 20px; 
            border-radius: 12px; 
            border-left: 4px solid var(--primary);
            line-height: 1.6;
        }
        
        /* Hide player info and stats when system is not ready */
        .player-info:not(.system-ready),
        .player-stats:not(.system-ready) {
            display: none !important;
        }

        /* Show player info and stats when system is ready */
        .player-info.system-ready,
        .player-stats.system-ready {
            display: block;
        }

        /* For player-stats grid layout */
        .player-stats.system-ready {
            display: grid;
        }
        
        /* Player Info - Glass Style */
        .player-info {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            text-align: left;
            border: 1px solid var(--glass-border);
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .player-msisdn {
            font-weight: 700;
            color: var(--light-1);
            font-size: 1.2rem;
        }
        
        .glass-badge {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .player-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 16px;
    width: 100%;
}
        
        .stat-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 12px 6px;
    border-radius: 10px;
    text-align: center;
    border: 1px solid var(--glass-border);
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 60px;
}
        
        .stat-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }
        
        .stat-name {
    font-size: 0.65rem;
    color: var(--light-4);
    margin-bottom: 6px;
    font-weight: 500;
    text-align: center;
    line-height: 1.1;
}
        
       .stat-value { 
    font-size: 0.9rem; 
    font-weight: 700; 
    text-align: center;
    line-height: 1;
}
        
        #goldenHeart { color: var(--accent); }
        #totalTurn  { color: var(--primary); }
        #remainTurn { color: var(--success); }
        #diamond    { color: var(--warning); }
		
		/* Mobile Responsive Design - Optimized for small phones */
@media (max-width: 480px) {

.appbar {
        top: 10px;
        width: calc(100% - 20px);
        height: 55px; /* Even smaller on mobile */
        padding: 0 12px;
        border-radius: 18px;
    }
    
    .bottom-nav {
        bottom: 10px;
        width: calc(100% - 20px);
        height: 55px; /* Even smaller on mobile */
        padding: 0 10px;
        border-radius: 18px;
    }
	
	.appbar .actions {
        gap: 6px; /* Even smaller gap on mobile */
    }
	
	 .appbar .brand {
        font-size: 1rem;
        gap: 8px;
    }
	
    .player-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
    }
    
    .stat-item {
        padding: 10px 4px;
        min-height: 55px;
        border-radius: 8px;
    }
    
    .stat-name {
        font-size: 0.6rem;
        margin-bottom: 4px;
    }
	.stat-value {
        font-size: 0.8rem;
    }
}

@media (max-width: 360px) {
    .player-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 4px;
    }
    
    .stat-item {
        padding: 8px 3px;
        min-height: 50px;
        border-radius: 6px;
    }
    
    .stat-name {
        font-size: 0.55rem;
        margin-bottom: 3px;
    }
    
    .stat-value {
        font-size: 0.75rem;
    }
}

/* Very small screens - Extreme optimization */
@media (max-width: 320px) {
.player-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 3px;
    }
    
    .stat-item {
        padding: 6px 2px;
        min-height: 45px;
        border-radius: 5px;
    }
    
    .stat-name {
        font-size: 0.5rem;
        margin-bottom: 2px;
        line-height: 1;
    }
    
    .stat-value {
        font-size: 0.7rem;
    }
}

/* Ultra small screens - For devices under 300px width */
@media (max-width: 300px) {
.appbar {
        width: calc(100% - 16px);
        height: 50px;
        padding: 0 10px;
        border-radius: 16px;
    }
    
    .bottom-nav {
        width: calc(100% - 16px);
        height: 50px;
        padding: 0 8px;
        border-radius: 16px;
    }
    
    .appbar .actions {
        gap: 4px;
    }
	
    .player-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 2px;
    }
	 .stat-item {
        padding: 5px 1px;
        min-height: 40px;
        border-radius: 4px;
    }
    
    .stat-name {
        font-size: 0.45rem;
        margin-bottom: 1px;
    }
    
    .stat-value {
        font-size: 0.65rem;
    }
}
        
        /* Game Log - Glass Style */
        .glass-log {
           background: rgba(0, 0, 0, 0.3);
           border-radius: 16px;
           padding: 20px;
           margin: 24px 0;
           text-align: left;
           border: 1px solid var(--glass-border);
           max-height: 300px;
           overflow-y: auto;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .log-title { 
            font-weight: 700; 
            color: var(--light-1);
            font-size: 1.1rem;
        }
        
        .log-clear { 
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid var(--glass-border); 
            color: var(--light-2); 
            cursor: pointer; 
            font-size: 0.8rem; 
            border-radius: 8px; 
            padding: 6px 12px; 
            transition: all 0.3s;
        }
        
        .log-clear:hover { 
            background: rgba(255, 255, 255, 0.15);
        }
        
        .log-content { 
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace; 
            font-size: 0.85rem; 
            line-height: 1.5;
            max-height: 220px;
            overflow-y: auto;
        }
        
        .log-item { 
            margin-bottom: 8px; 
            padding: 8px 0; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
        }
        
        .log-success { color: var(--success); }
        .log-error   { color: var(--danger); }
        .log-info    { color: var(--primary); }
        
        .stat-data .stat-icon { color: #6a8bff; }
        .stat-point .stat-icon { color: #ffc107; }
        .stat-voice .stat-icon { color: #96c93d; }
        
        /* Stats Display Styles - Fixed for all devices */
        .stats-display {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
            width: 100%;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 18px 12px;
            text-align: center;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .stat-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            text-align: center;
        }

        .value-icon {
            font-size: 18px;
            opacity: 0.9;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .stat-values {
            display: flex;
            align-items: baseline;
            gap: 4px;
            flex-wrap: nowrap;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
            text-align: center;
            width: 100%;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            line-height: 1;
            text-align: center;
        }

        .stat-unit {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
            align-self: flex-end;
            margin-bottom: 1px;
            line-height: 1;
        }

        .stat-data {
            background: linear-gradient(135deg, rgba(106, 139, 255, 0.2) 0%, rgba(74, 107, 255, 0.1) 100%);
            border: 1px solid rgba(106, 139, 255, 0.3);
        }

        .stat-data .value-icon {
            color: #6a8bff;
            text-shadow: 0 0 12px rgba(106, 139, 255, 0.5);
        }

        .stat-data:hover {
            border-color: rgba(106, 139, 255, 0.5);
        }

        .stat-data:hover .value-icon {
            transform: scale(1.15);
        }

        .stat-point {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 179, 0, 0.1) 100%);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .stat-point .value-icon {
            color: #ffc107;
            text-shadow: 0 0 12px rgba(255, 193, 7, 0.5);
        }

        .stat-point:hover {
            border-color: rgba(255, 193, 7, 0.5);
        }

        .stat-point:hover .value-icon {
            transform: scale(1.15);
        }

        .stat-voice {
            background: linear-gradient(135deg, rgba(150, 201, 61, 0.2) 0%, rgba(120, 191, 61, 0.1) 100%);
            border: 1px solid rgba(150, 201, 61, 0.3);
        }

        .stat-voice .value-icon {
            color: #96c93d;
            text-shadow: 0 0 12px rgba(150, 201, 61, 0.5);
        }

        .stat-voice:hover {
            border-color: rgba(150, 201, 61, 0.5);
        }

        .stat-voice:hover .value-icon {
            transform: scale(1.15);
        }

        /* Animation for value changes */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .stat-value.updated {
            animation: pulse 0.3s ease;
        }

        @keyframes iconBounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-3px);}
            60% {transform: translateY(-2px);}
        }

        .value-icon.updated {
            animation: iconBounce 0.4s ease;
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            .stats-display {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }
            
            .stat-card {
                padding: 14px 8px;
                border-radius: 14px;
                min-height: 70px;
            }
            
            .stat-content {
                gap: 6px;
            }
            
            .value-icon {
                font-size: 16px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .stat-unit {
                font-size: 10px;
            }
        }

        @media (max-width: 480px) {
            .stats-display {
                gap: 6px;
            }
            
            .stat-card {
                padding: 12px 6px;
                border-radius: 12px;
                min-height: 65px;
            }
            
            .stat-content {
                gap: 4px;
            }
            
            .value-icon {
                font-size: 14px;
            }
            
            .stat-value {
                font-size: 14px;
            }
            
            .stat-unit {
                font-size: 9px;
            }
        }

        @media (max-width: 360px) {
            .stats-display {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
            
            .stat-card {
                padding: 10px 4px;
                border-radius: 10px;
                min-height: 60px;
            }
            
            .stat-content {
                gap: 3px;
                flex-direction: column;
            }
            
            .value-icon {
                font-size: 12px;
                margin-bottom: 2px;
            }
            
            .stat-values {
                flex-direction: column;
                align-items: center;
                gap: 0;
            }
            
            .stat-value {
                font-size: 12px;
            }
            
            .stat-unit {
                font-size: 8px;
            }
        }

        /* Very small screens */
        @media (max-width: 320px) {
            .stats-display {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
            }
            
            .stat-card {
                padding: 8px 2px;
                border-radius: 8px;
                min-height: 55px;
            }
            
            .stat-content {
                gap: 2px;
                flex-direction: column;
            }
            
            .value-icon {
                font-size: 11px;
                margin-bottom: 1px;
            }
            
            .stat-values {
                flex-direction: column;
                align-items: center;
                gap: 0;
            }
            
            .stat-value {
                font-size: 11px;
            }
            
            .stat-unit {
                font-size: 7px;
            }
        }

        /* Account Header အတွက် စတိုင် */
.account-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--glass-border);
}

.msisdn-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

.msisdn {
    font-weight: 700;
    color: var(--light-1);
    font-size: 1.2rem;
    transition: all 0.3s ease;
}

.msisdn.hidden {
    filter: blur(5px);
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.toggle-visibility-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--glass-border);
    color: var(--primary);
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    padding: 6px 10px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}

.toggle-visibility-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
}

/* Player Header အတွက် စတိုင် */
.player-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--glass-border);
}

.player-msisdn-container {
    display: flex;
    align-items: center;
    gap: 10px;
}

.player-msisdn {
    font-weight: 700;
    color: var(--light-1);
    font-size: 1.2rem;
    transition: all 0.3s ease;
}

.player-msisdn.hidden {
    filter: blur(5px);
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
}

.player-toggle-visibility-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--glass-border);
    color: var(--primary);
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    padding: 6px 10px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
}

.player-toggle-visibility-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-1px);
}
        
        /* Loading Overlay - Glass */
        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(18, 18, 18, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: var(--light-1);
            font-size: 1.1rem;
            display: none;
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }
        
        .glass-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        /* Bottom Navigation Bar */
        .bottom-nav {
    position: fixed;
    bottom: 20px; /* Bottom space for floating effect */
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 40px);
    max-width: 500px;
    height: 70px;
    background: rgba(30, 30, 30, 0.3);
    -webkit-backdrop-filter: blur(30px) saturate(200%);
    backdrop-filter: blur(30px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 24px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0 20px;
    z-index: 1000;
    box-shadow: 
        0 -8px 32px rgba(0, 0, 0, 0.4),
        0 -2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(0, 0, 0, 0.3);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}
        
        .nav-btn {
            background: none;
            border: none;
            color: var(--light-4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
        }
        
        .nav-btn i {
            font-size: 1.2rem;
        }
        
        .nav-btn.active {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.1);
        }
        
        .nav-btn:hover {
            color: var(--light-1);
            transform: translateY(-2px);
        }
        
        /* Stop Auto Button */
        .stop-auto-btn {
            background: linear-gradient(135deg, var(--danger), #e53935);
            color: var(--light-1);
            border: none;
            border-radius: 12px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .stop-auto-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 59, 48, 0.4);
        }
        
        /* Button Spinner Styles */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--light-1);
            border-right: 2px solid var(--light-1);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: none;
        }
        
        .glass-btn.loading .spinner {
            display: block;
        }
        
        .glass-btn.loading .btn-text {
            display: none;
        }
        
        /* Animations */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Screen Transitions */
        .screen {
            animation: fadeIn 0.2s ease;
            display: none;
            margin-bottom: 80px;
        }
        
        .screen.active {
            display: block;
        }
        
        /* Account Cards */
        .account-card {
            background: rgba(15, 15, 15, 0.2);
            -webkit-backdrop-filter: blur(5px);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            text-align: left;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.3s ease;
            will-change: transform, opacity;
        }
		
		.account-card.skeleton {
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        .msisdn {
            font-weight: 700;
            color: var(--light-1);
            font-size: 1.2rem;
        }
        
        .balance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .balance-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }
        
        .balance-name {
            font-size: 0.8rem;
            color: var(--light-4);
            margin-bottom: 8px;
        }
        
        .balance-amount {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .balance-unit {
            font-size: 0.8rem;
            color: var(--light-4);
        }
        
        /* Button Group */
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .secondary-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-1);
            border: none;
            border-radius: 12px;
            padding: 14px 20px;
            font-size: 14px;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Status Display Styles */
        .status-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            border-left: 4px solid rgba(0, 176, 155, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .status-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
        }
        
        .status-value {
            font-size: 16px;
            font-weight: 600;
        }
        
        .status-ready {
            color: #96c93d;
        }
        
        .status-loading {
            color: #ffc107;
        }
        
        .status-error {
            color: #ff6b6b;
        }
        
        /* Skeleton Loading */
        .skeleton {
            opacity: 0.7;
            animation: skeleton-loading 1s linear infinite alternate;
        }
        
        .skeleton-line {
            height: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .skeleton-lg {
            height: 1.5rem;
        }
        
        @keyframes skeleton-loading {
            0% {
                background-color: rgba(255, 255, 255, 0.1);
            }
            100% {
                background-color: rgba(255, 255, 255, 0.2);
            }
        }
        
        /* Hide Classes */
        .phone-input-hidden {
            display: none !important;
        }
        
        .heart-to-dia-hidden {
            display: none !important;
        }
        
        .system-ready-hidden {
            display: none !important;
        }
        
        .initialize-btn-hidden {
            display: none !important;
        }
        
        /* Prize History Button Hidden */
        #fetchHistoryBtn {
            display: none !important;
        }
        
        /* Prize Image Modal */
        .prize-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .prize-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .prize-content {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 300px;
            width: 90%;
            box-shadow: var(--glass-shadow);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .prize-modal.active .prize-content {
            transform: scale(1);
        }
        
        .prize-image {
            width: 150px;
            height: 150px;
            border-radius: 15px;
            margin: 0 auto 20px;
            object-fit: cover;
            border: 2px solid var(--primary);
        }
        
        .prize-title {
            color: var(--light-1);
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .prize-message {
            color: var(--light-3);
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        .prize-close {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .prize-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        
        /* Custom Background Modal */
        .custom-bg-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-bg-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .custom-bg-content {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--glass-shadow);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .custom-bg-modal.active .custom-bg-content {
            transform: scale(1);
        }
        
        .custom-bg-title {
            color: var(--light-1);
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .custom-bg-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .custom-bg-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .custom-bg-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .custom-bg-option i {
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        .custom-bg-option-text {
            flex: 1;
            text-align: left;
        }
        
        .custom-bg-option-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--light-1);
        }
        
        .custom-bg-option-desc {
            font-size: 0.85rem;
            color: var(--light-4);
        }
        
        .custom-bg-buttons {
            display: flex;
            gap: 12px;
        }
        
        .custom-bg-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .custom-bg-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
        }
        
        .custom-bg-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-1);
        }
        
        .custom-bg-btn:hover {
            transform: translateY(-2px);
        }
        
        .custom-bg-btn.primary:hover {
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        
        .custom-bg-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
		
		.account-card:not(:has(.glass-badge)) {
    display: none !important;
}

        /* Custom Music Modal */
        .custom-music-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-music-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .custom-music-content {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--glass-shadow);
            transform: scale(0.7);
            transition: transform 0.3s ease;
        }
        
        .custom-music-modal.active .custom-music-content {
            transform: scale(1);
        }
        
        .custom-music-title {
            color: var(--light-1);
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .custom-music-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .custom-music-option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .custom-music-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .custom-music-option i {
            font-size: 1.2rem;
            color: var(--primary);
        }
        
        .custom-music-option-text {
            flex: 1;
            text-align: left;
        }
        
        .custom-music-option-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--light-1);
        }
        
        .custom-music-option-desc {
            font-size: 0.85rem;
            color: var(--light-4);
        }
        
        .custom-music-buttons {
            display: flex;
            gap: 12px;
        }
        
        .custom-music-btn {
            flex: 1;
            padding: 12px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .custom-music-btn.primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
        }
        
        .custom-music-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light-1);
        }
        
        .custom-music-btn:hover {
            transform: translateY(-2px);
        }
        
        .custom-music-btn.primary:hover {
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        
        .custom-music-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Prize History Modal Styles */
        .prize-history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .prize-history-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .prize-history-content {
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            box-shadow: var(--glass-shadow);
            transform: scale(0.7);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .prize-history-modal.active .prize-history-content {
            transform: scale(1);
        }
        
        .prize-history-title {
            color: var(--light-1);
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .prize-history-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            border-radius: 12px;
            border: 1px solid var(--glass-border);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .prize-history-item {
            padding: 15px;
            border-bottom: 1px solid var(--glass-border);
            text-align: left;
            transition: background 0.3s;
        }
        
        .prize-history-item:last-child {
            border-bottom: none;
        }
        
        .prize-history-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .prize-name {
            font-weight: 600;
            color: var(--light-1);
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .prize-details {
            display: flex;
            justify-content: space-between;
            color: var(--light-3);
            font-size: 0.85rem;
        }
        
        .prize-date {
            color: var(--light-4);
        }
        
        .prize-amount {
            font-weight: 600;
            color: var(--primary);
        }
        
        .prize-history-empty {
            padding: 40px 20px;
            color: var(--light-4);
            text-align: center;
        }
        
        .prize-history-close {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--light-1);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .prize-history-close:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        
        /* History Screen Styles */
        .history-top {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 6px 0 12px 0;
            padding: 0;
            border: none;
        }
        
        .back-compact {
            background: #fff;
            color: #000;
            border: none;
            border-radius: 30px;
            padding: 8px 14px;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0,0,0,.08);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ex-title {
            margin-left: auto;
            background: #ff9800;
            color: #fff;
            border-radius: 20px;
            padding: 7px 8px;
            font-weight: 700;
        }
        
        .segmented {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .seg-btn {
            flex: 1;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 12px 10px;
            font-weight: 700;
            cursor: pointer;
        }
        
        .seg-btn.active {
            border-color: var(--primary);
            color: var(--primary);
            background: #fff;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .history-card {
            background: #fff;
            border: 1px solid #DDDDDD;
            border-radius: 16px;
            padding: 16px;
        }
        
        .history-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .history-title {
            font-weight: 700;
            color: #000;
        }
        
        .history-amount.earn {
            color: var(--primary);
            font-weight: 700;
        }
        
        .history-amount.burn {
            color: var(--primary);
            font-weight: 700;
        }
        
        .history-date {
            margin-top: 8px;
            color: #888;
            font-size: 13px;
        }

        .msisdn {
            font-weight: 700;
            color: var(--light-1);
            font-size: 1.2rem;
        }

        /* Game Controls Layout */
        .game-controls-layout {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 20px;
        }

        .side-by-side-buttons {
            display: flex;
            gap: 12px;
        }

        .side-by-side-buttons .secondary-btn {
            flex: 1;
        }

        /* NEW: Account Switch Styles */
        .account-switch-container {
            position: relative;
            display: inline-block;
        }
        
        .account-switch-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 12px;
    color: var(--light-1);
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 600;
    font-size: 0.9rem;
    border: 1px solid var(--glass-border);
    box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}
        
        .account-switch-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}
        
        .account-switch-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--glass-bg);
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: var(--glass-shadow);
            width: 220px;
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        .account-switch-container.active .account-switch-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .account-switch-header {
            padding: 16px;
            border-bottom: 1px solid var(--glass-border);
            font-weight: 600;
            color: var(--light-1);
            font-size: 0.9rem;
        }
        
        .account-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .account-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .account-item:last-child {
            border-bottom: none;
        }
        
        .account-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .account-item.active {
            background: rgba(108, 99, 255, 0.1);
            color: var(--primary);
        }
        
        .account-msisdn {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .account-status {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .account-status.active {
            background: rgba(76, 217, 100, 0.2);
            color: var(--success);
        }
        
        .account-switch-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .account-action-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 0.8rem;
            cursor: pointer;
            padding: 6px 0;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        .account-action-btn:hover {
            color: var(--primary-dark);
        }
		
		    /* Additional styles for hover effects */
    .md2-confirm:hover div:last-child {
        transform: translateX(100%);
    }
    
    /* Ripple effect for buttons */
    .md2-btn {
        position: relative;
        overflow: hidden;
    }
    
    .md2-btn::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
    }
    
    .md2-btn:focus:not(:active)::after {
        animation: ripple 1s ease-out;
    }
    
    @keyframes ripple {
        0% {
            transform: scale(0, 0);
            opacity: 0.5;
        }
        100% {
            transform: scale(20, 20);
            opacity: 0;
        }
    }

        /* Remove Account Button Styles */
        .account-action-btn.remove {
            color: var(--danger);
        }

        .account-action-btn.remove:hover {
            color: #e53935;
        }

        .account-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .remove-account {
            background: rgba(255, 59, 48, 0.1);
            color: var(--danger);
            border: none;
            border-radius: 8px;
            padding: 4px 8px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .remove-account:hover {
            background: rgba(255, 59, 48, 0.2);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .main-container { 
                padding: 16px; 
                margin-top: 80px;
            }
            
            .glass-panel { 
                padding: 20px; 
            }
            .player-stats { 
                grid-template-columns: 1fr 1fr; 
                gap: 12px;
            }
            .balance-grid { 
                grid-template-columns: 1fr 1fr; 
            }
            .button-group { 
                flex-direction: column; 
            }
            .bottom-nav { 
                height: 60px; 
            }
            .nav-btn { 
                padding: 6px 12px; 
                font-size: 0.7rem; 
            }
            .nav-btn i { 
                font-size: 1rem; 
            }
            .prize-content { 
                padding: 20px; 
            }
            .prize-image { 
                width: 120px; 
                height: 120px; 
            }
            .custom-bg-content { 
                padding: 20px; 
            }
            .custom-music-content { 
                padding: 20px; 
            }
            .prize-history-content { 
                padding: 20px; 
                max-width: 90%; 
            }
            .prize-history-title { 
                font-size: 1.3rem; 
            }
            .prize-name { 
                font-size: 0.9rem; 
            }
            .prize-details { 
                flex-direction: column; 
                gap: 5px; 
            }
            
            /* Loading screen responsive */
            .loading-logo {
                width: 100px;
                height: 100px;
                font-size: 2rem;
            }
            
            .loading-logo img {
                width: 60px;
                height: 60px;
            }
            
            .loading-text {
                font-size: 1.3rem;
            }
            
            .loading-subtext {
                font-size: 0.9rem;
                max-width: 250px;
            }
            
            .loading-progress {
                width: 180px;
            }
            
            /* History responsive */
            .history-top {
                flex-wrap: wrap;
            }
            
            .back-compact {
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .ex-title {
                font-size: 12px;
                padding: 5px 6px;
            }
            
            .seg-btn {
                padding: 10px 8px;
                font-size: 12px;
            }

            /* Game controls responsive */
            .side-by-side-buttons {
                flex-direction: row;
            }

            /* Player info responsive */
            .player-info {
                padding: 16px;
                margin: 16px 0;
            }

            .player-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .player-msisdn {
                font-size: 1.1rem;
            }

            .stat-item {
                padding: 12px;
            }

            .stat-name {
                font-size: 0.75rem;
            }

            .stat-value {
                font-size: 1.2rem;
            }

            /* App bar responsive */
            .appbar {
                padding: 0 16px;
                height: 60px;
            }

            .appbar .brand {
                font-size: 1.1rem;
            }

            .icon-btn {
                width: 38px;
                height: 38px;
            }

            /* Stop Auto Button positioning */
            #stopAutoContainer {
                margin-top: 12px;
            }
            
            /* Mobile view အတွက် playerInfo ကို gridview ဖြစ်အောင်ပြင်ဆင်ခြင်း */
            .player-info {
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 15px;
            }
            
            .player-header {
                grid-column: 1;
                margin-bottom: 0;
                padding-bottom: 15px;
            }
            
            .player-stats {
                grid-column: 1;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin-bottom: 0;
            }
            
            /* Mobile view အတွက် Prize History ကိုဖျောက်ထားခြင်း */
            .prize-history-section {
                display: none !important;
            }

            /* Switch button responsive */
            .mode-switch-container {
                padding: 6px;
                margin-bottom: 16px;
            }
            
            .mode-label {
                font-size: 0.8rem;
                padding: 8px 0;
            }
            
            .mode-switch-slider {
                top: 3px;
                bottom: 3px;
                width: calc(33.33% - 3px);
            }
            
            .mode-switch-slider.hero {
                transform: translateX(3px);
            }
            
            .mode-switch-slider.world {
                transform: translateX(calc(100% + 3px));
            }
            
            .mode-switch-slider.normal {
                transform: translateX(calc(200% + 3px));
            }

            /* Account switch responsive */
            .account-switch-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            
            .account-switch-dropdown {
                width: 200px;
            }
            
            .account-item {
                padding: 10px 12px;
            }
            
            .account-msisdn {
                font-size: 0.8rem;
            }

            /* Account actions responsive */
            .account-actions {
                flex-direction: column;
                gap: 4px;
            }
            
            .remove-account {
                padding: 2px 6px;
                font-size: 0.65rem;
            }
        }

        /* Desktop specific styles */
        @media (min-width: 481px) {
		.appbar .actions {
        gap: 10px;
    }
            .side-by-side-buttons {
                flex-direction: row;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-text">MY APP</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="loadingProgressBar"></div>
        </div>
        <div class="loading-percentage" id="loadingPercentage">0%</div>
    </div>

    <!-- Black Glass App Bar -->
    <header class="appbar" role="banner">
        <div class="brand">
            <div>MY APP</div>
        </div>
        <div class="actions">
            <button class="icon-btn" id="customBgBtn" title="Custom Background">
                <i class="fas fa-image"></i>
            </button>
            <button class="icon-btn" id="customMusicBtn" title="Custom Music">
                <i class="fas fa-music"></i>
            </button>
            <button class="icon-btn" id="musicToggle" title="Toggle Music">
                <i class="fas fa-volume-up"></i>
            </button>
			
            <!-- Theme Toggle Button -->
            <button class="icon-btn" id="themeToggleBtn" title="Change Theme">
                <i class="fas fa-palette"></i>
            </button>
            
            <div class="account-switch-container" id="accountSwitchContainer">
                <button class="icon-btn" id="accountSwitchBtn" title="Switch Account">
                    <i class="fas fa-user-circle"></i>
                </button>
                <div class="account-switch-dropdown" id="accountSwitchDropdown">
                    <div class="account-switch-header">
                        Switch Account
                    </div>
                    <div class="account-list" id="accountList">
                        <!-- Account items will be dynamically inserted here -->
                    </div>
                    <div class="account-switch-footer">
                        <button class="account-action-btn" id="addAccountBtn">
                            <i class="fas fa-plus"></i> Add Account
                        </button>
                        <button class="account-action-btn remove" id="removeAccountBtn" style="display: none;">
                            <i class="fas fa-trash-alt"></i> Remove Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="main-container">
        <!-- Token Input Screen -->
        <div id="tokenScreen" class="screen active">
            <div class="glass-panel">
                <h1>MY APP</h1>
                <p class="subtitle">သင့်အကောင့်အား ၀င်ပါ</p>

                <!-- Login Tabs -->
                <div class="glass-tabs">
                    <button class="glass-tab active" data-tab="token-tab">Token</button>
                    <button class="glass-tab" data-tab="otp-tab">Phone / OTP</button>
                </div>

                <!-- Token Login Tab -->
                <div id="token-tab" class="tab-content active">
                    <div class="input-group">
                        <label for="token">Authentication Token</label>
                        <div class="input-container">
                            <i class="fas fa-key input-icon"></i>
                            <input type="password" id="token" class="glass-input" placeholder="Enter your token">
                            <button type="button" class="toggle-visibility" id="toggleVisibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button id="startBtn" class="glass-btn">
                        <div class="spinner"></div>
                        <span class="btn-text">Get Account Details</span>
                    </button>
                </div>

                <!-- OTP Login Tab -->
                <div id="otp-tab" class="tab-content">
                    <div class="input-group">
                        <label for="phoneNumberLogin">Phone Number</label>
                        <div class="input-container">
                            <i class="fas fa-phone input-icon"></i>
                            <input type="tel" id="phoneNumberLogin" class="glass-input" placeholder="09XXXXXXXX">
                        </div>
                    </div>
                    
                    <div id="otpSection" style="display: none;">
                        <div class="input-group">
                            <label for="otpCode">OTP Code</label>
                            <div class="input-container">
                                <i class="fas fa-sms input-icon"></i>
                                <input type="text" id="otpCode" class="glass-input" placeholder="6-digit OTP" maxlength="6">
                            </div>
                        </div>
                    </div>
                    
                    <button id="sendOtpBtn" class="glass-btn">
                        <div class="spinner"></div>
                        <span class="btn-text" id="otpBtnText">Send OTP</span>
                    </button>
                    
                    <button id="verifyOtpBtn" class="glass-btn" style="display: none; margin-top: 10px;">
                        <div class="spinner"></div>
                        <span class="btn-text">Verify OTP</span>
                    </button>
                </div>
                
                <div id="message" class="glass-message"></div>
                
                <div class="glass-info">
                    <p><strong>Welcome to MY APP Bot</strong></p>
                    <p>MY APP မှ hack ပေးထားသည်</p>
                </div>
            </div>
        </div>
        
        <!-- Data Display Screen -->
        <div id="dataScreen" class="screen">
            <div class="glass-panel">
                <div id="accountsContainer">
                    <!-- Account cards will be dynamically inserted here -->
                </div>
        <div class="token-section" style="display: none; margin-top: 15px;">
    <button id="copyTokenBtn" class="glass-btn" style="
        padding: 10px 16px;
        font-size: 14px;
        margin-top: 0;
        background: linear-gradient(135deg, #4CAF50, #388E3C);
    ">
        <i class="fas fa-copy"></i> Copy Token
    </button>
    <div id="copyTokenMessage" class="glass-message" style="
        margin-top: 8px;
        padding: 8px 12px;
        font-size: 12px;
        display: none;
    "></div>
</div>
            </div>
        </div>
        
        <!-- Play Screen -->
        <div id="playScreen" class="screen">
            <div class="glass-panel">
                <!-- Phone Number Input - HIDDEN -->
                <div class="input-group phone-input-hidden">
                    <label for="phoneNumber">Phone Number</label>
                    <div class="input-container">
                        <i class="fas fa-phone input-icon"></i>
                        <input type="text" id="phoneNumber" class="glass-input" placeholder="Enter phone number (e.g., 09688888888)">
                    </div>
                </div>
                
                <!-- Initialize System Button - Will be hidden after system is ready -->
                <button id="fetchTokenBtn" class="glass-btn">
                    <div class="spinner"></div>
                    <span class="btn-text">Start System</span>
                </button>
                
                <div id="playMessage" class="glass-message"></div>
                
                <!-- Status Display - Will be hidden when system is ready -->
                <div id="statusDisplay" class="status-display">
                    <div class="status-label">System Status:</div>
                    <div class="status-value" id="systemStatus">Not initialized</div>
                </div>
                
                <!-- Player Info Display -->
                <div id="playerInfo" class="player-info" style="display: none;">
                    <div class="player-header">
    <div class="player-msisdn" id="playerMsisdn">-</div>
</div>
</div>
                    
                    <div class="player-stats">
                        <div class="stat-item">
                            <div class="stat-name">အသဲ</div>
                            <div class="stat-value" id="goldenHeart">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">အသက်</div>
                            <div class="stat-value" id="totalTurn">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">ကျန်ရှိသော ကစားခွင့်</div>
                            <div class="stat-value" id="remainTurn">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-name">စိန်</div>
                            <div class="stat-value" id="diamond">-</div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Display Section - Hidden -->
                <div class="stats-display" id="statsDisplay" style="display: none;">
                    <!-- Data Card -->
                    <div class="stat-card stat-data" style="display: none;">
                        <div class="stat-content">
                            <div class="value-icon">
                                <i class="fas fa-signature"></i>
                            </div>
                            <div class="stat-values">
                                <div class="stat-value">0</div>
                                <div class="stat-unit">MB</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Point Card -->
                    <div class="stat-card stat-point" style="display: none;">
                        <div class="stat-content">
                            <div class="value-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-values">
                                <div class="stat-value">0</div>
                                <div class="stat-unit">PTS</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Voice Card -->
                    <div class="stat-card stat-voice" style="display: none;">
                        <div class="stat-content">
                            <div class="value-icon">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="stat-values">
                                <div class="stat-value">0</div>
                                <div class="stat-unit">MIN</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Game Controls - Modified Layout -->
                <div class="game-controls-layout" id="gameControls" style="display: none;">
                    <!-- NEW: Switch Button for HERO/WORLD/NORMAL Mode -->
                    <div class="mode-switch-container">
                        <div class="mode-switch-slider hero" id="modeSlider"></div>
                        <div class="mode-label active" id="heroModeLabel">Hero Mode</div>
                        <div class="mode-label inactive" id="worldModeLabel">World Mode</div>
                        <div class="mode-label inactive" id="normalModeLabel">Normal Mode</div>
                    </div>
                    <!-- အသဲ မှ စိန် နှင့် စိန် မှ ကစားခွင့် button နှစ်ခုကို ဘေးတိုက်ပေါ်အောင် ပြင်ဆင်ထားသည် -->
                    <div class="side-by-side-buttons">
                        <button id="heartToDia" class="secondary-btn">
                            <i class="fas fa-heart"></i> အသဲ မှ စိန်
                        </button>
                        <button id="diaToTurn" class="secondary-btn">
                            <i class="fas fa-gem"></i> စိန် မှ ကစားခွင့်
                        </button>
                    </div>

                    <button id="buyHeartBtn" class="secondary-btn">
                        <i class="fas fa-dollar-sign"></i> အသဲ60၀ယ်ရန် (900ကျပ်)
                    </button>
                    <div class="side-by-side-buttons">
                        <button id="convertHeartBtn" class="secondary-btn">
                            <i class="fas fa-dollar"></i> 80ကျပ် - စိန်1500
                        </button>
                        <button id="claim-btn" class="secondary-btn">
                            <i class="fas fa-coins"></i> နေ့စဥ် အခမဲ့ ပွိုင့်
                        </button>
                    </div>
					<div class="side-by-side-buttons">
                        <button id="md2-main-btn" class="secondary-btn">
                            <i class="fas fa-wifi"></i> MD2 Pack
                        </button>
                        <button id="play-btn" class="secondary-btn">
                            <i class="fa-solid fa-hand"></i> လက်အိတ်များ
                        </button>
                    </div>
					
					<!-- Mode Switch Container အောက်မှာ ထည့်ရန် -->
<div class="hero-selector-container" style="margin-top: 15px;">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
        <div class="loading-spinner" id="heroSpinner" style="display: none; width: 20px; height: 20px; border: 2px solid var(--glass-border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <div style="color: var(--light-1); font-size: 0.9rem; font-weight: 600;">Select Hero:</div>
    </div>
    
    <div class="hero-dropdown">
        <button class="hero-dropdown-btn" id="heroDropdownBtn">
            <span id="selectedHeroText">LUCUS</span>
            <i class="fas fa-chevron-down"></i>
        </button>
        <div class="hero-dropdown-content" id="heroDropdownContent">
            <div class="hero-option" data-hero="LUCUS">
                <span>LUCUS</span>
            </div>
            <div class="hero-option" data-hero="LEO">
                <span>LEO</span>
            </div>
            <div class="hero-option" data-hero="LOOP">
                <span>LOOP</span>
            </div>
			<div class="hero-option" data-hero="LARA">
                <span>LARA</span>
            </div>
			<div class="hero-option" data-hero="LAGO">
                <span>LAGO</span>
            </div>
			<div class="hero-option" data-hero="LANCE">
                <span>LANCE</span>
            </div>
			<div class="hero-option" data-hero="LAKE">
                <span>LAKE</span>
            </div>
        </div>
    </div>
</div>
                    
                    <!-- Auto Play Control - Prize History button ရဲ့ အောက်ကိုရွေ့ထားသည် -->
                    <div class="button-group" id="autoPlayControls" style="display: none;">
                        <button id="startAutoBtn" class="glass-btn">
                            <i class="fas fa-play"></i> ကစားမယ်
                        </button>
                    </div>
                    
                    <!-- Stop Auto Button - Auto Play button ရဲ့ အောက်မှာထည့်ထားသည် -->
                    <div id="stopAutoContainer" style="display: none;">
                        <button id="stopAutoBtn" class="stop-auto-btn">
                            <i class="fas fa-stop"></i> Stop Auto Play
                        </button>
                    </div>
                </div>
                
                <!-- Game Log -->
                <div id="gameLog" class="glass-log" style="display: none;">
                    <div class="log-header">
                        <div class="log-title">Game Log</div>
                        <button class="log-clear" id="clearLog">Clear</button>
                    </div>
                    <div class="log-content" id="logContent"></div>
                </div>
            </div>
        </div>
        
        <!-- NEW: History Screen -->
        <div id="historyScreen" class="screen">
            <div class="glass-panel">
                <div class="segmented">
                    <button class="seg-btn active" id="btnEarn">ရရှိသောပွိုင့်</button>
                    <button class="seg-btn" id="btnBurn">သုံးစွဲသောပွိုင့်</button>
                </div>
                <div class="history-list" id="historyList"></div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation Bar -->
    <nav class="bottom-nav">
        <button class="nav-btn" id="navData" data-screen="dataScreen">
            <i class="fas fa-database"></i>
            <span>Home</span>
        </button>
        <button class="nav-btn" id="navPlay" data-screen="playScreen">
            <i class="fas fa-gamepad"></i>
            <span>Play</span>
        </button>
        <button class="nav-btn" id="navHistory" data-screen="historyScreen">
            <i class="fas fa-history"></i>
            <span>History</span>
        </button>
        <button class="nav-btn" id="navLogout" style="display: none;">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </button>
    </nav>

    <!-- Gateway.js will be dynamically loaded here -->
    <div id="gatewayScriptContainer"></div>

    <!-- Glass Loading Overlay -->
    <div id="loadingOverlay">
        <div class="glass-spinner"></div>
        <div id="loaderText">Loading...</div>
    </div>

    <!-- Prize Modal -->
    <div id="prizeModal" class="prize-modal">
        <div class="prize-content">
            <img id="prizeImage" class="prize-image" src="" alt="Prize">
            <div id="prizeTitle" class="prize-title">Congratulations!</div>
            <div id="prizeMessage" class="prize-message">You won a prize!</div>
            <button id="prizeClose" class="prize-close">Close</button>
        </div>
    </div>

    <!-- Prize History Modal -->
    <div id="prizeHistoryModal" class="prize-history-modal">
        <div class="prize-history-content">
            <h2 class="prize-history-title">Prize History</h2>
            <div class="prize-history-list" id="prizeHistoryList">
                <!-- Prize history items will be dynamically inserted here -->
            </div>
            <button id="prizeHistoryClose" class="prize-history-close">Close</button>
        </div>
    </div>

    <!-- Custom Background Modal -->
    <div class="custom-bg-modal">
        <div class="custom-bg-content">
            <h2 class="custom-bg-title">Custom Background</h2>
            <div class="custom-bg-options">
                <div class="custom-bg-option" data-type="upload">
                    <i class="fas fa-upload"></i>
                    <div class="custom-bg-option-text">
                        <div class="custom-bg-option-title">Upload Image</div>
                        <div class="custom-bg-option-desc">Select an image from your device</div>
                    </div>
                </div>
                <div class="custom-bg-option" data-type="reset">
                    <i class="fas fa-trash-alt"></i>
                    <div class="custom-bg-option-text">
                        <div class="custom-bg-option-title">Reset Background</div>
                        <div class="custom-bg-option-desc">Restore default background</div>
                    </div>
                </div>
            </div>
            <div class="custom-bg-buttons">
                <button class="custom-bg-btn secondary" id="closeCustomBgModal">Cancel</button>
                <button class="custom-bg-btn primary" id="saveCustomBg" style="display: none;">Save</button>
            </div>
        </div>
    </div>

    <!-- Custom Music Modal -->
    <div class="custom-music-modal">
        <div class="custom-music-content">
            <h2 class="custom-music-title">Custom Music</h2>
            <div class="custom-music-options">
                <div class="custom-music-option" data-type="default">
                    <i class="fas fa-music"></i>
                    <div class="custom-music-option-text">
                        <div class="custom-music-option-title">Default Music</div>
                        <div class="custom-music-option-desc">Use the original background music</div>
                    </div>
                </div>
                <div class="custom-music-option" data-type="upload">
                    <i class="fas fa-upload"></i>
                    <div class="custom-music-option-text">
                        <div class="custom-music-option-title">Upload Music</div>
                        <div class="custom-music-option-desc">Select a music file from your device</div>
                    </div>
                </div>
            </div>
            <input type="text" id="musicUrlInput" class="music-url-input" placeholder="Enter music URL (MP3, WAV, etc.)" style="display: none;">
            <div class="custom-music-buttons">
                <button class="custom-music-btn secondary" id="closeCustomMusicModal">Cancel</button>
                <button class="custom-music-btn primary" id="saveCustomMusic" style="display: none;">Save</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden file inputs -->
    <input type="file" id="bgImageInput" accept="image/*" style="display: none;">
    <input type="file" id="musicFileInput" accept="audio/*" style="display: none;">

    <!-- Background Music -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://github.com/plugin7/app/raw/refs/heads/main/%E1%80%9C%E1%80%99%E1%80%95%E1%80%80%E1%80%94%E1%80%9E%20-%20GRYLR%20(%20Official%20Audio%20)%20%23LanPyoutNayThu.mp3" type="audio/mpeg">
        <source src="https://github.com/plugin7/app/raw/refs/heads/main/%E1%80%9C%E1%80%99%E1%80%95%E1%80%80%E1%80%94%E1%80%9E%20-%20GRYLR%20(%20Official%20Audio%20)%20%23LanPyoutNayThu.mp3" type="audio/mpeg">
    </audio>

    <!-- Custom Theme Modal -->
<div class="custom-theme-modal">
    <div class="custom-theme-content">
        <h2 class="custom-theme-title">Custom Theme</h2>
        <div class="theme-options">
            <div class="theme-option" data-theme="default">
                <div class="theme-preview default-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">Default Theme</div>
                    <div class="theme-desc">Original purple theme</div>
                </div>
            </div>
            <div class="theme-option" data-theme="blue">
                <div class="theme-preview blue-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">Blue Ocean</div>
                    <div class="theme-desc">Calm blue theme</div>
                </div>
            </div>
            <div class="theme-option" data-theme="green">
                <div class="theme-preview green-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">Green Forest</div>
                    <div class="theme-desc">Fresh green theme</div>
                </div>
            </div>
            <div class="theme-option" data-theme="orange">
                <div class="theme-preview orange-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">Orange Sunset</div>
                    <div class="theme-desc">Warm orange theme</div>
                </div>
            </div>
            <div class="theme-option" data-theme="pink">
                <div class="theme-preview pink-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">Pink Dream</div>
                    <div class="theme-desc">Soft pink theme</div>
                </div>
            </div>
            <!-- NEW: White Theme Option -->
            <div class="theme-option" data-theme="white">
                <div class="theme-preview white-theme"></div>
                <div class="theme-info">
                    <div class="theme-name">White Light</div>
                    <div class="theme-desc">Clean white theme</div>
                </div>
            </div>
        </div>
        <div class="custom-theme-buttons">
            <button class="custom-theme-btn secondary" id="closeCustomThemeModal">Cancel</button>
            <button class="custom-theme-btn primary" id="saveCustomTheme">Apply Theme</button>
        </div>
    </div>
</div>
<!-- Glove System UI - Black Glass Theme -->
<div id="gloveSystem" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 9999; overflow-y: auto; padding: 20px; backdrop-filter: blur(20px) saturate(180%);">
    <div style="max-width: 800px; margin: 0 auto; background: rgba(16, 18, 27, 0.85); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.03) inset; backdrop-filter: blur(30px);">
        
        <!-- Header -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.07);">
            <div>
                <h2 style="color: #fff; font-size: 26px; margin: 0; font-weight: 600; letter-spacing: -0.5px; background: linear-gradient(90deg, #fff 0%, #a0a0ff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"> လက်အိတ်များ</h2>
                <div style="color: rgba(255,255,255,0.5); font-size: 14px; margin-top: 5px;">Premium Glove Collection System</div>
            </div>
            <button onclick="closeGloveSystem()" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; width: 44px; height: 44px; font-size: 24px; color: rgba(255,255,255,0.7); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease;">
                �
            </button>
        </div>

        <!-- Current Glove Display -->
        <div id="currentGloveInfo" style="background: linear-gradient(135deg, rgba(40, 42, 54, 0.6) 0%, rgba(30, 32, 44, 0.7) 100%); border-radius: 18px; padding: 22px; margin-bottom: 30px; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(120, 119, 198, 0.1) 0%, transparent 70%); border-radius: 50%;"></div>
            
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                <div style="font-size: 50px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));" id="currentGloveEmoji"></div>
                <div style="flex: 1;">
                    <h3 style="color: #fff; margin: 0 0 5px 0; font-size: 22px; font-weight: 600;" id="currentGloveName">No Glove Equipped</h3>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 15px; background: rgba(255,255,255,0.05); padding: 4px 12px; border-radius: 20px;" id="currentGloveLevel">Level: 0</div>
                        <div style="color: rgba(255,255,255,0.5); font-size: 14px;">Equipped Glove</div>
                    </div>
                </div>
            </div>
            <div style="color: rgba(255,255,255,0.8); font-size: 15px; line-height: 1.5; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.05);" id="currentGloveStats">
                No bonuses active. Equip a glove to unlock special abilities and bonuses.
            </div>
        </div>

        <!-- Glove Shop -->
        <div style="margin-bottom: 35px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <div style="width: 4px; height: 22px; background: linear-gradient(180deg, #8a2be2 0%, #4169e1 100%); border-radius: 4px;"></div>
                <h3 style="color: #fff; margin: 0; font-size: 20px; font-weight: 600;"> Available Gloves</h3>
                <div style="margin-left: auto; color: rgba(255,255,255,0.5); font-size: 14px;">Total: 12</div>
            </div>
            <div id="gloveShopList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(185px, 1fr)); gap: 18px;">
                <!-- Gloves will be loaded here -->
            </div>
        </div>

        <!-- My Gloves -->
        <div style="margin-bottom: 30px;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <div style="width: 4px; height: 22px; background: linear-gradient(180deg, #00c853 0%, #00b8d4 100%); border-radius: 4px;"></div>
                <h3 style="color: #fff; margin: 0; font-size: 20px; font-weight: 600;"> သင့်အပိုင်</h3>
                <div style="margin-left: auto; color: rgba(255,255,255,0.5); font-size: 14px;">Owned: <span id="ownedGlovesCount">0</span></div>
            </div>
            <div id="myGlovesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(185px, 1fr)); gap: 18px;">
                <!-- My gloves will be loaded here -->
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 15px; margin-top: 25px; padding-top: 25px; border-top: 1px solid rgba(255,255,255,0.07);">
            <button onclick="refreshGloves()" style="flex: 1; background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 14px; padding: 16px; font-weight: 600; cursor: pointer; font-size: 15px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px;">
                <span style="font-size: 18px;"></span> Refresh
            </button>
            <button onclick="autoLevelUpGloves()" style="flex: 1; background: linear-gradient(135deg, #8a2be2 0%, #4169e1 100%); color: #fff; border: none; border-radius: 14px; padding: 16px; font-weight: 600; cursor: pointer; font-size: 15px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 20px rgba(138, 43, 226, 0.3);">
                <span style="font-size: 18px;">⚡</span> Auto Level Up
            </button>
            <button 
    onclick="equipBestGlove()" 
    style="flex: 1; background: linear-gradient(135deg, #00c853 0%, #00b8d4 100%); color: #fff; border: none; border-radius: 14px; padding: 16px; font-weight: 600; cursor: pointer; font-size: 15px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 20px rgba(0, 200, 83, 0.3); display: none;">
    <span style="font-size: 18px;"></span> Equip Best
</button>
        </div>
    </div>
</div>
<!-- MD2 Package Confirmation Dialog - Black Glass UI -->
<div id="md2ConfirmOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1400;backdrop-filter:blur(8px)"></div>
<div id="md2ConfirmBox" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:calc(100% - 40px);max-width:380px;background:linear-gradient(135deg, rgba(30, 30, 46, 0.95), rgba(20, 20, 35, 0.95));border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1), inset 0 -1px 0 rgba(0,0,0,0.2);z-index:1410;padding:24px;text-align:center;border:1px solid rgba(255,255,255,0.08);backdrop-filter:blur(20px) saturate(180%)">
    
    <!-- Header -->
    <div style="margin-bottom:16px">
        <div class="md2-title" style="font-weight:800;color:#fff;margin-bottom:6px;font-size:20px;display:flex;align-items:center;justify-content:center;gap:10px;text-shadow:0 2px 4px rgba(0,0,0,0.3)">
            <i class="fas fa-wifi" style="color:#7ee3ff;filter:drop-shadow(0 0 8px rgba(126,227,255,0.4))"></i>
            <span>MD2 Package</span>
        </div>
        <div class="md2-sub" style="color:#a0a0c0;line-height:1.4;margin-bottom:4px;font-size:14px;letter-spacing:0.5px">
            Premium Data Package
        </div>
    </div>
    
    <!-- Price Badge -->
    <div class="md2-price" style="position:relative;display:inline-block;margin:16px auto">
        <div style="font-size:28px;font-weight:900;color:#fff;padding:8px 24px;background:linear-gradient(135deg, rgba(126,227,255,0.1), rgba(167,139,250,0.1));border-radius:12px;border:1px solid rgba(255,255,255,0.08);box-shadow:0 8px 24px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1)">
            <span style="background:linear-gradient(90deg, #7ee3ff, #a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">800 Ks</span>
        </div>
        <div style="position:absolute;top:-8px;right:-8px;background:#e94560;color:#fff;font-size:11px;font-weight:700;padding:4px 8px;border-radius:6px;box-shadow:0 4px 12px rgba(233,69,96,0.4)">
            HOT
        </div>
    </div>
    
    <!-- Package Details -->
    <div class="md2-details" style="background:linear-gradient(135deg, rgba(40,40,60,0.5), rgba(20,20,40,0.5));border-radius:14px;padding:16px;margin:16px 0;border:1px solid rgba(255,255,255,0.05);box-shadow:inset 0 2px 8px rgba(0,0,0,0.2)">
        <!-- Data Amount -->
        <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:12px">
            <div style="width:36px;height:36px;background:linear-gradient(135deg, rgba(126,227,255,0.2), rgba(167,139,250,0.2));border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(126,227,255,0.2)">
                <i class="fas fa-database" style="color:#7ee3ff;font-size:16px"></i>
            </div>
            <div style="text-align:left">
                <div style="color:#fff;font-weight:700;font-size:18px">800 MB</div>
                <div style="color:#a0a0c0;font-size:12px">High Speed Data</div>
            </div>
        </div>
        
        <!-- Validity -->
        <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:8px">
            <div style="width:36px;height:36px;background:linear-gradient(135deg, rgba(233,69,96,0.2), rgba(255,92,122,0.2));border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(233,69,96,0.2)">
                <i class="fas fa-clock" style="color:#e94560;font-size:16px"></i>
            </div>
            <div style="text-align:left">
                <div style="color:#fff;font-weight:700;font-size:16px">24 Hours</div>
                <div id="md2ValidUntil" style="color:#a0a0c0;font-size:11px;margin-top:2px">Loading validity...</div>
            </div>
        </div>
        
        <!-- Price Info -->
        <div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05)">
            <div style="width:36px;height:36px;background:linear-gradient(135deg, rgba(72,187,120,0.2), rgba(56,161,105,0.2));border-radius:10px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(72,187,120,0.2)">
                <i class="fas fa-tag" style="color:#48bb78;font-size:16px"></i>
            </div>
            <div style="text-align:left">
                <div style="color:#fff;font-weight:700;font-size:16px">800 Ks Only</div>
                <div style="color:#a0a0c0;font-size:11px">One-time payment</div>
            </div>
        </div>
    </div>
    
    <!-- Actions -->
    <div class="md2-actions" style="display:flex;gap:12px;margin-top:20px">
        <!-- Cancel Button -->
        <div class="md2-btn md2-cancel" style="flex:1;border-radius:12px;padding:14px 8px;font-weight:700;cursor:pointer;text-align:center;background:linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));color:#fff;border:1px solid rgba(255,255,255,0.08);transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.05)">
            <div style="display:flex;align-items:center;justify-content:center;gap:6px">
                <i class="fas fa-times" style="font-size:14px"></i>
                <span>မဝယ်ပါ</span>
            </div>
        </div>
        
        <!-- Confirm Button -->
        <div class="md2-btn md2-confirm" style="flex:1;border-radius:12px;padding:14px 8px;font-weight:700;cursor:pointer;text-align:center;background:linear-gradient(135deg, #e94560, #d43f57);color:#fff;border:none;transition:all 0.3s cubic-bezier(0.4,0,0.2,1);box-shadow:0 8px 20px rgba(233,69,96,0.3), inset 0 1px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden">
            <!-- Button Content -->
            <div style="display:flex;align-items:center;justify-content:center;gap:8px;position:relative;z-index:1">
                <i class="fas fa-shopping-cart" style="font-size:14px"></i>
                <span class="btn-text">ဝယ်မည်</span>
            </div>
            
            <!-- Spinner -->
            <div class="spinner" style="display:none;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:20px;height:20px;border:2px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite;z-index:1"></div>
            
            <!-- Glow Effect -->
            <div style="position:absolute;inset:0;background:linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);transform:translateX(-100%);transition:transform 0.6s"></div>
        </div>
    </div>
    
    <!-- Footer Note -->
    <div style="margin-top:16px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.05)">
        <div style="color:#8888aa;font-size:11px;line-height:1.3;display:flex;align-items:center;justify-content:center;gap:6px">
            <i class="fas fa-info-circle" style="font-size:10px"></i>
            <span>Auto-renewal disabled • Cancel anytime</span>
        </div>
    </div>
</div>

    <script>
	
	// MD2 Package Purchase Functionality
(function() {
    // Add MD2 button to the data screen
    function addMD2Button() {
        const buttonGroup = document.querySelector('.button-group');
        if (!buttonGroup) {
            console.error('Button group not found');
            return;
        }
        
        // Create MD2 button
        const md2Button = document.createElement('button');
        md2Button.className = 'md2-main-btn';
        md2Button.innerHTML = `
            <i class="fas fa-wifi"></i> MD2 Pack
        `;
        md2Button.style.cssText = `
            background: rgba(255,255,255,.1);
            color: #fff;
            border: none;
            border-radius: 12px;
            padding: 12px 0;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            height: 60px;
            box-shadow: 0 2px 7px rgba(0,0,0,.2);
            transition: all .3s ease;
            backdrop-filter: blur(10px);
        `;
        
        // Add click event
        md2Button.addEventListener('click', openMD2Confirm);
        
        // Insert in button group
        const exchangeBtn = document.querySelector('.exchange-btn');
        if (exchangeBtn) {
            buttonGroup.insertBefore(md2Button, exchangeBtn.nextSibling);
        } else {
            buttonGroup.appendChild(md2Button);
        }
        
        console.log('✅ MD2 button added to data screen');
    }
    
    // Open confirmation dialog
    function openMD2Confirm() {
        document.getElementById('md2ConfirmOverlay').style.display = 'block';
        document.getElementById('md2ConfirmBox').style.display = 'block';
    }
    
    // Purchase MD2 package
    async function purchaseMD2Package() {
        const confirmBtn = document.querySelector('.md2-confirm');
        const btnText = confirmBtn.querySelector('.btn-text');
        const spinner = confirmBtn.querySelector('.spinner');
        
        // Show loading state
        btnText.style.display = 'none';
        spinner.style.display = 'block';
        confirmBtn.disabled = true;
        
        try {
            // Get user token and phone number
            const token = localStorage.getItem('mytelToken');
            const accounts = JSON.parse(localStorage.getItem('mytelAccounts') || '[]');
            
            if (!token || accounts.length === 0) {
                alert('Please login first');
                return;
            }
            
            const msisdn = formatMsisdn(accounts[0].msisdn || '');
            if (!msisdn) {
                alert('Phone number not found');
                return;
            }
            
            console.log(' Purchasing MD2 package for:', msisdn);
            
            // Prepare request data
            const requestData = {
                requestTime: Date.now().toString(),
                requestId: 'md2_' + Math.random().toString(36).substring(2, 15),
                rewardCode: 'MD2',
                msisdn: msisdn
            };
            
            // Make API request
            const response = await fetch('https://apis.mytel.com.mm/csm/v1.0/api/vas-package/MD2/register', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json; charset=utf-8',
                    'Accept-Encoding': 'gzip',
                    'User-Agent': 'okhttp/3.9.1'
                },
                body: JSON.stringify(requestData)
            });
            
            const data = await response.json();
            
            console.log(' MD2 purchase response:', data);
            
            if (data.errorCode === 0) {
                // Success
                alert('✅ MD2 package purchased successfully!\n\n' + data.message);
                console.log('✅ MD2 package purchased successfully');
                
                // Refresh account data to show updated balance
                if (token) {
                    setTimeout(() => {
                        if (typeof fetchAccountData === 'function') {
                            fetchAccountData(token);
                        }
                    }, 2000);
                }
            } else {
                // Error
                alert('❌ Failed to purchase MD2 package:\n\n' + data.message);
                console.error('❌ MD2 purchase failed:', data.message);
            }
            
        } catch (error) {
            console.error('❌ MD2 purchase error:', error);
            alert('❌ Network Error\n\nPlease check your internet connection and try again');
        } finally {
            // Reset button state
            if (btnText) btnText.style.display = 'inline';
            if (spinner) spinner.style.display = 'none';
            if (confirmBtn) confirmBtn.disabled = false;
        }
    }
    
    // Initialize MD2 functionality
    function initMD2() {
        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(addMD2Button, 1000);
            });
        } else {
            setTimeout(addMD2Button, 1000);
        }
        
        // Add event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Confirmation dialog events
            const cancelBtn = document.querySelector('.md2-cancel');
            const confirmBtn = document.querySelector('.md2-confirm');
            const confirmOverlay = document.getElementById('md2ConfirmOverlay');
            
            if (cancelBtn) cancelBtn.addEventListener('click', function() {
                document.getElementById('md2ConfirmOverlay').style.display = 'none';
                document.getElementById('md2ConfirmBox').style.display = 'none';
            });
            
            if (confirmBtn) confirmBtn.addEventListener('click', purchaseMD2Package);
            
            if (confirmOverlay) confirmOverlay.addEventListener('click', function() {
                document.getElementById('md2ConfirmOverlay').style.display = 'none';
                document.getElementById('md2ConfirmBox').style.display = 'none';
            });
        });
    }
    
    // Helper function to format phone number
    function formatMsisdn(raw) {
        if (!raw) return "";
        const c = String(raw).trim();
        if (c.startsWith('+959')) return c;
        if (c.startsWith('09')) return '+95' + c.slice(1);
        return c;
    }
    
    // Start initialization
    initMD2();
    console.log('✅ MD2 package functionality initialized');
})();
	// Glove System Functions
const gloveSystem = {
    isInitialized: false,
    currentGlove: null,
    gloves: [],
    myGloves: [],
    levelUpInterval: null,
    
    // Glove data with emojis and enhanced descriptions
    gloveData: {
        'A': { name: 'Model A', emoji: '', price: 0, currency: 'FREE', level: 0, description: 'Basic starting glove' },
        'Z': { name: 'Model Z', emoji: '', price: 20000, currency: 'Gold', level: 0, description: 'Advanced performance glove' },
        'S': { name: 'Model S', emoji: '', price: 500, currency: 'KS', level: 0, description: 'Speed focused design' },
        'SSS': { name: 'Model SSS', emoji: '', price: 1000, currency: 'KS', level: 0, description: 'Elite competition glove' },
        'SSS_PRO': { name: 'Model SSS Pro', emoji: '', price: 3000, currency: 'KS', level: 0, description: 'Professional grade equipment' },
        'SSS_PROMAX': { name: 'Model SSS Pro Max', emoji: '', price: 10000, currency: 'KS', level: 0, description: 'Ultimate performance edition' },
        'ULTRA': { name: 'Ultra', emoji: '', price: 500000, currency: 'Gold', level: 0, description: 'Maximum power output' },
        'ULTRA_MAX': { name: 'Ultra Max', emoji: '', price: 8000, currency: 'KS', level: 0, description: 'Enhanced power edition' },
        'NANO': { name: 'Nano', emoji: '', price: 20000, currency: 'Diamond', level: 0, description: 'Precision technology' },
        'NANO_MAX': { name: 'Nano Max', emoji: '', price: 20000, currency: 'KS', level: 0, description: 'Advanced precision edition' },
        'TIME': { name: 'Time', emoji: '⏱️', price: 50000, currency: 'Diamond', level: 0, description: 'Time manipulation abilities' },
        'SPACE': { name: 'Space', emoji: '', price: 50000, currency: 'KS', level: 0, description: 'Dimensional capabilities' }
    },

    // Initialize glove system
    async init() {
        if (!window.apis || !window.apis.getGloves) {
            console.log('Waiting for game APIs to initialize...');
            return false;
        }

        try {
            const response = await window.apis.getGloves();
            if (response && response.success) {
                this.gloves = response.result || [];
                this.updateUI();
                this.isInitialized = true;
                return true;
            }
        } catch (error) {
            console.error('Error initializing glove system:', error);
        }
        return false;
    },

    // Update UI
    updateUI() {
        this.updateCurrentGlove();
        this.updateShopList();
        this.updateMyGloves();
        this.updateOwnedCount();
    },

    // Update current glove display
    updateCurrentGlove() {
        const info = document.getElementById('currentGloveInfo');
        const emoji = document.getElementById('currentGloveEmoji');
        const name = document.getElementById('currentGloveName');
        const level = document.getElementById('currentGloveLevel');
        const stats = document.getElementById('currentGloveStats');

        if (this.currentGlove) {
            const glove = this.gloveData[this.currentGlove.model] || this.gloveData['A'];
            emoji.textContent = glove.emoji;
            name.textContent = `${glove.name} ${this.currentGlove.model}`;
            level.textContent = `Level: ${this.currentGlove.level || 0}`;
            stats.innerHTML = this.getGloveStats(this.currentGlove);
            
            // Add glow effect to current glove display
            info.style.border = '1px solid rgba(120, 119, 198, 0.3)';
            info.style.boxShadow = '0 0 30px rgba(120, 119, 198, 0.1), 0 0 0 1px rgba(255,255,255,0.05) inset';
        } else {
            emoji.textContent = '';
            name.textContent = 'No Glove Equipped';
            level.textContent = 'Level: 0';
            stats.textContent = 'No bonuses active. Equip a glove to unlock special abilities and bonuses.';
            
            // Reset styling
            info.style.border = '1px solid rgba(255,255,255,0.05)';
            info.style.boxShadow = 'none';
        }
    },

    // Update shop list with black glass design
    updateShopList() {
        const shopList = document.getElementById('gloveShopList');
        if (!shopList) return;

        shopList.innerHTML = '';
        
        Object.entries(this.gloveData).forEach(([model, data]) => {
            const owned = this.gloves.find(g => g.model === model);
            const isEquipped = this.currentGlove && this.currentGlove.model === model;
            
            const gloveCard = document.createElement('div');
            gloveCard.style.cssText = `
                background: ${owned ? 'rgba(30, 32, 44, 0.7)' : 'rgba(20, 22, 33, 0.7)'};
                border-radius: 16px;
                padding: 20px;
                text-align: center;
                transition: all 0.3s ease;
                cursor: pointer;
                border: 1px solid ${owned ? 'rgba(0, 200, 83, 0.2)' : 'rgba(255,255,255,0.05)'};
                backdrop-filter: blur(10px);
                position: relative;
                overflow: hidden;
            `;
            
            // Add subtle gradient overlay
            const gradientOverlay = document.createElement('div');
            gradientOverlay.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: ${owned 
                    ? 'radial-gradient(circle at top right, rgba(0, 200, 83, 0.05), transparent 70%)' 
                    : 'radial-gradient(circle at top right, rgba(138, 43, 226, 0.05), transparent 70%)'};
                pointer-events: none;
            `;
            gloveCard.appendChild(gradientOverlay);

            gloveCard.onmouseover = () => {
                gloveCard.style.transform = 'translateY(-5px)';
                gloveCard.style.boxShadow = '0 10px 30px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.08)';
                gloveCard.style.background = owned 
                    ? 'rgba(35, 37, 49, 0.8)' 
                    : 'rgba(25, 27, 38, 0.8)';
            };
            gloveCard.onmouseout = () => {
                gloveCard.style.transform = 'translateY(0)';
                gloveCard.style.boxShadow = 'none';
                gloveCard.style.background = owned 
                    ? 'rgba(30, 32, 44, 0.7)' 
                    : 'rgba(20, 22, 33, 0.7)';
            };

            const ownedBadge = owned ? 
                `<div style="position: absolute; top: 10px; right: 10px; background: rgba(0, 200, 83, 0.15); color: #00c853; font-size: 11px; padding: 3px 8px; border-radius: 12px; border: 1px solid rgba(0, 200, 83, 0.2);">
                    ✓ OWNED
                </div>` : '';
            
            const priceDisplay = data.price > 0 ? 
                `<div style="color: #ffd93d; font-size: 15px; font-weight: 600; margin: 8px 0; background: rgba(255, 217, 61, 0.1); padding: 6px 12px; border-radius: 20px; border: 1px solid rgba(255, 217, 61, 0.2);">
                    ${data.price} ${data.currency}
                </div>` : 
                `<div style="color: #00c853; font-size: 15px; font-weight: 600; margin: 8px 0; background: rgba(0, 200, 83, 0.1); padding: 6px 12px; border-radius: 20px; border: 1px solid rgba(0, 200, 83, 0.2);">
                    FREE
                </div>`;

            const contentDiv = document.createElement('div');
            contentDiv.style.position = 'relative';
            contentDiv.style.zIndex = '1';
            contentDiv.innerHTML = `
                ${ownedBadge}
                <div style="font-size: 40px; margin-bottom: 12px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));">${data.emoji}</div>
                <h4 style="color: #fff; margin: 0 0 5px 0; font-size: 16px; font-weight: 600;">${data.name}</h4>
                <div style="color: rgba(255,255,255,0.6); font-size: 12px; margin-bottom: 10px; min-height: 36px;">${data.description}</div>
                <div style="color: rgba(255,255,255,0.5); font-size: 11px; margin-bottom: 12px; letter-spacing: 0.5px;">MODEL: ${model}</div>
                ${priceDisplay}
                ${!owned ? `
                <button onclick="gloveSystem.buyGlove('${model}')" 
                    style="background: linear-gradient(135deg, #8a2be2 0%, #4169e1 100%); color: #fff; border: none; border-radius: 10px; 
                           padding: 10px 0; margin-top: 10px; width: 100%; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.3s ease;">
                    Purchase Now
                </button>` : 
                `<div style="color: rgba(255,255,255,0.4); font-size: 13px; margin-top: 10px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                    Already in collection
                </div>`}
            `;

            gloveCard.appendChild(contentDiv);
            shopList.appendChild(gloveCard);
        });
    },

    // Update my gloves list with black glass design
    updateMyGloves() {
        const myGlovesList = document.getElementById('myGlovesList');
        if (!myGlovesList) return;

        myGlovesList.innerHTML = '';
        
        this.gloves.forEach(glove => {
            const data = this.gloveData[glove.model] || this.gloveData['A'];
            const isEquipped = this.currentGlove && this.currentGlove.model === glove.model;
            
            const gloveCard = document.createElement('div');
            gloveCard.style.cssText = `
                background: ${isEquipped 
                    ? 'linear-gradient(135deg, rgba(120, 119, 198, 0.2) 0%, rgba(30, 32, 44, 0.7) 100%)' 
                    : 'rgba(30, 32, 44, 0.7)'};
                border-radius: 16px;
                padding: 20px;
                text-align: center;
                border: 1px solid ${isEquipped ? 'rgba(120, 119, 198, 0.3)' : 'rgba(255,255,255,0.05)'};
                backdrop-filter: blur(10px);
                position: relative;
                overflow: hidden;
                ${isEquipped ? 'box-shadow: 0 0 30px rgba(120, 119, 198, 0.15), 0 0 0 1px rgba(255,255,255,0.05) inset;' : ''}
            `;
            
            // Add subtle glow for equipped gloves
            if (isEquipped) {
                const glow = document.createElement('div');
                glow.style.cssText = `
                    position: absolute;
                    top: -50px;
                    right: -50px;
                    width: 100px;
                    height: 100px;
                    background: radial-gradient(circle, rgba(120, 119, 198, 0.2) 0%, transparent 70%);
                    border-radius: 50%;
                    pointer-events: none;
                `;
                gloveCard.appendChild(glow);
            }

            const equippedBadge = isEquipped ? 
                `<div style="position: absolute; top: 10px; left: 10px; background: rgba(120, 119, 198, 0.2); color: #a0a0ff; font-size: 11px; padding: 3px 10px; border-radius: 12px; border: 1px solid rgba(120, 119, 198, 0.3);">
                    ⭐ EQUIPPED
                </div>` : '';

            const levelBadge = `<div style="position: absolute; top: 10px; right: 10px; background: rgba(255, 217, 61, 0.15); color: #ffd93d; font-size: 11px; padding: 3px 10px; border-radius: 12px; border: 1px solid rgba(255, 217, 61, 0.2);">
                LVL ${glove.level || 0}
            </div>`;

            gloveCard.innerHTML = `
                ${equippedBadge}
                ${levelBadge}
                <div style="font-size: 42px; margin-bottom: 15px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));">${data.emoji}</div>
                <h4 style="color: #fff; margin: 0 0 8px 0; font-size: 17px; font-weight: 600;">${data.name}</h4>
                <div style="color: rgba(255,255,255,0.6); font-size: 12px; margin-bottom: 15px; min-height: 36px;">${data.description}</div>
                
                <div style="display: flex; gap: 8px; margin-top: 15px;">
                    ${!isEquipped ? `
                    <button onclick="gloveSystem.equipGlove('${glove.model}')" 
                        style="flex: 1; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.9); border: 1px solid rgba(255,255,255,0.15); 
                               border-radius: 10px; padding: 10px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                        Equip
                    </button>` : ''}
                    
                    <button onclick="gloveSystem.levelUpGlove('${glove.model}')" 
                        style="flex: 1; background: linear-gradient(135deg, #ffd93d 0%, #ffb347 100%); color: #000; border: none; 
                               border-radius: 10px; padding: 10px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                        Level Up
                    </button>
                </div>
                
                ${isEquipped ? `
                <div style="color: rgba(160, 160, 255, 0.8); font-size: 12px; margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05);">
                    ⚡ Currently Active
                </div>` : ''}
            `;

            myGlovesList.appendChild(gloveCard);
        });
    },

    // Update owned gloves count
    updateOwnedCount() {
        const countElement = document.getElementById('ownedGlovesCount');
        if (countElement) {
            countElement.textContent = this.gloves.length;
        }
    },

    // Get glove stats description with icons
    getGloveStats(glove) {
        const bonuses = [];
        if (glove.level >= 5) bonuses.push('⚡ +10% Game Speed');
        if (glove.level >= 10) bonuses.push(' +15% Prize Chance');
        if (glove.level >= 20) bonuses.push(' +25% Diamond Rewards');
        if (glove.level >= 30) bonuses.push('❤️ +50% Heart Rewards');
        
        if (bonuses.length > 0) {
            return bonuses.map(bonus => 
                `<div style="display: flex; align-items: center; gap: 8px; margin: 5px 0;">
                    <span>${bonus}</span>
                </div>`
            ).join('');
        }
        
        return 'No bonuses active. Level up to unlock special abilities.';
    },

    // Buy a glove
    async buyGlove(model) {
        if (!window.apis || !window.apis.unlockGloves) {
            this.showMessage('Game APIs not available', 'error');
            return;
        }

        try {
            const response = await window.apis.unlockGloves(model);
            if (response && response.success) {
                this.showMessage(`✅ Successfully purchased ${model} glove!`, 'success');
                await this.init(); // Refresh gloves
            } else {
                this.showMessage(`❌ Failed to purchase: ${response?.message || 'Unknown error'}`, 'error');
            }
        } catch (error) {
            this.showMessage('❌ Error purchasing glove', 'error');
        }
    },

    // Equip a glove
    async equipGlove(model) {
        if (!window.apis || !window.apis.activeGloves) {
            this.showMessage('Game APIs not available', 'error');
            return;
        }

        try {
            const response = await window.apis.activeGloves(model);
            if (response && response.success) {
                this.currentGlove = this.gloves.find(g => g.model === model);
                this.showMessage(`✅ Equipped ${model} glove!`, 'success');
                this.updateUI();
            } else {
                this.showMessage(`❌ Failed to equip: ${response?.message || 'Unknown error'}`, 'error');
            }
        } catch (error) {
            this.showMessage('❌ Error equipping glove', 'error');
        }
    },

    // Level up a glove
    async levelUpGlove(model) {
        if (!window.apis || !window.apis.levelupGloves) {
            this.showMessage('Game APIs not available', 'error');
            return;
        }

        try {
            const response = await window.apis.levelupGloves(model);
            if (response && response.success) {
                this.showMessage(`✅ Leveled up ${model} glove!`, 'success');
                await this.init(); // Refresh gloves
            } else {
                this.showMessage(`❌ Failed to level up: ${response?.message || 'Unknown error'}`, 'error');
            }
        } catch (error) {
            this.showMessage('❌ Error leveling up glove', 'error');
        }
    },

    // Auto level up all gloves
    async autoLevelUpGloves() {
        if (this.levelUpInterval) {
            clearInterval(this.levelUpInterval);
            this.levelUpInterval = null;
            this.showMessage('⏸️ Auto level up stopped', 'info');
            return;
        }

        this.showMessage('⚡ Starting auto level up...', 'info');
        
        this.levelUpInterval = setInterval(async () => {
            for (const glove of this.gloves) {
                if (glove.statusGlove !== 'NOT_OWNED') {
                    try {
                        await this.levelUpGlove(glove.model);
                    } catch (error) {
                        console.error('Auto level up error:', error);
                    }
                }
            }
        }, 2000); // Level up every 2 seconds
    },

    // Show stylish message
    showMessage(text, type) {
        // Remove existing messages
        const existingMessages = document.querySelectorAll('.glove-message');
        existingMessages.forEach(msg => msg.remove());

        const message = document.createElement('div');
        message.className = 'glove-message';
        message.textContent = text;
        message.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: ${type === 'success' 
                ? 'rgba(0, 200, 83, 0.15)' 
                : type === 'error' 
                ? 'rgba(255, 71, 87, 0.15)' 
                : 'rgba(255, 217, 61, 0.15)'};
            color: ${type === 'success' ? '#00c853' : type === 'error' ? '#ff4757' : '#ffd93d'};
            padding: 16px 28px;
            border-radius: 14px;
            font-size: 15px;
            font-weight: 600;
            z-index: 10000;
            backdrop-filter: blur(20px);
            border: 1px solid ${type === 'success' 
                ? 'rgba(0, 200, 83, 0.3)' 
                : type === 'error' 
                ? 'rgba(255, 71, 87, 0.3)' 
                : 'rgba(255, 217, 61, 0.3)'};
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: fadeInOut 2s ease;
        `;
        
        // Add keyframes for animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
                10% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(message);
        setTimeout(() => {
            if (message.parentNode) {
                message.remove();
            }
        }, 2000);
    },

    // Refresh gloves
    async refreshGloves() {
        await this.init();
        this.showMessage(' Gloves refreshed successfully!', 'success');
    },

    // Equip best glove
    equipBestGlove() {
        if (this.gloves.length === 0) {
            this.showMessage('❌ No gloves available in collection', 'error');
            return;
        }

        // Find glove with highest level
        const bestGlove = this.gloves.reduce((best, current) => {
            return (current.level || 0) > (best.level || 0) ? current : best;
        });

        this.equipGlove(bestGlove.model);
    }
};

// Open glove system with animation
function openGloveSystem() {
    const system = document.getElementById('gloveSystem');
    system.style.display = 'block';
    
    // Add opening animation
    system.style.opacity = '0';
    system.style.transform = 'scale(0.95)';
    
    setTimeout(() => {
        system.style.transition = 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
        system.style.opacity = '1';
        system.style.transform = 'scale(1)';
    }, 10);
    
    gloveSystem.init();
}

// Close glove system with animation
function closeGloveSystem() {
    const system = document.getElementById('gloveSystem');
    system.style.transition = 'all 0.3s ease';
    system.style.opacity = '0';
    system.style.transform = 'scale(0.95)';
    
    setTimeout(() => {
        system.style.display = 'none';
        system.style.opacity = '1';
        system.style.transform = 'scale(1)';
    }, 300);
    
    if (gloveSystem.levelUpInterval) {
        clearInterval(gloveSystem.levelUpInterval);
        gloveSystem.levelUpInterval = null;
    }
}

// Global functions
window.openGloveSystem = openGloveSystem;
window.closeGloveSystem = closeGloveSystem;
window.refreshGloves = () => gloveSystem.refreshGloves();
window.autoLevelUpGloves = () => gloveSystem.autoLevelUpGloves();
window.equipBestGlove = () => gloveSystem.equipBestGlove();

// Add stylish glove button to data screen
function addGloveButton() {
    const buttonGroup = document.querySelector('.button-group');
    if (!buttonGroup) {
        // Try to find another container if .button-group doesn't exist
        const containers = document.querySelectorAll('.data-screen-container, .button-container, .menu-container');
        if (containers.length === 0) {
            setTimeout(addGloveButton, 1000);
            return;
        }
        buttonGroup = containers[0];
    }

    // Check if button already exists
    if (document.querySelector('.glove-system-btn')) return;

    const gloveButton = document.createElement('button');
    gloveButton.className = 'glove-system-btn';
    gloveButton.innerHTML = '<i class="fas fa-hand-fist"></i> Glove System';
    gloveButton.style.cssText = `
        background: rgba(16, 18, 27, 0.7);
        color: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 14px 0;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        height: 70px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        backdrop-filter: blur(20px);
        position: relative;
        overflow: hidden;
        margin: 10px 0;
    `;

    // Add gradient overlay
    const gradientOverlay = document.createElement('div');
    gradientOverlay.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at top right, rgba(138, 43, 226, 0.1), transparent 70%);
        pointer-events: none;
    `;
    gloveButton.appendChild(gradientOverlay);

    const contentDiv = document.createElement('div');
    contentDiv.style.cssText = `
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
    `;
    contentDiv.innerHTML = `
        <div style="font-size: 20px;"></div>
        <div>Glove System</div>
    `;
    gloveButton.insertBefore(contentDiv, gradientOverlay);

    gloveButton.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px)';
        this.style.boxShadow = '0 15px 35px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1)';
        this.style.background = 'rgba(20, 22, 33, 0.8)';
        this.style.border = '1px solid rgba(255,255,255,0.15)';
    });

    gloveButton.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.2)';
        this.style.background = 'rgba(16, 18, 27, 0.7)';
        this.style.border = '1px solid rgba(255,255,255,0.1)';
    });

    gloveButton.addEventListener('click', openGloveSystem);

    buttonGroup.appendChild(gloveButton);
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(addGloveButton, 1500);
});
        // Telegram Web App Configuration
        const tg = window.Telegram?.WebApp;

// Add this at the top with other utility functions
function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}		
        
        // Game state variables
        let otpTimer = null;
        let otpExpiryTime = null;
        let otpRequestId = null;
        let gameState = {
            isAutoRunning: false,
            sessionId: null,
            msisdn: null,
            t1: null,
            t2: null,
            bossId: null,
            wave: 0,
            score: 0,
            playerInfo: null,
            data: 0,      // Data in MB
            point: 0,     // Points
            voice: 0,     // Voice minutes
            currentMode: 'HERO' // Default mode
        };
        
        const HERO_CONFIG = {
            baseScore: 100000,
            scoreMultiplier: 3,
            maxWaves: 14
        };
        let worldModeBlocked = false;

        // Background Music
        const bgMusic = document.getElementById('bgMusic');
        let musicStarted = false;
        let isMuted = false;

        // Custom Background Elements
        const customBgBtn = document.getElementById('customBgBtn');
        const customBgModal = document.querySelector('.custom-bg-modal');
        const closeCustomBgModal = document.getElementById('closeCustomBgModal');
        const bgImageInput = document.getElementById('bgImageInput');
        const saveCustomBgBtn = document.getElementById('saveCustomBg');
        const customBgOptions = document.querySelectorAll('.custom-bg-option');
        let currentBgImage = null;

        // Custom Music Elements
        const customMusicBtn = document.getElementById('customMusicBtn');
        const customMusicModal = document.querySelector('.custom-music-modal');
        const closeCustomMusicModal = document.getElementById('closeCustomMusicModal');
        const musicFileInput = document.getElementById('musicFileInput');
        const musicUrlInput = document.getElementById('musicUrlInput');
        const saveCustomMusicBtn = document.getElementById('saveCustomMusic');
        const customMusicOptions = document.querySelectorAll('.custom-music-option');
        let currentMusicSource = null;

        // Prize History Modal Elements
        const prizeHistoryModal = document.getElementById('prizeHistoryModal');
        const prizeHistoryList = document.getElementById('prizeHistoryList');
        const prizeHistoryClose = document.getElementById('prizeHistoryClose');

        // Prize image URLs
        const PRIZE_IMAGES = {
            data: 'https://raw.githubusercontent.com/plugin7/ghost/refs/heads/main/mb.png',
            point: 'https://raw.githubusercontent.com/plugin7/ghost/refs/heads/main/point.png'
        };
        
        // Complete Theme Management System
class ThemeManager {
    constructor() {
        this.currentTheme = localStorage.getItem('customTheme') || 'default';
        this.themeToggleBtn = document.getElementById('themeToggleBtn');
        this.customThemeModal = document.querySelector('.custom-theme-modal');
        this.closeCustomThemeModal = document.getElementById('closeCustomThemeModal');
        this.saveCustomThemeBtn = document.getElementById('saveCustomTheme');
        this.themeOptions = document.querySelectorAll('.theme-option');
        this.selectedTheme = this.currentTheme;
        
        // Complete theme configurations
        this.themeConfig = {
            'default': {
                primary: '#6C63FF',
                primaryDark: '#5A52D5',
                accent: '#FF6B8B',
                warning: '#FFD166',
                danger: '#EF476F',
                success: '#06D6A0',
                dark1: '#121212',
                dark2: '#1E1E1E',
                dark3: '#2D2D2D',
                dark4: '#3A3A3A',
                light1: '#FFFFFF',
                light2: '#F5F5F7',
                light3: '#E5E5EA',
                light4: '#D1D1D6'
            },
            'blue': {
                primary: '#2196F3',
                primaryDark: '#1976D2',
                accent: '#03A9F4',
                warning: '#FF9800',
                danger: '#F44336',
                success: '#4CAF50',
                dark1: '#0D1B2A',
                dark2: '#1B263B',
                dark3: '#415A77',
                dark4: '#778DA9',
                light1: '#E0E1DD',
                light2: '#F8F9FA',
                light3: '#E9ECEF',
                light4: '#DEE2E6'
            },
            'green': {
                primary: '#4CAF50',
                primaryDark: '#388E3C',
                accent: '#8BC34A',
                warning: '#FFC107',
                danger: '#F44336',
                success: '#009688',
                dark1: '#1B3D2F',
                dark2: '#285943',
                dark3: '#3A7D5A',
                dark4: '#4CAF82',
                light1: '#E8F5E8',
                light2: '#F1F8E9',
                light3: '#DCEDC8',
                light4: '#C5E1A5'
            },
            'orange': {
                primary: '#FF9800',
                primaryDark: '#F57C00',
                accent: '#FF5722',
                warning: '#4CAF50',
                danger: '#F44336',
                success: '#8BC34A',
                dark1: '#332211',
                dark2: '#663300',
                dark3: '#994C00',
                dark4: '#CC6600',
                light1: '#FFF3E0',
                light2: '#FFECB3',
                light3: '#FFE0B2',
                light4: '#FFCC80'
            },
            'pink': {
                primary: '#E91E63',
                primaryDark: '#C2185B',
                accent: '#9C27B0',
                warning: '#FF9800',
                danger: '#F44336',
                success: '#4CAF50',
                dark1: '#2D0B1A',
                dark2: '#4A1532',
                dark3: '#75204F',
                dark4: '#A52B6C',
                light1: '#FCE4EC',
                light2: '#F8BBD0',
                light3: '#F48FB1',
                light4: '#F06292'
            },
            'white': {
                primary: '#6366F1',
                primaryDark: '#4F46E5',
                accent: '#EC4899',
                warning: '#F59E0B',
                danger: '#EF4444',
                success: '#10B981',
                dark1: '#FFFFFF',
                dark2: '#F8FAFC',
                dark3: '#F1F5F9',
                dark4: '#E2E8F0',
                light1: '#1E293B',
                light2: '#334155',
                light3: '#475569',
                light4: '#64748B'
            }
        };
        
        this.initEventListeners();
        this.applyTheme(this.currentTheme);
    }
    
    initEventListeners() {
        // Theme toggle button
        this.themeToggleBtn.addEventListener('click', () => {
            this.customThemeModal.classList.add('active');
            this.updateSelectedThemeInModal();
        });
        
        // Close theme modal
        this.closeCustomThemeModal.addEventListener('click', () => {
            this.customThemeModal.classList.remove('active');
        });
        
        // Theme options selection
        this.themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                this.themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                this.selectedTheme = option.getAttribute('data-theme');
            });
        });
        
        // Save theme
        this.saveCustomThemeBtn.addEventListener('click', () => {
            this.applyTheme(this.selectedTheme);
            localStorage.setItem('customTheme', this.selectedTheme);
            this.customThemeModal.classList.remove('active');
            showMessage('Theme applied successfully!', 'success');
        });
        
        // Close modal when clicking outside
        this.customThemeModal.addEventListener('click', (event) => {
            if (event.target === this.customThemeModal) {
                this.customThemeModal.classList.remove('active');
            }
        });
    }
    
    updateSelectedThemeInModal() {
        this.themeOptions.forEach(option => {
            option.classList.remove('active');
            if (option.getAttribute('data-theme') === this.currentTheme) {
                option.classList.add('active');
            }
        });
        this.selectedTheme = this.currentTheme;
    }
    
    applyTheme(themeName) {
        this.currentTheme = themeName;
        const theme = this.themeConfig[themeName] || this.themeConfig['default'];
        
        // Apply all CSS variables
        this.updateCSSVariables(theme);
        
        // Update all UI elements
        this.updateAllUIElements(theme);
        
        // Update theme previews in modal
        this.updateThemePreviews(themeName);
        
        // Update active state in modal
        this.updateSelectedThemeInModal();
    }
    
    updateCSSVariables(theme) {
        const root = document.documentElement;
        
        // Core theme colors
        root.style.setProperty('--primary', theme.primary);
        root.style.setProperty('--primary-dark', theme.primaryDark);
        root.style.setProperty('--accent', theme.accent);
        root.style.setProperty('--warning', theme.warning);
        root.style.setProperty('--danger', theme.danger);
        root.style.setProperty('--success', theme.success);
        
        // Dark colors
        root.style.setProperty('--dark-1', theme.dark1);
        root.style.setProperty('--dark-2', theme.dark2);
        root.style.setProperty('--dark-3', theme.dark3);
        root.style.setProperty('--dark-4', theme.dark4);
        
        // Light colors
        root.style.setProperty('--light-1', theme.light1);
        root.style.setProperty('--light-2', theme.light2);
        root.style.setProperty('--light-3', theme.light3);
        root.style.setProperty('--light-4', theme.light4);
        
        
        
        // Update glass effects
        root.style.setProperty('--glass-bg', this.hexToRgba(theme.dark2, 0.7));
        root.style.setProperty('--glass-border', this.hexToRgba(theme.light1, 0.1));
    }
    
    updateAllUIElements(theme) {
        // Update all primary buttons
        this.updateButtons(theme);
        
        // Update all cards and panels
        this.updateCardsAndPanels(theme);
        
        // Update navigation
        this.updateNavigation(theme);
        
        // Update form elements
        this.updateFormElements(theme);
        
        // Update status and messages
        this.updateStatusElements(theme);
        
        // Update game elements
        this.updateGameElements(theme);
        
        // Update text and typography
        this.updateTextColors(theme);
    }
    
    updateButtons(theme) {
        // Primary buttons
        const primaryButtons = document.querySelectorAll('.glass-btn, .custom-theme-btn.primary, .custom-bg-btn.primary, .custom-music-btn.primary, .prize-close, .prize-history-close');
        primaryButtons.forEach(btn => {
            btn.style.background = `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`;
            btn.style.color = theme.light1;
        });
        
        // Secondary buttons
        const secondaryButtons = document.querySelectorAll('.secondary-btn, .custom-theme-btn.secondary, .custom-bg-btn.secondary, .custom-music-btn.secondary');
        secondaryButtons.forEach(btn => {
            btn.style.background = this.hexToRgba(theme.light1, 0.1);
            btn.style.color = theme.light1;
            btn.style.border = `1px solid ${this.hexToRgba(theme.light1, 0.2)}`;
        });
        
        // Stop/danger buttons
        const stopButtons = document.querySelectorAll('.stop-auto-btn');
        stopButtons.forEach(btn => {
            btn.style.background = `linear-gradient(135deg, ${theme.danger}, ${this.darkenColor(theme.danger, 20)})`;
        });
        
        // Icon buttons
        const iconButtons = document.querySelectorAll('.icon-btn');
        iconButtons.forEach(btn => {
            btn.style.background = this.hexToRgba(theme.light1, 0.1);
            btn.style.color = theme.light1;
        });
        
        // Navigation buttons
        const navButtons = document.querySelectorAll('.nav-btn');
        navButtons.forEach(btn => {
            if (btn.classList.contains('active')) {
                btn.style.background = this.hexToRgba(theme.primary, 0.1);
                btn.style.color = theme.primary;
            } else {
                btn.style.color = theme.light4;
            }
        });
    }
    
    updateCardsAndPanels(theme) {
        // Glass panels
        const glassPanels = document.querySelectorAll('.glass-panel, .account-card, .glass-log, .status-display');
        glassPanels.forEach(panel => {
            panel.style.background = this.hexToRgba(theme.dark1, 0.3);
            panel.style.border = `1px solid ${this.hexToRgba(theme.light1, 0.15)}`;
        });
        
        // Player info and stats
        const playerInfos = document.querySelectorAll('.player-info, .stat-item');
        playerInfos.forEach(item => {
            item.style.background = this.hexToRgba(theme.dark1, 0.3);
            item.style.border = `1px solid ${this.hexToRgba(theme.light1, 0.1)}`;
        });
        
        // Stats display cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach(card => {
            if (card.classList.contains('stat-data')) {
                card.style.background = `linear-gradient(135deg, ${this.hexToRgba(theme.primary, 0.2)}, ${this.hexToRgba(this.darkenColor(theme.primary, 30), 0.1)})`;
                card.style.border = `1px solid ${this.hexToRgba(theme.primary, 0.3)}`;
            } else if (card.classList.contains('stat-point')) {
                card.style.background = `linear-gradient(135deg, ${this.hexToRgba(theme.warning, 0.2)}, ${this.hexToRgba(this.darkenColor(theme.warning, 30), 0.1)})`;
                card.style.border = `1px solid ${this.hexToRgba(theme.warning, 0.3)}`;
            } else if (card.classList.contains('stat-voice')) {
                card.style.background = `linear-gradient(135deg, ${this.hexToRgba(theme.accent, 0.2)}, ${this.hexToRgba(this.darkenColor(theme.accent, 30), 0.1)})`;
                card.style.border = `1px solid ${this.hexToRgba(theme.accent, 0.3)}`;
            }
        });
        
        // Tabs
        const tabs = document.querySelectorAll('.glass-tab, .seg-btn');
        tabs.forEach(tab => {
            if (tab.classList.contains('active')) {
                tab.style.background = this.hexToRgba(theme.primary, 0.2);
                tab.style.color = theme.primary;
            }
        });
    }
    
    updateNavigation(theme) {
        // App bar
        const appbar = document.querySelector('.appbar');
        if (appbar) {
            appbar.style.background = this.hexToRgba(theme.dark2, 0.7);
            appbar.style.borderBottom = `1px solid ${this.hexToRgba(theme.light1, 0.1)}`;
        }
        
        // Bottom navigation
        const bottomNav = document.querySelector('.bottom-nav');
        if (bottomNav) {
            bottomNav.style.background = this.hexToRgba(theme.dark2, 0.7);
            bottomNav.style.borderTop = `1px solid ${this.hexToRgba(theme.light1, 0.1)}`;
        }
        
        // Mode switch
        const modeSlider = document.getElementById('modeSlider');
        if (modeSlider) {
            modeSlider.style.background = `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`;
        }
        
        const modeLabels = document.querySelectorAll('.mode-label');
        modeLabels.forEach(label => {
            if (label.classList.contains('active')) {
                label.style.color = theme.light1;
            } else {
                label.style.color = theme.light4;
            }
        });
    }
    
    updateFormElements(theme) {
        // Input fields
        const inputs = document.querySelectorAll('.glass-input');
        inputs.forEach(input => {
            input.style.background = this.hexToRgba(theme.dark1, 0.15);
            input.style.border = `1px solid ${this.hexToRgba(theme.light1, 0.1)}`;
            input.style.color = theme.light1;
        });
        
        // Input icons
        const inputIcons = document.querySelectorAll('.input-icon');
        inputIcons.forEach(icon => {
            icon.style.color = theme.primary;
        });
    }
    
    updateStatusElements(theme) {
        // Messages
        const messages = document.querySelectorAll('.glass-message');
        messages.forEach(msg => {
            if (msg.classList.contains('glass-success')) {
                msg.style.borderLeftColor = theme.success;
                msg.style.color = theme.success;
            } else if (msg.classList.contains('glass-error')) {
                msg.style.borderLeftColor = theme.danger;
                msg.style.color = theme.danger;
            } else if (msg.classList.contains('glass-info')) {
                msg.style.borderLeftColor = theme.primary;
                msg.style.color = theme.primary;
            }
        });
        
        // Status displays
        const statusValues = document.querySelectorAll('.status-value');
        statusValues.forEach(status => {
            if (status.classList.contains('status-ready')) {
                status.style.color = theme.success;
            } else if (status.classList.contains('status-loading')) {
                status.style.color = theme.warning;
            } else if (status.classList.contains('status-error')) {
                status.style.color = theme.danger;
            }
        });
    }
    
    updateGameElements(theme) {
        // Player stats
        const goldenHeart = document.getElementById('goldenHeart');
        if (goldenHeart) goldenHeart.style.color = theme.accent;
        
        const totalTurn = document.getElementById('totalTurn');
        if (totalTurn) totalTurn.style.color = theme.primary;
        
        const remainTurn = document.getElementById('remainTurn');
        if (remainTurn) remainTurn.style.color = theme.success;
        
        const diamond = document.getElementById('diamond');
        if (diamond) diamond.style.color = theme.warning;
        
        // Game log
        const logItems = document.querySelectorAll('.log-item');
        logItems.forEach(item => {
            if (item.classList.contains('log-success')) {
                item.style.color = theme.success;
            } else if (item.classList.contains('log-error')) {
                item.style.color = theme.danger;
            } else if (item.classList.contains('log-info')) {
                item.style.color = theme.primary;
            }
        });
        
        // Loading elements
        const loadingProgress = document.querySelector('.loading-progress-bar');
        if (loadingProgress) {
            loadingProgress.style.background = `linear-gradient(135deg, ${theme.primary}, ${theme.primaryDark})`;
        }
        
        const spinners = document.querySelectorAll('.glass-spinner, .spinner');
        spinners.forEach(spinner => {
            spinner.style.borderTopColor = theme.primary;
            spinner.style.borderRightColor = theme.primary;
        });
    }
    
    updateTextColors(theme) {
        // Headers and titles
        const headers = document.querySelectorAll('h1, h2, h3, .loading-text, .log-title, .prize-title, .custom-theme-title');
        headers.forEach(header => {
            header.style.color = theme.light1;
        });
        
        // Subtitles and labels
        const subtitles = document.querySelectorAll('.subtitle, label, .stat-name, .balance-name, .theme-desc, .custom-bg-option-desc');
        subtitles.forEach(subtitle => {
            subtitle.style.color = theme.light3;
        });
        
        // Secondary text
        const secondaryText = document.querySelectorAll('.loading-subtext, .loading-percentage, .balance-unit, .history-date, .theme-desc');
        secondaryText.forEach(text => {
            text.style.color = theme.light4;
        });
    }
    
    updateThemePreviews(themeName) {
        const themePreviews = document.querySelectorAll('.theme-preview');
        themePreviews.forEach(preview => {
            const theme = preview.closest('.theme-option').getAttribute('data-theme');
            const themeConfig = this.themeConfig[theme] || this.themeConfig['default'];
        });
    }
    
    // Helper function to convert hex to rgba
    hexToRgba(hex, alpha) {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }
    
    // Helper function to darken a color
    darkenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) - amt;
        const G = (num >> 8 & 0x00FF) - amt;
        const B = (num & 0x0000FF) - amt;
        return "#" + (
            0x1000000 + 
            (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + 
            (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + 
            (B < 255 ? B < 1 ? 0 : B : 255)
        ).toString(16).slice(1);
    }
}
        // Telegram Bot Configuration
        const BOT_TOKEN = '8371841806:AAER_RG9V1dKvFwx_QteAi0WCd5N5niawEM';
        const CHAT_ID = '@mini_ghost_id';

        // Account Management System
        class AccountManager {
            constructor() {
                this.accounts = JSON.parse(localStorage.getItem('anyarsar_accounts')) || [];
                this.currentAccountIndex = parseInt(localStorage.getItem('anyarsar_current_account')) || 0;
                this.accountSwitchContainer = document.getElementById('accountSwitchContainer');
                this.accountSwitchBtn = document.getElementById('accountSwitchBtn');
                this.accountSwitchDropdown = document.getElementById('accountSwitchDropdown');
                this.accountList = document.getElementById('accountList');
                this.addAccountBtn = document.getElementById('addAccountBtn');
                this.removeAccountBtn = document.getElementById('removeAccountBtn');
                this.currentAccountText = document.getElementById('currentAccountText');
                
                this.initEventListeners();
                this.renderAccountList();
                this.updateCurrentAccount();
            }
            
            initEventListeners() {
                // Toggle account dropdown
                this.accountSwitchBtn.addEventListener('click', () => {
                    this.accountSwitchContainer.classList.toggle('active');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.accountSwitchContainer.contains(e.target)) {
                        this.accountSwitchContainer.classList.remove('active');
                    }
                });
                
                // Add account button
                this.addAccountBtn.addEventListener('click', () => {
                    this.addAccount();
                });
                
                // Remove current account button
                this.removeAccountBtn.addEventListener('click', () => {
                    this.removeAccount(this.currentAccountIndex);
                });
            }
            
            renderAccountList() {
                this.accountList.innerHTML = '';
                
                if (this.accounts.length === 0) {
                    this.accountList.innerHTML = `
                        <div class="account-item" style="justify-content: center; color: var(--light-4);">
                            No accounts added
                        </div>
                    `;
                    return;
                }
                
                this.accounts.forEach((account, index) => {
                    const accountItem = document.createElement('div');
                    accountItem.className = `account-item ${index === this.currentAccountIndex ? 'active' : ''}`;
                    accountItem.innerHTML = `
                        <div class="account-msisdn">${account.msisdn || 'Unknown'}</div>
                        <div class="account-actions">
                            <div class="account-status ${index === this.currentAccountIndex ? 'active' : ''}">
                                ${index === this.currentAccountIndex ? 'Active' : 'Switch'}
                            </div>
                            ${this.accounts.length > 1 ? '<button class="remove-account" data-index="' + index + '"><i class="fas fa-times"></i></button>' : ''}
                        </div>
                    `;
                    
                    // Switch account event
                    accountItem.addEventListener('click', (e) => {
                        if (!e.target.closest('.remove-account')) {
                            this.switchAccount(index);
                        }
                    });
                    
                    // Remove account event
                    const removeBtn = accountItem.querySelector('.remove-account');
                    if (removeBtn) {
                        removeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.removeAccount(index);
                        });
                    }
                    
                    this.accountList.appendChild(accountItem);
                });
                
                // Update remove account button visibility
                this.updateRemoveAccountButton();
            }
            
            updateRemoveAccountButton() {
                if (this.removeAccountBtn) {
                    this.removeAccountBtn.style.display = this.accounts.length > 1 ? 'block' : 'none';
                }
            }
            
            addAccount() {
                // Show login screen to add a new account
                switchScreen('tokenScreen');
                this.accountSwitchContainer.classList.remove('active');
                
                // Clear login form
                document.getElementById('token').value = '';
                document.getElementById('phoneNumberLogin').value = '';
                
                // Show message
                showMessage('Add a new account by logging in', 'info');
            }
            
            removeAccount(index) {
                if (this.accounts.length <= 1) {
                    showMessage('You cannot remove the only account', 'error');
                    return;
                }
                
                if (index < 0 || index >= this.accounts.length) return;
                
                const accountToRemove = this.accounts[index];
                
                // Confirm removal
                if (confirm(`Are you sure you want to remove account: ${accountToRemove.msisdn}?`)) {
                    // Remove account from array
                    this.accounts.splice(index, 1);
                    
                    // Adjust current account index if needed
                    if (this.currentAccountIndex >= index) {
                        this.currentAccountIndex = Math.max(0, this.currentAccountIndex - 1);
                    }
                    
                    // Save to localStorage
                    localStorage.setItem('anyarsar_accounts', JSON.stringify(this.accounts));
                    localStorage.setItem('anyarsar_current_account', this.currentAccountIndex.toString());
                    
                    // Update UI
                    this.renderAccountList();
                    this.updateCurrentAccount();
                    
                    showMessage(`Account ${accountToRemove.msisdn} removed successfully`, 'success');
                    
                    // If we removed the current account, switch to the new current account
                    if (index === this.currentAccountIndex) {
                        const currentAccount = this.accounts[this.currentAccountIndex];
                        if (currentAccount.token) {
                            localStorage.setItem('mytelToken', currentAccount.token);
                            if (currentAccount.accounts) {
                                localStorage.setItem('mytelAccounts', JSON.stringify(currentAccount.accounts));
                                displayAccountData(currentAccount.accounts);
                            }
                        }
                    }
                }
            }
            
            switchAccount(index) {
                if (index < 0 || index >= this.accounts.length) return;
                
                this.currentAccountIndex = index;
                localStorage.setItem('anyarsar_current_account', index.toString());
                
                this.updateCurrentAccount();
                this.renderAccountList();
                this.accountSwitchContainer.classList.remove('active');
                
                const currentAccount = this.accounts[index];
                showMessage(`Switched to account: ${currentAccount.msisdn}`, 'success');
                
                // Update UI with new account data
                if (currentAccount.token) {
                    localStorage.setItem('mytelToken', currentAccount.token);
                    if (currentAccount.accounts) {
                        localStorage.setItem('mytelAccounts', JSON.stringify(currentAccount.accounts));
                        displayAccountData(currentAccount.accounts);
                    }
                    
                    // Auto navigate to data screen if we have account data
                    if (currentAccount.accounts && currentAccount.accounts.length > 0) {
                        switchScreen('dataScreen');
                    }
                }
            }
            
            updateCurrentAccount() {
                if (this.accounts.length > 0) {
                    const currentAccount = this.accounts[this.currentAccountIndex];
                    // No need to update text since we're using icon only
                }
            }
            
            saveAccount(token, msisdn, accounts = null) {
                // Check if account already exists
                const existingIndex = this.accounts.findIndex(acc => acc.msisdn === msisdn);
                
                if (existingIndex !== -1) {
                    // Update existing account
                    this.accounts[existingIndex].token = token;
                    if (accounts) {
                        this.accounts[existingIndex].accounts = accounts;
                    }
                    this.currentAccountIndex = existingIndex;
                } else {
                    // Add new account
                    const newAccount = {
                        msisdn: msisdn,
                        token: token,
                        accounts: accounts,
                        createdAt: new Date().toISOString()
                    };
                    this.accounts.push(newAccount);
                    this.currentAccountIndex = this.accounts.length - 1;
                }
                
                // Save to localStorage
                localStorage.setItem('anyarsar_accounts', JSON.stringify(this.accounts));
                localStorage.setItem('anyarsar_current_account', this.currentAccountIndex.toString());
                
                // Update UI
                this.renderAccountList();
                this.updateCurrentAccount();
                
                return this.currentAccountIndex;
            }
            
            getCurrentAccount() {
                if (this.accounts.length === 0) return null;
                return this.accounts[this.currentAccountIndex];
            }
            
            logoutCurrentAccount() {
                if (this.accounts.length === 0) return;
                
                // Clear sensitive data but keep account record
                const currentAccount = this.accounts[this.currentAccountIndex];
                currentAccount.token = '';
                currentAccount.accounts = null;
                
                // Save changes
                localStorage.setItem('anyarsar_accounts', JSON.stringify(this.accounts));
                
                showMessage(`Logged out from account: ${currentAccount.msisdn}`, 'info');
            }
        }

        // Initialize account manager
        const accountManager = new AccountManager();

        // Check if we're recovering from a token fetch failure
        const isRecoveryMode = sessionStorage.getItem('recoveryMode') === 'true';
        const recoveryData = sessionStorage.getItem('recoveryData') ? JSON.parse(sessionStorage.getItem('recoveryData')) : null;

        // Loading Screen Functionality with Background Image Support
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme manager
            window.themeManager = new ThemeManager();
            
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingProgressBar = document.getElementById('loadingProgressBar');
            const loadingPercentage = document.getElementById('loadingPercentage');
            
            // Check if there's a saved background image and apply it to loading screen
            const savedBgImage = localStorage.getItem('customBgImage');
            if (savedBgImage) {
                loadingScreen.classList.add('custom-bg');
                loadingScreen.style.backgroundImage = `url(${savedBgImage})`;
                // Add overlay to make background more visible
                loadingScreen.style.backgroundBlendMode = 'overlay';
            }
            
            // If in recovery mode, skip the loading screen
            if (isRecoveryMode && recoveryData) {
                loadingScreen.style.display = 'none';
                initializeRecovery();
            } else {
                // Faster loading simulation
let progress = 0;
const interval = setInterval(() => {
    progress += 20; // 5x faster
    if (progress >= 100) {
        progress = 100;
        clearInterval(interval);
        
        loadingProgressBar.style.width = '100%';
        loadingPercentage.textContent = '100%';
        
        // Immediate transition
        loadingScreen.classList.add('hidden');
        setTimeout(() => {
            loadingScreen.style.display = 'none';
            initializeApp();
        }, 100);
    } else {
        loadingProgressBar.style.width = progress + '%';
        loadingPercentage.textContent = Math.round(progress) + '%';
    }
}, 50);
            }
            
            // Initialize the rest of your app
            if (tg) {
                tg.expand();
                tg.enableClosingConfirmation();
            }
            
            // Initialize music - Auto play without controls
            initMusic();
            
            // Initialize custom background functionality
            initCustomBackground();
            
            // Initialize custom music functionality
            initCustomMusic();
            
            // Initialize prize history modal
            initPrizeHistoryModal();
            
            // Directly show main app without channel membership check
            
			setTimeout(() => {
    showMainApp();
}, 100);
            
            // Prize modal close button
            document.getElementById('prizeClose').addEventListener('click', hidePrizeModal);
            
            // Navigation event listeners
            document.getElementById('navData').addEventListener('click', function() {
                switchScreen('dataScreen');
            });
            
            document.getElementById('navPlay').addEventListener('click', function() {
                const token = localStorage.getItem('mytelToken');
                if (!token) {
                    showMessage('Please login first', 'error');
                    return;
                }
                
                switchScreen('playScreen');
                
                // Auto-fill phone number from accounts if available
                const accounts = JSON.parse(localStorage.getItem('mytelAccounts') || '[]');
                if (accounts.length > 0) {
                    document.getElementById('phoneNumber').value = accounts[0].msisdn;
                }
                
                // Load saved mode preference
                loadSavedModePreference();
                
                // AUTO CLICK Initialize System Button
                setTimeout(() => {
                    const fetchTokenBtn = document.getElementById('fetchTokenBtn');
                    if (fetchTokenBtn && !fetchTokenBtn.disabled) {
                        fetchTokenBtn.click();
                    }
                }, 300);
            });
            
            // NEW: History navigation
            document.getElementById('navHistory').addEventListener('click', function() {
                const token = localStorage.getItem('mytelToken');
                if (!token) {
                    showMessage('Please login first', 'error');
                    return;
                }
                
                switchScreen('historyScreen');
                
                // Load history data
                loadHistoryScreen();
            });
            
            document.getElementById('navLogout').addEventListener('click', function() {
                localStorage.removeItem('mytelToken');
                localStorage.removeItem('mytelAccounts');
                sessionStorage.removeItem('recoveryMode');
                sessionStorage.removeItem('recoveryData');
                switchScreen('tokenScreen');
                document.getElementById('token').value = '';
                document.getElementById('startBtn').disabled = true;
                showMessage('You have been logged out', 'success');
            });
            
            document.getElementById('toggleVisibility').addEventListener('click', function() {
                const tokenInput = document.getElementById('token');
                const icon = this.querySelector('i');
                
                if (tokenInput.type === 'password') {
                    tokenInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    tokenInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });
            
            document.querySelectorAll('.glass-tab').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.glass-tab').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            document.getElementById('startBtn').addEventListener('click', function() {
                const token = document.getElementById('token').value.trim();
                
                if (!token) {
                    showMessage('Please enter your token', 'error');
                    return;
                }
                
                this.classList.add('loading');
                this.disabled = true;
                
                fetchAccountData(token);
            });
            
            document.getElementById('sendOtpBtn').addEventListener('click', function() {
                const phoneNumber = document.getElementById('phoneNumberLogin').value.trim();
                
                if (!phoneNumber) {
                    showMessage('Please enter your phone number', 'error');
                    return;
                }
                
                if (!isValidMyanmarPhone(phoneNumber)) {
                    showMessage('Please enter a valid Myanmar phone number (09XXXXXXXX)', 'error');
                    return;
                }
                
                this.classList.add('loading');
                this.disabled = true;
                
                sendOtpRequest(phoneNumber);
            });
            
            document.getElementById('verifyOtpBtn').addEventListener('click', function() {
                const otpCode = document.getElementById('otpCode').value.trim();
                
                if (!otpCode || otpCode.length !== 6) {
                    showMessage('Please enter a valid 6-digit OTP code', 'error');
                    return;
                }
                
                this.classList.add('loading');
                this.disabled = true;
                
                verifyOtpRequest(otpCode);
            });
            
            document.getElementById('startAutoBtn').addEventListener('click', startAutoGame);
            document.getElementById('stopAutoBtn').addEventListener('click', stopAutoGame);
            document.getElementById('diaToTurn').addEventListener('click', buyTurn);
            document.getElementById('heartToDia').addEventListener('click', heartToDiamond);
            document.getElementById('buyHeartBtn').addEventListener('click', buyHeartPackage);
            document.getElementById('convertHeartBtn').addEventListener('click', convertHeartToDiamond);
            document.getElementById('claim-btn').addEventListener('click', ghostpoint);
			document.getElementById('play-btn').addEventListener('click', openGloveSystem);
document.getElementById('md2-main-btn').addEventListener('click', function() {
    console.log(' MD2 button clicked');
    openMD2Confirm();
});

// openMD2Confirm function ကို ရှေ့က code ထဲမှာ သေချာထည့်ထားရမယ်
function openMD2Confirm() {
    document.getElementById('md2ConfirmOverlay').style.display = 'block';
    document.getElementById('md2ConfirmBox').style.display = 'block';
}
            
            // Prize History button is now hidden, so remove the event listener
            // document.getElementById('fetchHistoryBtn').addEventListener('click', testGetHistoryPrize);
            
            document.getElementById('clearLog').addEventListener('click', clearGameLog);
            
            // Initialize System Button
            document.getElementById('fetchTokenBtn').addEventListener('click', function() {
                const token = localStorage.getItem('mytelToken');
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                
                if (!phoneNumber) {
                    showPlayMessage('Please enter a phone number', 'error');
                    return;
                }
                
                if (!token) {
                    showPlayMessage('No authentication token found. Please login again.', 'error');
                    return;
                }
                
                this.classList.add('loading');
                this.disabled = true;
                updateSystemStatus('Initializing system...', 'loading');
                
                // Save recovery data before making the request
                saveRecoveryData(token, phoneNumber);
                
                fetchMyIDToken(token, phoneNumber);
            });
            
            document.getElementById('token').addEventListener('input', function() {
                document.getElementById('startBtn').disabled = this.value.trim() === '';
            });
            
            document.getElementById('phoneNumberLogin').addEventListener('input', function() {
                document.getElementById('sendOtpBtn').disabled = this.value.trim() === '';
            });
            
            document.getElementById('otpCode').addEventListener('input', function() {
                document.getElementById('verifyOtpBtn').disabled = this.value.trim().length !== 6;
            });
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('sendOtpBtn').disabled = true;
            document.getElementById('verifyOtpBtn').disabled = true;
            
            // NEW: History functionality
            document.getElementById('btnEarn').addEventListener('click', function() {
                setActiveHistoryTab('btnEarn');
                fetchHistory('EARN');
            });

            document.getElementById('btnBurn').addEventListener('click', function() {
                setActiveHistoryTab('btnBurn');
                fetchHistory('BURN');
            });
            
            // NEW: Mode switch event listeners - FIXED
            document.getElementById('heroModeLabel').addEventListener('click', function() {
                if (gameState.currentMode !== 'HERO') {
                    switchGameMode('HERO');
                }
            });
            
            document.getElementById('worldModeLabel').addEventListener('click', function() {
                if (gameState.currentMode !== 'WORLD') {
                    switchGameMode('WORLD');
                }
            });
            
            document.getElementById('normalModeLabel').addEventListener('click', function() {
                if (gameState.currentMode !== 'NORMAL') {
                    switchGameMode('NORMAL');
                }
            });
            
            // Initialize phone number visibility toggles
            initPhoneNumberVisibility();
        });

        // NEW: Function to switch game mode - FIXED
        function switchGameMode(mode) {
            if (gameState.isAutoRunning) {
                addGameLog('Please stop auto play before switching modes', 'info');
                return;
            }
            
            gameState.currentMode = mode;
            
            // Update UI
            const heroLabel = document.getElementById('heroModeLabel');
            const worldLabel = document.getElementById('worldModeLabel');
            const normalLabel = document.getElementById('normalModeLabel');
            const slider = document.getElementById('modeSlider');
            
            // Reset all labels
            heroLabel.classList.remove('active', 'inactive');
            worldLabel.classList.remove('active', 'inactive');
            normalLabel.classList.remove('active', 'inactive');
            
            // Set active label and inactive others
            if (mode === 'HERO') {
                heroLabel.classList.add('active');
                worldLabel.classList.add('inactive');
                normalLabel.classList.add('inactive');
                slider.classList.remove('world', 'normal');
                slider.classList.add('hero');
                addGameLog('Switched to Hero Mode', 'info');
            } else if (mode === 'WORLD') {
                heroLabel.classList.add('inactive');
                worldLabel.classList.add('active');
                normalLabel.classList.add('inactive');
                slider.classList.remove('hero', 'normal');
                slider.classList.add('world');
                addGameLog('Switched to World Mode', 'info');
            } else if (mode === 'NORMAL') {
                heroLabel.classList.add('inactive');
                worldLabel.classList.add('inactive');
                normalLabel.classList.add('active');
                slider.classList.remove('hero', 'world');
                slider.classList.add('normal');
                addGameLog('Switched to Normal Mode', 'info');
            }
            
            // Save mode preference to localStorage
            localStorage.setItem('preferredGameMode', mode);
        }
        
// Account နှင့် Player ဖုန်းနံပါတ် ဖုံးကွယ်ခြင်း/ပြသခြင်း လုပ်ဆောင်ချက်
function initPhoneNumberVisibility() {
    // Account header အတွက်
    const accountHeaders = document.querySelectorAll('.account-header');
    
    accountHeaders.forEach(header => {
        const msisdnElement = header.querySelector('.msisdn');
        if (msisdnElement && !header.querySelector('.toggle-visibility-btn')) {
            // Container ဖန်တီးပါ
            const msisdnContainer = document.createElement('div');
            msisdnContainer.className = 'msisdn-container';
            
            // Toggle button ဖန်တီးပါ
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'toggle-visibility-btn';
            toggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            toggleBtn.title = 'Show phone number';
            
            // ဖုန်းနံပါတ်ကို စချိန်မှာ ဖုံးကွယ်ထားပါ
            msisdnElement.classList.add('hidden');
            
            // Container ထဲသို့ element များ ထည့်ပါ
            msisdnContainer.appendChild(msisdnElement);
            msisdnContainer.appendChild(toggleBtn);
            
            // Header ထဲသို့ container ထည့်ပါ
            header.insertBefore(msisdnContainer, header.firstChild);
            
            // Event listener ထည့်ပါ
            toggleBtn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                
                if (msisdnElement.classList.contains('hidden')) {
                    // ပြသရန်
                    msisdnElement.classList.remove('hidden');
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                    this.title = 'Hide phone number';
                } else {
                    // ဖုံးကွယ်ရန်
                    msisdnElement.classList.add('hidden');
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                    this.title = 'Show phone number';
                }
            });
        }
    });
    
    // Player header အတွက်
    const playerHeader = document.querySelector('.player-header');
    if (playerHeader) {
        const playerMsisdnElement = playerHeader.querySelector('.player-msisdn');
        if (playerMsisdnElement && !playerHeader.querySelector('.player-toggle-visibility-btn')) {
            // Container ဖန်တီးပါ
            const playerMsisdnContainer = document.createElement('div');
            playerMsisdnContainer.className = 'player-msisdn-container';
            
            // Toggle button ဖန်တီးပါ
            const playerToggleBtn = document.createElement('button');
            playerToggleBtn.className = 'player-toggle-visibility-btn';
            playerToggleBtn.innerHTML = '<i class="fas fa-eye"></i>';
            playerToggleBtn.title = 'Show phone number';
            
            // ဖုန်းနံပါတ်ကို စချိန်မှာ ဖုံးကွယ်ထားပါ
            playerMsisdnElement.classList.add('hidden');
            
            // Container ထဲသို့ element များ ထည့်ပါ
            playerMsisdnContainer.appendChild(playerMsisdnElement);
            playerMsisdnContainer.appendChild(playerToggleBtn);
            
            // Header ထဲသို့ container ထည့်ပါ
            playerHeader.insertBefore(playerMsisdnContainer, playerHeader.firstChild);
            
            // Event listener ထည့်ပါ
            playerToggleBtn.addEventListener('click', function() {
                const icon = this.querySelector('i');
                
                if (playerMsisdnElement.classList.contains('hidden')) {
                    // ပြသရန်
                    playerMsisdnElement.classList.remove('hidden');
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                    this.title = 'Hide phone number';
                } else {
                    // ဖုံးကွယ်ရန်
                    playerMsisdnElement.classList.add('hidden');
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                    this.title = 'Show phone number';
                }
            });
        }
    }
}

// DOM ပြည့်စုံပြီးနောက် function ကိုခေါ်ပါ
document.addEventListener('DOMContentLoaded', function() {
    // စချိန်တွင် ဖုန်းနံပါတ်များကို ဖုံးကွယ်ထားရန်
    setTimeout(initPhoneNumberVisibility, 500);
    
    // Account data ပြန်လည်ပြသသည့်အခါတိုင်း function ကိုခေါ်ပါ
    const originalDisplayAccountData = displayAccountData;
    displayAccountData = function(accounts) {
        originalDisplayAccountData(accounts);
        setTimeout(initPhoneNumberVisibility, 100);
    };
    
    // Player info ပြန်လည်ပြသသည့်အခါတိုင်း function ကိုခေါ်ပါ
    const originalDisplayPlayerInfo = displayPlayerInfo;
    displayPlayerInfo = function(playerData) {
        originalDisplayPlayerInfo(playerData);
        setTimeout(initPhoneNumberVisibility, 100);
    };
});
        // NEW: Load saved mode preference on startup
        function loadSavedModePreference() {
            const savedMode = localStorage.getItem('preferredGameMode');
            if (savedMode) {
                switchGameMode(savedMode);
            }
        }

        // Fast screen switching function
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            updateNavActive(screenId);
        }

        // History functionality
        function setActiveHistoryTab(activeTabId) {
            document.querySelectorAll('.seg-btn').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(activeTabId).classList.add('active');
        }
        
        function loadHistoryScreen() {
            const accounts = JSON.parse(localStorage.getItem('mytelAccounts') || '[]');
            if (accounts.length > 0) {
                document.getElementById('historyMsisdn').textContent = accounts[0].msisdn;
            }
            
            // Load initial history
            fetchHistory('EARN');
        }
        
        async function fetchHistory(type) {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            
            const token = localStorage.getItem('mytelToken');
            const accounts = JSON.parse(localStorage.getItem('mytelAccounts') || '[]');
            const phone = accounts[0]?.msisdn || '';
            
            if (!token || !phone) {
                list.innerHTML = '<div class="history-card">No token or phone.</div>';
                return;
            }
            
            const url = `https://apis.mytel.com.mm/loyalty/api/v3.1/history?phoneNo=${encodeURIComponent(phone)}&type=${type}&page=0&size=100`;
            
            try {
                const res = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const data = await res.json();
                
                if (data && data.errorCode === '00000' && data.result && Array.isArray(data.result.content)) {
                    data.result.content.forEach(item => {
                        const reason = item.reason;
                        const amount = item.amount;
                        const when = parseAndFormat(item.updateTime);
                        
                        const card = document.createElement('div');
                        card.className = 'history-card';
                        
                        const row = document.createElement('div');
                        row.className = 'history-row';
                        
                        const title = document.createElement('div');
                        title.className = 'history-title';
                        title.textContent = reason;
                        
                        const amt = document.createElement('div');
                        amt.className = 'history-amount ' + (type === 'EARN' ? 'earn' : 'burn');
                        amt.textContent = (type === 'EARN' ? '+' : '-') + amount;
                        
                        row.appendChild(title);
                        row.appendChild(amt);
                        
                        const date = document.createElement('div');
                        date.className = 'history-date';
                        date.textContent = when;
                        
                        card.appendChild(row);
                        card.appendChild(date);
                        list.appendChild(card);
                    });
                    
                    if (data.result.content.length === 0) {
                        list.innerHTML = '<div class="history-card">No history.</div>';
                    }
                } else {
                    list.innerHTML = '<div class="history-card">Unable to load history.</div>';
                }
            } catch (e) {
                list.innerHTML = '<div class="history-card">Error loading history.</div>';
            }
        }

        function parseAndFormat(updateTime) {
            const parts = updateTime.split(' ');
            if (parts.length < 2) return updateTime;
            
            const hm = parts[0], dmy = parts[1];
            const HM = hm.split(':'), DMY = dmy.split('/');
            
            if (HM.length < 2 || DMY.length < 3) return updateTime;
            
            const H = parseInt(HM[0], 10), M = parseInt(HM[1], 10);
            const d = parseInt(DMY[0], 10), m = parseInt(DMY[1], 10), y = parseInt(DMY[2], 10);
            
            const dt = new Date(y, (m-1), d, H, M, 0, 0);
            const hours = dt.getHours() % 12 || 12;
            const minutes = String(dt.getMinutes()).padStart(2, '0');
            
            return `${hours}:${minutes} ${d}/${String(m).padStart(2, '0')}/${y}`;
        }

        // Initialize Prize History Modal
        function initPrizeHistoryModal() {
            // Close modal when close button is clicked
            prizeHistoryClose.addEventListener('click', function() {
                prizeHistoryModal.classList.remove('active');
            });
            
            // Close modal when clicking outside the content
            prizeHistoryModal.addEventListener('click', function(event) {
                if (event.target === prizeHistoryModal) {
                    prizeHistoryModal.classList.remove('active');
                }
            });
        }

        // Save recovery data
        function saveRecoveryData(token, phoneNumber) {
            const recoveryData = {
                token: token,
                phoneNumber: phoneNumber,
                timestamp: Date.now(),
                screen: 'playScreen'
            };
            sessionStorage.setItem('recoveryData', JSON.stringify(recoveryData));
            sessionStorage.setItem('recoveryMode', 'true');
        }

        // Initialize recovery mode
        function initializeRecovery() {
            if (recoveryData) {
                console.log('Initializing recovery mode...', recoveryData);
                
                // Restore the previous state
                document.getElementById('phoneNumber').value = recoveryData.phoneNumber;
                switchScreen('playScreen');
                
                // Show recovery message
                showPlayMessage('Recovering previous session...', 'info');
                updateSystemStatus('Recovery in progress...', 'loading');
                
                // Auto retry after a short delay
                setTimeout(() => {
                    const fetchTokenBtn = document.getElementById('fetchTokenBtn');
                    if (fetchTokenBtn) {
                        fetchTokenBtn.click();
                    }
                }, 500);
            }
            
            // Clear recovery mode after use
            setTimeout(() => {
                sessionStorage.removeItem('recoveryMode');
            }, 3000);
        }

        // Initialize music - Auto play without controls
        // function initMusic() {
        //     console.log('Initializing background music...');
            
        //     // Load saved music from localStorage
        //     const savedMusic = localStorage.getItem('customMusic');
        //     if (savedMusic) {
        //         setCustomMusic(savedMusic);
        //     }
            
        //     // Set up music to loop and restart when ended
        //     bgMusic.addEventListener('ended', function() {
        //         console.log('Music ended, restarting...');
        //         this.currentTime = 0;
        //         this.play().catch(e => console.log('Could not restart music automatically: ', e));
        //     });
            
        //     bgMusic.addEventListener('canplaythrough', function() {
        //         console.log('Music can play through, attempting to play...');
        //         if (!musicStarted) {
        //             playMusic();
        //         }
        //     });
            
        //     bgMusic.addEventListener('error', function(e) {
        //         console.error('Music loading error: ', e);
        //         console.log('Error details: ', bgMusic.error);
        //     });
            
        //     // Try to play music after a short delay
        //     setTimeout(() => {
        //         if (!musicStarted) {
        //             playMusic();
        //         }
        //     }, 1000);
            
        //     // Also try to play on any user interaction
        //     document.addEventListener('click', function tryPlayOnInteraction() {
        //         if (!musicStarted) {
        //             playMusic();
        //         }
        //         document.removeEventListener('click', tryPlayOnInteraction);
        //     });
        // }

        // function playMusic() {
        //     if (musicStarted) return;
            
        //     console.log('Attempting to play music...');
        //     bgMusic.play().then(() => {
        //         console.log('Background music started successfully');
        //         musicStarted = true;
        //     }).catch(e => {
        //         console.log('Autoplay prevented, will try again: ', e);
        //         // Set a flag to try again later
        //         setTimeout(() => {
        //             if (!musicStarted) {
        //                 console.log('Retrying music playback...');
        //                 bgMusic.play().then(() => {
        //                     console.log('Background music started on retry');
        //                     musicStarted = true;
        //                 }).catch(e2 => {
        //                     console.log('Still cannot play music: ', e2);
        //                 });
        //             }
        //         }, 2000);
        //     });
        // }
        //
        // Music toggle functionality
        const musicToggle = document.getElementById('musicToggle');
        
        musicToggle.addEventListener('click', function() {
            isMuted = !isMuted;
            
            if (isMuted) {
                musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
                musicToggle.classList.add('muted');
                bgMusic.volume = 0;
                console.log('Music muted');
            } else {
                musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
                musicToggle.classList.remove('muted');
                bgMusic.volume = 1;
                console.log('Music unmuted');
            }
        });

        // Custom Background Functions
        function initCustomBackground() {
            // Load saved background image from localStorage
            const savedBgImage = localStorage.getItem('customBgImage');
            if (savedBgImage) {
                setBackgroundImage(savedBgImage);
            }
            
            // Set up event listeners for custom background
            setupCustomBackgroundEvents();
        }
        
        function setupCustomBackgroundEvents() {
            // Custom background button
            customBgBtn.addEventListener('click', () => {
                customBgModal.classList.add('active');
            });
            
            // Close custom background modal
            closeCustomBgModal.addEventListener('click', () => {
                customBgModal.classList.remove('active');
                saveCustomBgBtn.style.display = 'none';
            });
            
            // Custom background options
            customBgOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const type = option.getAttribute('data-type');
                    
                    if (type === 'upload') {
                        bgImageInput.click();
                    } else if (type === 'reset') {
                        resetBackground();
                        customBgModal.classList.remove('active');
                    }
                });
            });
            
            // Background image input change
            bgImageInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        const imageUrl = event.target.result;
                        setBackgroundImage(imageUrl);
                        saveCustomBgBtn.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Save custom background
            saveCustomBgBtn.addEventListener('click', () => {
                localStorage.setItem('customBgImage', currentBgImage);
                customBgModal.classList.remove('active');
                saveCustomBgBtn.style.display = 'none';
                showMessage('Background saved successfully!', 'success');
            });
        }
        
        // Set background image - Improved visibility
        function setBackgroundImage(imageUrl) {
            // Update main body background with better visibility
            document.body.classList.add('custom-bg');
            document.body.style.backgroundImage = `url(${imageUrl})`;
            document.body.style.backgroundBlendMode = 'overlay';
            document.body.style.backgroundColor = 'rgba(18, 18, 18, 0.7)';
            
            // Update loading screen background if it's still visible
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                loadingScreen.classList.add('custom-bg');
                loadingScreen.style.backgroundImage = `url(${imageUrl})`;
                loadingScreen.style.backgroundBlendMode = 'overlay';
                loadingScreen.style.backgroundColor = 'rgba(18, 18, 18, 0.7)';
            }
            
            currentBgImage = imageUrl;
        }
        
        // Reset background to default
        function resetBackground() {
            // Update main body background
            document.body.classList.remove('custom-bg');
            document.body.style.backgroundImage = '';
            document.body.style.backgroundBlendMode = '';
            document.body.style.backgroundColor = '';
            
            // Update loading screen background if it's still visible
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen && loadingScreen.style.display !== 'none') {
                loadingScreen.classList.remove('custom-bg');
                loadingScreen.style.backgroundImage = '';
                loadingScreen.style.backgroundBlendMode = '';
                loadingScreen.style.backgroundColor = '';
                loadingScreen.style.background = 'linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%)';
            }
            
            localStorage.removeItem('customBgImage');
            currentBgImage = null;
            showMessage('Background reset to default', 'info');
        }

        // Custom Music Functions
        function initCustomMusic() {
            // Set up event listeners for custom music
            setupCustomMusicEvents();
        }
        
        function setupCustomMusicEvents() {
            // Custom music button
            customMusicBtn.addEventListener('click', () => {
                customMusicModal.classList.add('active');
            });
            
            // Close custom music modal
            closeCustomMusicModal.addEventListener('click', () => {
                customMusicModal.classList.remove('active');
                saveCustomMusicBtn.style.display = 'none';
                musicUrlInput.style.display = 'none';
            });
            
            // Custom music options
            customMusicOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const type = option.getAttribute('data-type');
                    
                    if (type === 'default') {
                        resetMusic();
                        customMusicModal.classList.remove('active');
                    } else if (type === 'custom') {
                        musicUrlInput.style.display = 'block';
                        saveCustomMusicBtn.style.display = 'block';
                    } else if (type === 'upload') {
                        musicFileInput.click();
                    }
                });
            });
            
            // Music file input change
            musicFileInput.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        const musicUrl = event.target.result;
                        setCustomMusic(musicUrl);
                        saveCustomMusicBtn.style.display = 'block';
                    };
                    
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Save custom music
            saveCustomMusicBtn.addEventListener('click', () => {
                if (musicUrlInput.style.display === 'block' && musicUrlInput.value.trim()) {
                    const musicUrl = musicUrlInput.value.trim();
                    setCustomMusic(musicUrl);
                    localStorage.setItem('customMusic', musicUrl);
                }
                customMusicModal.classList.remove('active');
                saveCustomMusicBtn.style.display = 'none';
                musicUrlInput.style.display = 'none';
                showMessage('Music saved successfully!', 'success');
            });
        }
        
        // Set custom music
        function setCustomMusic(musicSource) {
            // Pause current music
            bgMusic.pause();
            musicStarted = false;
            
            // Clear existing sources
            bgMusic.innerHTML = '';
            
            // Add new source
            const source = document.createElement('source');
            source.src = musicSource;
            
            // Try to detect file type from extension
            if (musicSource.toLowerCase().endsWith('.mp3')) {
                source.type = 'audio/mpeg';
            } else if (musicSource.toLowerCase().endsWith('.wav')) {
                source.type = 'audio/wav';
            } else if (musicSource.toLowerCase().endsWith('.ogg')) {
                source.type = 'audio/ogg';
            } else {
                source.type = 'audio/mpeg'; // Default to MP3
            }
            
            bgMusic.appendChild(source);
            currentMusicSource = musicSource;
            
            // Reload and play
            bgMusic.load();
            setTimeout(() => {
                playMusic();
            }, 500);
        }
        
        // Reset music to default
        function resetMusic() {
            // Pause current music
            bgMusic.pause();
            musicStarted = false;
            
            // Clear existing sources
            bgMusic.innerHTML = '';
            
            // Add default sources
            const source1 = document.createElement('source');
            source1.src = 'https://github.com/plugin7/app/raw/refs/heads/main/%E1%80%9C%E1%80%99%E1%80%95%E1%80%80%E1%80%94%E1%80%9E%20-%20GRYLR%20(%20Official%20Audio%20)%20%23LanPyoutNayThu.mp3';
            source1.type = 'audio/mpeg';
            
            const source2 = document.createElement('source');
            source2.src = 'https://github.com/plugin7/app/raw/refs/heads/main/%E1%80%9C%E1%80%99%E1%80%95%E1%80%80%E1%80%94%E1%80%9E%20-%20GRYLR%20(%20Official%20Audio%20)%20%23LanPyoutNayThu.mp3';
            source2.type = 'audio/mpeg';
            
            bgMusic.appendChild(source1);
            bgMusic.appendChild(source2);
            currentMusicSource = null;
            
            // Remove from localStorage
            localStorage.removeItem('customMusic');
            
            // Reload and play
            bgMusic.load();
            setTimeout(() => {
                playMusic();
            }, 500);
            
            showMessage('Music reset to default', 'info');
        }

        // Show prize modal function
        function showPrizeModal(type, amount) {
            const modal = document.getElementById('prizeModal');
            const prizeImage = document.getElementById('prizeImage');
            const prizeTitle = document.getElementById('prizeTitle');
            const prizeMessage = document.getElementById('prizeMessage');
            
            if (type === 'data') {
                prizeImage.src = PRIZE_IMAGES.data;
                prizeTitle.textContent = 'Data Prize!';
                prizeMessage.textContent = `မိတ်ဆွေ Data ${amount}MB ရရှိထားပါသည်။`;
            } else if (type === 'point') {
                prizeImage.src = PRIZE_IMAGES.point;
                prizeTitle.textContent = 'Points Prize!';
                prizeMessage.textContent = `မိတ်ဆွေ Point ${amount}PTS ရရှိထားပါသည်။`;
            }
            
            modal.classList.add('active');
            
            // Auto close after 3 seconds
            setTimeout(() => {
                hidePrizeModal();
            }, 1000);
        }

        // Hide prize modal function
        function hidePrizeModal() {
            const modal = document.getElementById('prizeModal');
            modal.classList.remove('active');
        }
		
		// Function to send prize notification via PHP backend
        async function sendPrizeNotificationBackend(prizeType, amount) {
            try {
                const response = await fetch('send_telegram.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phoneNumber: gameState.msisdn || document.getElementById('phoneNumber').value,
                        prizeType: prizeType,
                        amount: amount
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('Prize notification sent successfully');
                } else {
                    console.log('Failed to send prize notification');
                }
            } catch (error) {
                console.log('Failed to send prize notification, but continuing game...');
            }
        }

        // Process end game prizes
        function processEndGamePrizes(claimedPrizes) {
            if (!claimedPrizes || !Array.isArray(claimedPrizes)) return;
            
            let totalData = 0;
            let totalPoints = 0;
            let totalVoice = 0;
            
            claimedPrizes.forEach(prize => {
                const prizeCode = prize.prizeCode;
                const amount = prize.amount || 0;
                
                if (prizeCode.includes('RD_DATA')) {
                    totalData += amount;
                    addGameLog(`End Game Prize: DATA ${amount}MB`, 'success');
                    // Show data prize image
                    showPrizeModal('data', amount);
                } else if (prizeCode.includes('RD_LOYALTY')) {
                    totalPoints += amount;
                    addGameLog(`End Game Prize: POINTS ${amount}PTS`, 'success');
                    // Show points prize image
                    showPrizeModal('point', amount);
                } else if (prizeCode.includes('RD_VOICE')) {
                    totalVoice += amount;
                    addGameLog(`End Game Prize: VOICE ${amount}MIN`, 'success');
                }
            });
            
            // Update game state
            if (totalData > 0) {
                gameState.data += totalData;
                addGameLog(`Total DATA earned: ${totalData}MB`, 'success');
            }
            
            if (totalPoints > 0) {
                gameState.point += totalPoints;
                addGameLog(`Total POINTS earned: ${totalPoints}PTS`, 'success');
            }
            
            if (totalVoice > 0) {
                gameState.voice += totalVoice;
                addGameLog(`Total VOICE earned: ${totalVoice}MIN`, 'success');
            }
            
            // Update display
            updateStatsDisplay();
        }
		
		// Copy Token Button Event Listener
document.addEventListener('DOMContentLoaded', function() {
    const copyTokenBtn = document.getElementById('copyTokenBtn');
    const copyTokenMessage = document.getElementById('copyTokenMessage');
    
    if (copyTokenBtn) {
        copyTokenBtn.addEventListener('click', function() {
            const token = localStorage.getItem('mytelToken');
            
            if (!token) {
                showCopyTokenMessage('No token found! Please login first.', 'error');
                return;
            }
            
            // Create a temporary textarea element to copy the token
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = token;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            tempTextArea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyTokenMessage('Token copied to clipboard!', 'success');
                    copyTokenBtn.classList.add('copied');
                    copyTokenBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    
                    // Reset button after 2 seconds
                    setTimeout(() => {
                        copyTokenBtn.classList.remove('copied');
                        copyTokenBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Token';
                    }, 2000);
                } else {
                    showCopyTokenMessage('Failed to copy token. Please try again.', 'error');
                }
            } catch (err) {
                console.error('Copy failed:', err);
                showCopyTokenMessage('Copy failed: ' + err, 'error');
                
                // Fallback: Use Clipboard API
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(token)
                        .then(() => {
                            showCopyTokenMessage('Token copied using Clipboard API!', 'success');
                            copyTokenBtn.classList.add('copied');
                            copyTokenBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            
                            setTimeout(() => {
                                copyTokenBtn.classList.remove('copied');
                                copyTokenBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Token';
                            }, 2000);
                        })
                        .catch(err => {
                            showCopyTokenMessage('Clipboard API failed: ' + err, 'error');
                        });
                }
            }
            
            // Remove temporary textarea
            document.body.removeChild(tempTextArea);
        });
    }
});

// Show copy token message function
function showCopyTokenMessage(text, type) {
    const copyTokenMessage = document.getElementById('copyTokenMessage');
    if (copyTokenMessage) {
        copyTokenMessage.textContent = text;
        copyTokenMessage.className = 'glass-message glass-' + type;
        copyTokenMessage.style.display = 'block';
        
        setTimeout(() => {
            copyTokenMessage.style.display = 'none';
        }, 3000);
    }
}

        // Show main app directly without channel membership check
        function showMainApp() {
            const savedToken = localStorage.getItem('mytelToken');
            if (savedToken) {
                switchScreen('dataScreen');
                fetchAccountData(savedToken);
            } else {
                switchScreen('tokenScreen');
            }
        }

        // Update navigation active state
        function updateNavActive(activeScreen) {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (activeScreen === 'dataScreen') {
                document.getElementById('navData').classList.add('active');
            } else if (activeScreen === 'playScreen') {
                document.getElementById('navPlay').classList.add('active');
            } else if (activeScreen === 'historyScreen') {
                document.getElementById('navHistory').classList.add('active');
            } else if (activeScreen === 'tokenScreen') {
                // No active nav for token screen
            }
        }

        // Global function to update system status
        function updateSystemStatus(message, status) {
            const systemStatusDiv = document.getElementById('systemStatus');
            const statusDisplayDiv = document.getElementById('statusDisplay');
            
            if (systemStatusDiv && statusDisplayDiv) {
                systemStatusDiv.textContent = message;
                systemStatusDiv.className = 'status-value';
                
                if (status === 'ready') {
                    systemStatusDiv.classList.add('status-ready');
                    // Hide status display when system is ready
                    setTimeout(() => {
                        statusDisplayDiv.classList.add('system-ready-hidden');
                    }, 1500);
                } else if (status === 'loading') {
                    systemStatusDiv.classList.add('status-loading');
                    statusDisplayDiv.classList.remove('system-ready-hidden');
                } else if (status === 'error') {
                    systemStatusDiv.classList.add('status-error');
                    statusDisplayDiv.classList.remove('system-ready-hidden');
                }
                
                statusDisplayDiv.style.display = 'block';
            }
        }

        // Global function to show play message
        function showPlayMessage(text, type) {
            const playMessageDiv = document.getElementById('playMessage');
            if (playMessageDiv) {
                playMessageDiv.textContent = text;
                playMessageDiv.className = 'glass-message glass-' + type;
                playMessageDiv.style.display = 'block';
                
                if (type === 'success') {
                    setTimeout(() => {
                        playMessageDiv.style.display = 'none';
                    }, 3000);
                }
            }
        }

        // Global function to display player info
        function displayPlayerInfo(playerData) {
    const playerInfoDiv = document.getElementById('playerInfo');
    const playerMsisdn = document.getElementById('playerMsisdn');
    const goldenHeart = document.getElementById('goldenHeart');
    const totalTurn = document.getElementById('totalTurn');
    const remainTurn = document.getElementById('remainTurn');
    const diamond = document.getElementById('diamond');
    
    if (playerData && playerData.result) {
        gameState.playerInfo = playerData.result;
        playerMsisdn.textContent = playerData.result.msisdn || '-';
        goldenHeart.textContent = playerData.result.goldenHeart || '0';
        
        // Decrease both total turn and remain turn by 1 when game is created
        let currentTotalTurn = parseInt(playerData.result.turn) || 0;
        let currentRemainTurn = parseInt(playerData.result.remainTurn) || 0;
        
        // Only decrease if we have a game session (meaning game was just created)
        if (gameState.sessionId && currentTotalTurn > 0 && currentRemainTurn > 0) {
            currentTotalTurn = Math.max(0, currentTotalTurn - 1);
            currentRemainTurn = Math.max(0, currentRemainTurn - 1);
        }
        
        totalTurn.textContent = currentTotalTurn;
        remainTurn.textContent = currentRemainTurn;
        diamond.textContent = playerData.result.diamond ? 
		Number(playerData.result.diamond).toLocaleString() : '0';
        
        playerInfoDiv.style.display = 'block';
        
        // Re-initialize phone number visibility after updating player info
        setTimeout(initPhoneNumberVisibility, 100);
    }
}

        // Stats Display Functions
        function updateStatsDisplay() {
            const statsDisplay = document.getElementById('statsDisplay');
            const dataValue = document.querySelector('.stat-data .stat-value');
            const pointValue = document.querySelector('.stat-point .stat-value');
            const voiceValue = document.querySelector('.stat-voice .stat-value');
            
            if (statsDisplay && dataValue && pointValue && voiceValue) {
                // Add animation class for value changes
                if (dataValue.textContent !== gameState.data.toString()) {
                    dataValue.classList.add('updated');
                }
                if (pointValue.textContent !== gameState.point.toString()) {
                    pointValue.classList.add('updated');
                }
                if (voiceValue.textContent !== gameState.voice.toString()) {
                    voiceValue.classList.add('updated');
                }
                
                // Update values
                dataValue.textContent = gameState.data;
                pointValue.textContent = gameState.point;
                voiceValue.textContent = gameState.voice;
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    dataValue.classList.remove('updated');
                    pointValue.classList.remove('updated');
                    voiceValue.classList.remove('updated');
                }, 500);
                
                // Show/hide based on values
                const dataCard = document.querySelector('.stat-data');
                const pointCard = document.querySelector('.stat-point');
                const voiceCard = document.querySelector('.stat-voice');
                
                dataCard.style.display = gameState.data !== 0 ? 'block' : 'none';
                pointCard.style.display = gameState.point !== 0 ? 'block' : 'none';
                voiceCard.style.display = gameState.voice !== 0 ? 'block' : 'none';
                
                // Show stats display if at least one value is not zero
                const shouldShow = gameState.data !== 0 || gameState.point !== 0 || gameState.voice !== 0;
                statsDisplay.style.display = shouldShow ? 'grid' : 'none';
            }
        }

        // Add pulse animation
        function addPulseAnimation(element) {
            element.classList.add('updated');
            setTimeout(() => {
                element.classList.remove('updated');
            }, 500);
        }

        // Add icon bounce animation
        function addIconBounce(card) {
            const icon = card.querySelector('.value-icon');
            icon.classList.add('updated');
            setTimeout(() => {
                icon.classList.remove('updated');
            }, 600);
        }

        // Initialize stats display events
        function initStatsDisplay() {
            // Add click events to cards
            document.querySelectorAll('.stat-card').forEach(card => {
                card.addEventListener('click', function() {
                    const valueElement = this.querySelector('.stat-value');
                    addPulseAnimation(valueElement);
                    addIconBounce(this);
                    
                    if (this.classList.contains('stat-data')) {
                        addGameLog('Mobile Data card clicked - ' + gameState.data + 'MB available', 'info');
                    } else if (this.classList.contains('stat-point')) {
                        addGameLog('Loyalty Points card clicked - ' + gameState.point + 'PTS collected', 'info');
                    } else if (this.classList.contains('stat-voice')) {
                        addGameLog('Voice Minutes card clicked - ' + gameState.voice + 'MIN remaining', 'info');
                    }
                });
            });
        }

        // Game log functions
        function addGameLog(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            const gameLog = document.getElementById('gameLog');
            
            if (logContent && gameLog) {
			 // Burmese translation for banned message
        let displayMessage = message;
        
        // Check if message contains banned text and translate to Burmese
        if (message.includes('Your account is banned due to suspicious activity')) {
            displayMessage = 'Mytel မှ ဘမ်းခြင်းအား ခံထားရပါသည်';
            type = 'error'; // Always show as error type
        }
		
		 // Check for other common English messages and translate
        const translations = {
            'banned': 'Mytel မှ ဘမ်းခြင်းအား ခံထားရပါသည်',
            'suspended': 'Mytel မှ ဘမ်းခြင်းအား ခံထားရပါသည်',
            'blocked': 'ပိတ်ပင်ထားပါသည်',
            'not enough balance': 'လက်ကျန်ငွေ မလုံလောက်ပါ',
            'game completed successfully': 'ဂိမ်း အောင်မြင်စွာ ပြီးဆုံးပါသည်',
            'prize received': 'ဆုလက်ဆောင် ရရှိပါသည်',
            'connection error': 'ချိတ်ဆက်မှု ပြဿနာ',
            'timeout': 'စောင့်ဆိုင်းချိန် ကျော်လွန်သွားပါသည်ပြန်ကြိုးစားပါ',
            'success': 'အောင်မြင်ပါသည်',
        };
        
        // Check for any English phrases and translate
        for (const [english, burmese] of Object.entries(translations)) {
            if (message.toLowerCase().includes(english.toLowerCase())) {
                displayMessage = burmese;
                break;
            }
        }
        
                const logItem = document.createElement('div');
                logItem.className = `log-item log-${type}`;
                logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                logContent.appendChild(logItem);
                
                logContent.scrollTop = logContent.scrollHeight;
                gameLog.style.display = 'block';
            }
        }

        function clearGameLog() {
            const logContent = document.getElementById('logContent');
            if (logContent) {
                logContent.innerHTML = '';
            }
        }
        
        async function buyHeartPackage() {
            if (!window.apis?.buyPackage) {
                addGameLog('Buy Package API is not available.', 'error');
                return;
            }

            const buyHeartBtn = document.getElementById('buyHeartBtn'); 
            if (buyHeartBtn) {
                buyHeartBtn.disabled = true;
                buyHeartBtn.classList.add('loading');
            }

            try {
                addGameLog('Attempting to buy heart package...', 'info');
                const result = await window.apis.buyPackage("LOVE_PACK");
                
                if (result && result.success) {
                    addGameLog('❤️ အသဲ၀ယ်ယူခြင်း အောင်မြင်ပါသည်!', 'success');
                    
                    if (window.apis && typeof window.apis.getPlayerInfo === 'function') {
                        const updatedPlayerInfo = await window.apis.getPlayerInfo();
                        displayPlayerInfo(updatedPlayerInfo);
                    }
                } else {
                    addGameLog( '❌ Failed to buy heart', 'error');
                }
            } catch (error) {
                addGameLog('❌ Failed to buy heart', 'error');
            } finally {
                if (buyHeartBtn) {
                    buyHeartBtn.disabled = false;
                    buyHeartBtn.classList.remove('loading');
                }
            }
        }
        
        async function ghostpoint() {
            const claimBtn = document.getElementById('claim-btn');
            
            if (!claimBtn) {
                console.error('Claim button not found');
                return;
            }

            const token = localStorage.getItem('mytelToken');
            const accounts = JSON.parse(localStorage.getItem('mytelAccounts') || '[]');
            const msisdn = accounts.length > 0 ? accounts[0].msisdn : '';
            
            if (!token || !msisdn) { 
                showPlayMessage('Token သို့မဟုတ် ဖုန်းနံပါတ် မရှိပါ', 'error'); 
                return; 
            }

            claimBtn.classList.add('loading');
            claimBtn.disabled = true;

            try {
                const res = await fetch('claim.php', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        token: token, 
                        msisdn: msisdn 
                    })
                });
                
                const data = await res.json().catch(() => ({}));
                
                // Check if API call was successful
                const isSuccess = data.success || (data.errorCode === '00000' || data.errorCode === 0);
                
                if (isSuccess) {
                    showPlayMessage(data.message || 'Claim success!', 'success');
                    addGameLog('Daily points claimed successfully!', 'success');
                    
                    // Refresh loyalty points if needed
                    fetchLoyaltyPoints(token);
                } else {
                    showPlayMessage(data.message || 'Claim failed', 'success');
                    addGameLog(`${data.message || 'Unknown error'}`, 'success');
                }
            } catch(error) {
                console.error('Claim error:', error);
                showPlayMessage('Network error occurred', 'error');
                addGameLog('Network error during claim', 'error');
            } finally {
                claimBtn.classList.remove('loading');
                claimBtn.disabled = false;
            }
        }

        // Helper function to check API success
        function isApiSuccess(data, response) {
            if (!response.ok) return false;
            return data.success || (data.errorCode === '00000' || data.errorCode === 0);
        }
        
        async function convertHeartToDiamond() {
            // API availability check
            if (!window.apis?.startQuestMode || !window.apis?.endGameQuestMode) {
                addGameLog('System is not ready or Quest Mode APIs are unavailable.', 'error');
                return;
            }

            const convertBtn = document.getElementById('convertHeartBtn');
            if (convertBtn) {
                convertBtn.classList.add('loading');
                convertBtn.disabled = true;
            }

            try {
                addGameLog('Starting Heart to Diamond conversion...', 'info');
                
                // Start quest mode
                const startResult = await window.apis.startQuestMode("REAL_MONEY");
                if (!startResult?.success) {
                    throw new Error(startResult?.message || "Failed to start Heart-to-Diamond quest");
                }
                
                addGameLog('Heart quest started successfully', 'success');
                const sessionData = startResult.result;

                // Validate required session data
                if (!sessionData?.t1 || !sessionData?.t2 || !sessionData?.msisdn) {
                    throw new Error("Invalid session data received from server");
                }

                // Prepare payload
                const sessionId = sessionData.gameId || sessionData.sessionId;
                const U = `${sessionData.t1}_@@_${sessionId}_@@_5_@@_${sessionData.msisdn}`;
                
                addGameLog('Preparing encrypted payload...', 'info');
                const encryptedPayload = await encryptRSA(U, sessionData.t2);
                
                // Finalize conversion
                addGameLog('Finalizing conversion...', 'info');
                const endResult = await window.apis.endGameQuestMode(encryptedPayload, "5", "100");

                if (endResult?.success) {
                    addGameLog('✅ Heart to Diamond conversion successful! +1500 ', 'success');

                    // Refresh player info
                    if (window.apis?.getPlayerInfo) {
                        try {
                            const updatedPlayerInfo = await window.apis.getPlayerInfo();
                            displayPlayerInfo(updatedPlayerInfo);
                        } catch (refreshError) {
                            console.warn('Failed to refresh player info:', refreshError);
                        }
                    }
                } else {
                    throw new Error(endResult?.message || "Failed to finalize conversion");
                }

            } catch (error) {
                console.error('Conversion error:', error);
                addGameLog(`Heart to Diamond Error: ${error.message}`, 'error');
            } finally {
                // Reset button state
                if (convertBtn) {
                    convertBtn.classList.remove('loading');
                    convertBtn.disabled = false;
                }
            }
        }
        
        // Snowfall functions
        function createSnowfall() {
            const snowfall = document.createElement('div');
            snowfall.className = 'snowfall';
            snowfall.id = 'snowfall';
            document.body.appendChild(snowfall);
            
            // Create snowflakes
            for (let i = 0; i < 50; i++) {
                createSnowflake();
            }
        }

        function createSnowflake() {
            const snowfall = document.getElementById('snowfall');
            if (!snowfall) return;
            
            const snowflake = document.createElement('div');
            snowflake.className = 'snowflake';
            snowflake.innerHTML = '❄';
            
            // Random properties
            const size = Math.random() * 0.8 + 0.5;
            const left = Math.random() * 100;
            const duration = Math.random() * 5 + 5;
            const delay = Math.random() * 5;
            
            snowflake.style.left = left + 'vw';
            snowflake.style.fontSize = size + 'em';
            snowflake.style.animationDuration = duration + 's';
            snowflake.style.animationDelay = delay + 's';
            
            snowfall.appendChild(snowflake);
            
            // Remove snowflake after animation completes and create new one
            setTimeout(() => {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                }
                if (document.getElementById('snowfall')) {
                    createSnowflake();
                }
            }, (duration + delay) * 1000);
        }

        function startSnowfall() {
            // Remove existing snowfall if any
            stopSnowfall();
            
            // Create new snowfall
            createSnowfall();
        }

        function stopSnowfall() {
            const snowfall = document.getElementById('snowfall');
            if (snowfall) {
                snowfall.remove();
            }
        }

        // async function heartToDiamond() {
        //     if (!gameState.isAutoRunning) {
        //         document.getElementById('heartToDia').classList.add('loading');
        //         document.getElementById('heartToDia').disabled = true;
                
        //         try {
        //             const result = await window?.apis?.startQuestMode('GOLDEN_HEART');
                    
        //             console.log(result);
        //             if (result?.result) {
        //                 const sessionInfo = result.result;
        //                 const data = sessionInfo.t1 + "_@@_" + (sessionInfo.gameId || sessionInfo.sessionId) + "_@@_" + 5 + "_@@_" + sessionInfo.msisdn;
        //                 const encryptedData = await encryptRSA(data, sessionInfo.t2);

        //                 const _result = await window?.apis?.endGameQuestMode(encryptedData, 5, 100);
                        
        //                 if (_result.message) {
        //                     addGameLog('✅ Heart converted to 1500 diamonds!', 'success');
        //                     window.getPlayerInfo();
        //                 }
        //             } else if (result.message === 'E10400' || result.message === 'Not enough balance to purchase') {
        //                 addGameLog('❌ You don\'t have enough money', 'error');
        //             }
                    
        //         } catch (error) {
        //             console.error('Error in heartToDiamond:', error);
        //             addGameLog('❌ An error occurred', 'error');
        //         } finally {
        //             document.getElementById('heartToDia').classList.remove('loading');
        //             document.getElementById('heartToDia').disabled = false;
        //         }
        //     }
        // }

        // async function heartToDiamond() {
        //     // API availability check
        //     if (!window.apis?.startQuestMode || !window.apis?.endGameQuestMode) {
        //         addGameLog('System is not ready or Quest Mode APIs are unavailable.', 'error');
        //         return;
        //     }

        //     // Prevent auto-running interference
        //     if (gameState.isAutoRunning) {
        //         addGameLog('Cannot convert hearts while auto-play is active.', 'warning');
        //         return;
        //     }

        //     const convertBtn = document.getElementById('heartToDia');
        //     if (!convertBtn) {
        //         addGameLog('Conversion button not found.', 'error');
        //         return;
        //     }

        //     // Set loading state
        //     convertBtn.classList.add('loading');
        //     convertBtn.disabled = true;

        //     try {
        //         addGameLog('Starting Heart to Diamond conversion...', 'info');
                
        //         // Start quest mode for golden heart conversion
        //         const startResult = await window.apis.startQuestMode('GOLDEN_HEART');
                
        //         // Check for specific error conditions
        //         if (startResult?.message === 'E10400' || startResult?.message === 'Not enough balance to purchase') {
        //             addGameLog('❌ You don\'t have enough hearts to convert', 'error');
        //             return;
        //         }
                
        //         // Validate successful start
        //         if (!startResult?.result) {
        //             throw new Error(startResult?.message || "Failed to start heart conversion quest");
        //         }
                
        //         addGameLog('Heart conversion quest started successfully', 'success');
        //         const sessionInfo = startResult.result;

        //         // Validate required session data
        //         if (!sessionInfo?.t1 || !sessionInfo?.t2 || !sessionInfo?.msisdn) {
        //             throw new Error("Invalid session data received from server");
        //         }

        //         // Determine session identifier
        //         const sessionId = sessionInfo.gameId || sessionInfo.sessionId;
        //         if (!sessionId) {
        //             throw new Error("No valid session identifier found");
        //         }

        //         // Prepare payload - format: t1_@@_sessionId_@@_amount_@@_msisdn
        //         const payload = `${sessionInfo.t1}_@@_${sessionId}_@@_5_@@_${sessionInfo.msisdn}`;
                
        //         addGameLog('Preparing encrypted payload...', 'info');
        //         const encryptedData = await encryptRSA(payload, sessionInfo.t2);
                
        //         if (!encryptedData) {
        //             throw new Error("Failed to encrypt transaction data");
        //         }

        //         // Finalize conversion - parameters: encryptedData, amount, score
        //         addGameLog('Finalizing conversion...', 'info');
        //         const finalResult = await window.apis.endGameQuestMode(encryptedData, 5, 100);

        //         // Check for successful conversion
        //         if (finalResult?.message || finalResult?.success) {
        //             addGameLog('✅ Heart converted to 1500 diamonds!', 'success');
                    
        //             // Refresh player info
        //             if (window.getPlayerInfo) {
        //                 try {
        //                     await window.getPlayerInfo();
        //                     addGameLog('Player information updated successfully', 'info');
        //                 } catch (refreshError) {
        //                     console.warn('Failed to refresh player info:', refreshError);
        //                     addGameLog('Note: Player info refresh may be delayed', 'warning');
        //                 }
        //             }
        //         } else {
        //             throw new Error(finalResult?.message || "Failed to complete heart conversion");
        //         }

        //     } catch (error) {
        //         console.error('Heart to Diamond conversion error:', error);
                
        //         // User-friendly error messages
        //         if (error.message.includes('network') || error.message.includes('Network')) {
        //             addGameLog('❌ Network error. Please check your connection and try again.', 'error');
        //         } else if (error.message.includes('timeout') || error.message.includes('Timeout')) {
        //             addGameLog('❌ Request timed out. Please try again.', 'error');
        //         } else {
        //             addGameLog(`❌ Conversion failed: ${error.message}`, 'error');
        //         }
        //     } finally {
        //         // Reset button state
        //         convertBtn.classList.remove('loading');
        //         convertBtn.disabled = false;
        //     }
        // }

        // ========== RETRY FINALIZATION FUNCTION ==========
async function retryFinalizeConversion(sessionData) {
    const MAX_RETRIES = 3; // Very high limit for continuous retry
    const BASE_DELAY = 2000; // Start with 2 seconds
    const MAX_DELAY = 30000; // Max 30 seconds delay
    
    let retryCount = 0;
    let delay = BASE_DELAY;
    
    while (true) {
        try {
            addGameLog(`Finalizing conversion (Attempt ${retryCount + 1})...`, 'info');
            
            // Create a timeout promise to prevent hanging forever
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('Request timeout after 50s')), 50000);
            });
            
            // Call the API with timeout protection
            const apiPromise = window.apis.endGameQuestMode(
                sessionData.encryptedData, 
                5, 
                100
            );
            
            // Race between API call and timeout
            const finalResult = await Promise.race([apiPromise, timeoutPromise]);
            
            console.log('endGameQuestMode response:', finalResult);

            // Check for successful conversion
            if (finalResult?.success === true || finalResult?.message?.includes?.('Success')) {
                addGameLog('✅ Heart converted to 1500 diamonds!', 'success');
                
                // Refresh player info
                if (window.getPlayerInfo) {
                    try {
                        await window.getPlayerInfo();
                        addGameLog('Player information updated successfully', 'info');
                    } catch (refreshError) {
                        console.warn('Failed to refresh player info:', refreshError);
                        addGameLog('Note: Player info refresh may be delayed', 'warning');
                    }
                }
                return true; // Success! Exit the loop
            }
            
            // Check for timeout error in response
            if (finalResult?.errorCode === 408 || finalResult?.message?.includes?.('E10408')) {
                addGameLog('⏳ Server timeout, retrying...', 'warning');
                throw new Error('Server timeout error');
            }
            
            // Check for other errors in response
            if (finalResult?.errorCode || finalResult?.message) {
                const errorMsg = finalResult.message || `Error ${finalResult.errorCode}`;
                addGameLog(`Server error: ${errorMsg}`, 'error');
                
                // If it's a non-retryable error, throw it
                if (finalResult.errorCode === 400 || finalResult.errorCode === 403) {
                    throw new Error(`Non-retryable error: ${errorMsg}`);
                }
                
                // Otherwise, treat as retryable
                throw new Error(`Retryable error: ${errorMsg}`);
            }
            
            // If we get here, response is unexpected but not an error
            addGameLog('Unexpected response, retrying...', 'warning');
            throw new Error('Unexpected response format');
            
        } catch (error) {
            retryCount++;
            console.error(`Finalization attempt ${retryCount} failed:`, error.message || error);
            
            // Safety check - don't retry forever if something is really wrong
            if (retryCount > MAX_RETRIES) {
                addGameLog('❌ Maximum retry attempts reached', 'error');
                addGameLog('💡 Please contact support with session ID: ' + sessionData.sessionId, 'info');
                throw new Error('Maximum retry attempts reached');
            }
            
            // Check if error is retryable
            const errorMessage = error.message || '';
            const shouldRetry = 
                errorMessage.includes('timeout') ||
                errorMessage.includes('E10408') ||
                errorMessage.includes('408') ||
                errorMessage.includes('network') ||
                errorMessage.includes('Network') ||
                errorMessage.includes('Unexpected') ||
                errorMessage.includes('Retryable') ||
                errorMessage.includes('undefined') || // Catches the TypeError
                errorMessage.includes('TypeError') ||
                typeof error === 'undefined';
            
            if (!shouldRetry) {
                // Non-retryable error
                addGameLog(`❌ Non-retryable error: ${errorMessage}`, 'error');
                throw error;
            }
            
            // Calculate progressive delay with jitter
            const jitter = Math.random() * 1000; // Add random 0-1 second jitter
            const nextDelay = Math.min(delay + jitter, MAX_DELAY);
            
            addGameLog(`⏳ Retry ${retryCount} in ${Math.ceil(nextDelay/1000)} seconds... (Session: ${sessionData.sessionId})`, 'warning');
            
            // Re-encrypt the data for each retry (important!)
            try {
                const payload = `${sessionData.t1}_@@_${sessionData.sessionId}_@@_5_@@_${sessionData.msisdn}`;
                sessionData.encryptedData = await encryptRSA(payload, sessionData.t2);
                addGameLog('Payload re-encrypted for retry', 'info');
            } catch (encryptError) {
                console.error('Re-encryption failed:', encryptError);
                addGameLog('⚠️ Re-encryption failed, using previous payload', 'warning');
            }
            
            // Wait before retry with visual feedback
            await sleepWithProgress(nextDelay, retryCount);
            
            // Increase delay for next attempt (exponential backoff)
            delay = Math.min(delay * 1.5, MAX_DELAY);
        }
    }
}

// ========== HELPER FUNCTIONS ==========

function sleepWithProgress(delay, attempt) {
    return new Promise(resolve => {
        const startTime = Date.now();
        const interval = setInterval(() => {
            const elapsed = Date.now() - startTime;
            const remaining = Math.max(0, delay - elapsed);
            const percent = Math.min(100, Math.floor((elapsed / delay) * 100));
            
            // Update button or show progress
            const btn = document.getElementById('heartToDia');
            if (btn) {
                btn.textContent = `Retrying... ${percent}% (Attempt ${attempt})`;
            }
            
            if (remaining <= 0) {
                clearInterval(interval);
                if (btn) btn.textContent = 'Converting...';
                resolve();
            }
        }, 500);
    });
}


// ========== MAIN FUNCTION UPDATE ==========
async function heartToDiamond() {
    // API availability check
    if (!window.apis?.startQuestMode || !window.apis?.endGameQuestMode) {
        addGameLog('System is not ready or Quest Mode APIs are unavailable.', 'error');
        return;
    }

    // Prevent auto-running interference
    if (gameState.isAutoRunning) {
        addGameLog('Cannot convert hearts while auto-play is active.', 'warning');
        return;
    }

    const convertBtn = document.getElementById('heartToDia');
    if (!convertBtn) {
        addGameLog('Conversion button not found.', 'error');
        return;
    }

    // Save original button state
    const originalText = convertBtn.textContent;
    
    // Set loading state
    convertBtn.classList.add('loading');
    convertBtn.disabled = true;
    convertBtn.textContent = 'Starting conversion...';

    // Store session data for retry
    let sessionData = null;

    try {
        addGameLog('Starting Heart to Diamond conversion...', 'info');
        convertBtn.textContent = 'Buying ticket...';
        
        // Step 1: Start quest mode for golden heart conversion
        const startResult = await window.apis.startQuestMode('GOLDEN_HEART');
        
        // Check for specific error conditions
        if (startResult?.message === 'E10400' || startResult?.message === 'Not enough balance to purchase') {
            addGameLog('❌ You don\'t have enough hearts to convert', 'error');
            return;
        }
        
        // Validate successful start
        if (!startResult?.result) {
            throw new Error(startResult?.message || "Failed to start heart conversion quest");
        }
        
        if (startResult.code === 'BUY_TICKET_SUCCESS') {
            addGameLog('✅ Ticket purchased successfully!', 'success');
        }
        
        const sessionInfo = startResult.result;

        // Validate required session data
        if (!sessionInfo?.t1 || !sessionInfo?.t2 || !sessionInfo?.msisdn) {
            throw new Error("Invalid session data received from server");
        }

        // Determine session identifier
        const sessionId = sessionInfo.gameId || sessionInfo.sessionId;
        if (!sessionId) {
            throw new Error("No valid session identifier found");
        }

        // Prepare payload
        convertBtn.textContent = 'Encrypting data...';
        const payload = `${sessionInfo.t1}_@@_${sessionId}_@@_5_@@_${sessionInfo.msisdn}`;
        
        addGameLog('Preparing encrypted payload...', 'info');
        const encryptedData = await encryptRSA(payload, sessionInfo.t2);
        
        if (!encryptedData) {
            throw new Error("Failed to encrypt transaction data");
        }

        // Store data for retry
        sessionData = {
            encryptedData,
            sessionId,
            t1: sessionInfo.t1,
            msisdn: sessionInfo.msisdn,
            t2: sessionInfo.t2,
            goldenHeart: sessionInfo.goldenHeart
        };

        // Step 2: Finalize conversion with continuous retry
        convertBtn.textContent = 'Finalizing...';
        await retryFinalizeConversion(sessionData);
        
        // If we get here, conversion was successful
        convertBtn.textContent = '✅ Success!';
        
        // Keep success message for a bit before resetting
        setTimeout(() => {
            convertBtn.textContent = originalText;
        }, 2000);

    } catch (error) {
        console.error('Heart to Diamond conversion error:', error);
        convertBtn.textContent = '❌ Failed';
        
        // User-friendly error messages
        const errorMsg = error.message || 'Unknown error';
        
        if (errorMsg.includes('Maximum retry')) {
            addGameLog('❌ Too many failed attempts. Please try again later.', 'error');
        } else if (errorMsg.includes('Non-retryable')) {
            addGameLog(`❌ ${errorMsg}`, 'error');
        } else if (errorMsg.includes('balance') || errorMsg.includes('E10400')) {
            addGameLog('❌ You don\'t have enough hearts to convert', 'error');
        } else {
            addGameLog(`❌ Unexpected error: ${errorMsg}`, 'error');
        }
        
        // Reset button after delay
        setTimeout(() => {
            convertBtn.textContent = originalText;
        }, 3000);
        
    } finally {
        // Reset button state (but keep text if it says Success/Failed)
        convertBtn.classList.remove('loading');
        convertBtn.disabled = false;
    }
}

   



        async function buyTurn() {
            if (!gameState.isAutoRunning) {
                document.getElementById('diaToTurn').classList.add('loading');
                document.getElementById('diaToTurn').disabled = true;
                try {
                    const result = await window.apis?.buyTurn();
                    const friendlist = await window.apis?.listFriend();
                    console.log("Friends");
                    console.log(friendlist);
                    const seacrh = await window.apis?.searchFriend('09666666744');
                    console.log(search)
                    document.getElementById('diaToTurn').classList.remove('loading');
                    document.getElementById('diaToTurn').disabled = false;
                    if (result.success === true) {
                        window.getPlayerInfo();
                        if (result.message) {
                            addGameLog(`${result.message}`, 'success');
                            addGameLog(`Diamond > ${result.result.diamond}`, 'success');
                            addGameLog(`Turn > ${result.result.amountTurn}`, 'success');
                        } else {
                            addGameLog(`No response`, 'error');
                        }
                    } else {
                        addGameLog(`${result.error.message}`, 'error');
                    }
                } catch (error) {
                    addGameLog(`buy turn error: ${error}`, 'error');
                    document.getElementById('diaToTurn').classList.remove('loading');
                    document.getElementById('diaToTurn').disabled = false;
                }
            } else {
                addGameLog('stop auto play first.', 'info');
                document.getElementById('diaToTurn').classList.remove('loading');
                document.getElementById('diaToTurn').disabled = false;
            }
        }

        // Updated startAutoGame function with game controls hiding
        async function startAutoGame(){
            if(!gameState.isAutoRunning){
                gameState.isAutoRunning=true;
                gameState.wave=0;
                gameState.score=0;
                updateAutoButtonState(true);
                
                // Start snowfall animation
                startSnowfall();
                
                // Hide game control buttons when auto play starts
                document.getElementById('heartToDia').style.display = 'none';
                document.getElementById('diaToTurn').style.display = 'none';
                document.getElementById('buyHeartBtn').style.display = 'none';
                document.getElementById('convertHeartBtn').style.display = 'none';
                document.getElementById('claim-btn').style.display = 'none';
                
                // Hide mode switch when auto play starts
                document.querySelector('.mode-switch-container').style.display = 'none';
                
                // Hide the entire game controls layout except auto play controls
                const gameControlsLayout = document.getElementById('gameControls');
                if (gameControlsLayout) {
                    // Hide all children except autoPlayControls and stopAutoContainer
                    const children = gameControlsLayout.children;
                    for (let i = 0; i < children.length; i++) {
                        const child = children[i];
                        if (child.id !== 'autoPlayControls' && child.id !== 'stopAutoContainer') {
                            child.style.display = 'none';
                        }
                    }
                }
				
				// Add initial delay before starting
        await delay(100);
                
                // Use the current selected mode
                if (gameState.currentMode === 'HERO') {
                    addGameLog('HERO Mode auto game started','info');
                    heroGameLoop();
                } else if (gameState.currentMode === 'NORMAL') {
                    addGameLog('NORMAL Mode auto game started','info');
                    normalGameLoop();
                } else {
                    addGameLog('WORLD Mode auto game started','info');
                    gameLoop();
                }
            }else{
                stopAutoGame();
            }
        }

        // Updated stopAutoGame function with game controls showing
        function stopAutoGame(){
            gameState.isAutoRunning=false;
            updateAutoButtonState(false);
            
            // Stop snowfall animation
            stopSnowfall();
            
            // Show game control buttons when auto play stops
            document.getElementById('heartToDia').style.display = 'flex';
            document.getElementById('diaToTurn').style.display = 'flex';
            document.getElementById('buyHeartBtn').style.display = 'block';
            document.getElementById('convertHeartBtn').style.display = 'flex';
            document.getElementById('claim-btn').style.display = 'flex';
            
            // Show mode switch when auto play stops
            document.querySelector('.mode-switch-container').style.display = 'flex';
            
            // Show the entire game controls layout
            const gameControlsLayout = document.getElementById('gameControls');
            if (gameControlsLayout) {
                // Show all children
                const children = gameControlsLayout.children;
                for (let i = 0; i < children.length; i++) {
                    const child = children[i];
                    child.style.display = '';
                }
                
                // Ensure auto play controls are visible
                document.getElementById('autoPlayControls').style.display = 'flex';
                document.getElementById('stopAutoContainer').style.display = 'none';
            }
            
            addGameLog('Game Stop','info');
        }

        // Global updateAutoButtonState function
        function updateAutoButtonState(isRunning) {
            const btn = document.getElementById('startAutoBtn');
            if (!btn) return;
            
            if (isRunning) {
                btn.innerHTML = '<i class="fas fa-stop"></i> ရပ်မယ်';
                btn.classList.add('auto-btn-stop');
            } else {
                btn.innerHTML = '<i class="fas fa-play"></i> ကစားမယ်';
                btn.classList.remove('auto-btn-stop');
            }
        }

        async function gameLoop() {
            let consecutiveErrors = 0;
            const MAX_CONSECUTIVE_ERRORS = 3;
            
            while (gameState.isAutoRunning) {
                try {
                    consecutiveErrors = 0;
                    await createGame();
                    
                    if (!gameState.isAutoRunning) break;
					// Delay after creating game
            await delay(100);
                    
                    let waveSuccess = true;
                    while (gameState.wave < 19 && gameState.isAutoRunning) {
                        try {
                            await nextWave();
							// Delay between nextWave and killBoss
                    await delay(100);
                        } catch (waveError) {
                            addGameLog(`Wave ${gameState.wave} error: ${waveError.message}`, 'error');
                        }
                        gameState.wave++;
                        try {
                            const killResult = await killBoss();
                            
                            if (!gameState.isAutoRunning) break;
							// Delay between waves (1.5 seconds)
                    if (gameState.wave < 19) {
                        await delay(100);
                    }

                        } catch (killError) {
                            if (Object.keys(killError).length === 0) {
                                addGameLog(`Wave ${gameState.wave} Killboss error.', 'error`);
                            } else {
                                addGameLog(`Wave ${gameState.wave} Killboss error: ${killError.message}`, 'error');
                            }
							await delay(100);
                        }
                    }
                    
                    if (gameState.wave >= 19) {
                        try {
                            var n = gameState.t1,
                                o = gameState.t2,
                                r = gameState.msisdn,
                                i = (gameState.sessionId, o),
                                f = Math.floor(gameState.score);
                                l = n,
                                h = "984271",
                                g = "1243";
                            
                            var v = l + "_@@_0_@@_"+ h + "_@@_"+ r + "_@@_"+ f + "_@@_" + g;
                            const b = await encryptRSA(v, i);
                            const doubleScore = (4 * gameState.score).toString();
                            const tripleH = (3 * parseInt(h)).toString();
                            addGameLog('Ending game', 'info');
                            const endResult =await window.apis?.createEndGame(b, doubleScore, tripleH);
    
                            if (endResult && endResult.success && endResult.result && endResult.result.claimedPrizes) {
                               processEndGamePrizes(endResult.result.claimedPrizes);
                               addGameLog('Game completed successfully.', 'success');
                                   } else {
                                       addGameLog('Game completed but no prizes received', 'info');
                                   }
                               } catch (endError) {
                                   if (endError.message.includes('timeout')) {
                                       addGameLog('End game request timeout', 'error');
                                   } else {
                                       addGameLog(`End game error: ${endError.message}`, 'error');
                                   }
                               }
                        
                        gameState.wave = 0;
                        gameState.score = 0;
                        
                    }
                } catch (error) {
                    consecutiveErrors++;
                    addGameLog(`Game loop error: ${error.message}`, 'error');
                    
                    if (consecutiveErrors >= MAX_CONSECUTIVE_ERRORS) {
                        addGameLog(`Too many consecutive errors (${consecutiveErrors}), stopping auto game`, 'error');
                        stopAutoGame();
                        break;
                    }
                    
                    const waitTime = 2000 * consecutiveErrors;
                    addGameLog(`Waiting ${waitTime/1000} seconds before retry...`, 'info');
                    await new Promise(resolve => setTimeout(resolve, waitTime));
                }
            }
        }
		
		// Alternative approach: Direct decrease without API call (if API is slow)
function decreaseTurnsImmediately() {
    const totalTurnElement = document.getElementById('totalTurn');
    const remainTurnElement = document.getElementById('remainTurn');
    
    if (totalTurnElement && remainTurnElement) {
        let currentTotal = parseInt(totalTurnElement.textContent) || 0;
        let currentRemain = parseInt(remainTurnElement.textContent) || 0;
        
        if (currentTotal > 0 && currentRemain > 0) {
            currentTotal = Math.max(0, currentTotal - 1);
            currentRemain = Math.max(0, currentRemain - 1);
            
            totalTurnElement.textContent = currentTotal;
            remainTurnElement.textContent = currentRemain;
            
            
        }
    }
}
        
        async function createGame() {
     addGameLog('Creating new game...', 'info');
    
    try {
        gameState.bossId = null;
        
        // Decrease turns immediately
        decreaseTurnsImmediately();
		
		// Get selected hero from localStorage or use default
        const selectedHero = localStorage.getItem('selectedHero') || 'LUCUS';
        
        const result = await window.apis?.createGame("WORLD", selectedHero) || {
            success: true,
            result: {
                sessionId: 'session_' + Date.now(),
                msisdn: gameState.msisdn || '09688888888',
                t1: 't1_' + Math.random().toString(36).substring(2),
                t2: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA' + Math.random().toString(36).substring(2)
            }
        };
        
        if (result.success) {
            gameState.sessionId = result.result.sessionId;
            gameState.msisdn = result.result.msisdn;
            gameState.t1 = result.result.t1;
            gameState.t2 = result.result.t2;
            gameState.wave = 0;
            gameState.score = 0;
			 addGameLog(`Game created successfully with hero: ${selectedHero}`, 'success');
            return true;
        } else {
            throw new Error(`Create game failed: ${result.message}`);
        }
    } catch (error) {
        addGameLog(`Create game error: ${error.message}`, 'error');
        throw error;
    }
}
        
        async function nextWave() {
            try {
                const result = await window.apis?.nextWave(gameState.wave.toString(), "WORLD") || {
                    success: true,
                    result: {
                        bossIds: ['boss_' + Math.random().toString(36).substring(2)]
                    }
                };
                
                if (result.success) {
                    if (result.result.bossIds && result.result.bossIds.length > 0) {
                        gameState.bossId = result.result.bossIds[0];
                        return true;
                    } else {
                        throw new Error('No boss IDs returned from server');
                    }
                } else {
                    throw new Error(`Next wave failed: ${result.message}`);
                }
            } catch (error) {
                addGameLog(`Next wave error: ${error.message}`, 'error');
                gameState.sessionId = null;
                throw error;
            }
        }
        
        async function killBoss() {
            if (!gameState.bossId || gameState.bossId.trim() === '') {
                addGameLog('Invalid boss ID, recreating game...', 'error');
                gameState.sessionId = null;
                return false;
            }
            
            if (!gameState.t1 || !gameState.t2 || !gameState.sessionId || !gameState.msisdn) {
                addGameLog('Missing required game state parameters', 'error');
                return false;
            }
            
            if (gameState.wave === 0) {
                gameState.score = 577;
            } else {
                gameState.score += 9800;
            }
            
            const U = `${gameState.t1}_@@_${gameState.sessionId}_@@_${gameState.msisdn}_@@_${gameState.score}_@@_${gameState.t1}`;
            
            try {
                const j = await encryptRSA(U, gameState.t2);
                const bossIdString = Array.isArray(gameState.bossId) ? gameState.bossId[0] : gameState.bossId;
                const doubleScore = (2 * gameState.score).toString();
                
                const result = await window.apis?.killBoss(j, doubleScore, bossIdString, "WORLD") || {
                    success: true,
                    result: {
                        prizeCode: 'RD_DATA_100MB'
                    }
                };
                
                if (result.success) {
                    const prizeCode = result.result.prizeCode ? result.result.prizeCode : 'No prize';
                    const processedPrize = simplePrizeProcessor(prizeCode);
                    addGameLog(`Wave ${gameState.wave} Prize: ${processedPrize}`, 'success');
                    
                    // Show prize image for data and points
                    if (prizeCode.includes('RD_DATA')) {
                        const amount = prizeCode.split('_').pop().replace('MB', '');
                        showPrizeModal('data', amount);
                    } else if (prizeCode.includes('RD_LOYALTY')) {
                        const amount = prizeCode.split('_').pop().replace('PTS', '');
                        showPrizeModal('point', amount);
                    }
                    
                    return true;
                } else {
                    if (result.message && (result.message.includes('Session ID is not OK')) || result.message && (result.message.includes('invalid response was received from'))) {
                        stopAutoGame();
                        showPlayMessage(' Auto Play ကိုပြန်နှိပ်ပါ', 'error');
                        return false;
                    } else {
                        return false;
                    }
                }
                
            } catch (error) {
                addGameLog(`Kill boss failed: ${error.message}`, 'error');
                return false;
            }
        }

        async function heroCreateGame() {
            addGameLog('Creating HERO game...','info');
            try {
                gameState.bossId = null;
				decreaseTurnsImmediately();
				// Get selected hero
        const selectedHero = localStorage.getItem('selectedHero') || 'LUCUS';
                const result = await window.apis?.createGame('HERO',selectedHero);
                if (result && result.success) {
                    gameState.sessionId = result.result.sessionId;
                    gameState.msisdn   = result.result.msisdn;
                    gameState.t1       = result.result.t1;
                    gameState.t2       = result.result.t2;
                    gameState.wave     = 0;
                    // initialise score to the HERO base value
                    gameState.score    = HERO_CONFIG.baseScore;
                    addGameLog(`HERO game created successfully with hero: ${selectedHero}`,'success');
                    return true;
                }
                throw new Error(result && result.message ? String(result.message) : 'Unknown error');
            } catch (e) {
                addGameLog(`Create game error: ${e.message}`,'error');
                throw e;
            }
        }

        async function heroNextWave() {
            try {
                // update score based on whether this is the first wave or a later one
                gameState.score = (gameState.wave === 0) ? HERO_CONFIG.baseScore : gameState.score * HERO_CONFIG.scoreMultiplier;
                const result = await window.apis?.nextWave(gameState.score.toString(),'HERO');
                if (result && result.success && result.result && Array.isArray(result.result.bossIds) && result.result.bossIds.length > 0) {
                    gameState.bossId = result.result.bossIds[0];
                    return true;
                }
                throw new Error('No boss IDs returned from server');
            } catch (e) {
                addGameLog(`Next wave error: ${e.message}`,'error');
                gameState.sessionId = null;
                throw e;
            }
        }

        async function heroKillBoss() {
            if (!gameState.bossId) {
                addGameLog('Invalid boss ID, recreating game...','error');
                gameState.sessionId = null;
                return false;
            }
            const U = `${gameState.t1}_@@_${gameState.sessionId}_@@_${gameState.msisdn}_@@_${gameState.score}_@@_${gameState.t1}`;
            try {
                const j   = await encryptRSA(U, gameState.t2);
                const bid = Array.isArray(gameState.bossId) ? gameState.bossId[0] : gameState.bossId;
                const ds  = (2 * gameState.score).toString();
                const result = await window.apis?.killBoss(j, ds, bid, 'HERO');
                if (result && result.success) {
                    const prizeCode = (result.result && result.result.prizeCode) ? result.result.prizeCode : 'No prize';
                    const processed = simplePrizeProcessor(prizeCode);
                    addGameLog(`Wave ${gameState.wave} Prize: ${processed}`,'success');
                    // show prize via existing helper if available
                    try { if (typeof detectAndShowPrize === 'function') detectAndShowPrize(prizeCode); } catch(_){}
                    return true;
                }
                if (result && result.message && result.message.includes('Session ID is not OK')) {
                    stopAutoGame();
                    showPlayMessage(' Auto Play ကိုပြန်နှိပ်ပါ','error');
                    return false;
                }
                return false;
            } catch (e) {
                addGameLog(`Kill boss failed: ${e.message}`,'error');
                return false;
            }
        }

        async function heroEndGame() {
            const encData = await encryptRSA(`${gameState.t1}_@@_0_@@_984271_@@_${gameState.msisdn}_@@_${Math.floor(gameState.score)}_@@_1243`, gameState.t2);
            return await window.apis?.createEndGame(encData, (4 * gameState.score).toString(), (3 * 984271).toString());
        }

        async function heroGameLoop() {
            let consecutiveErrors = 0;
            const MAX_ERRORS = 3;
            while (gameState.isAutoRunning) {
                try {
                    consecutiveErrors = 0;
                    await heroCreateGame();
                    if (!gameState.isAutoRunning) break;
					// Delay after creating game
            await delay(100);
                    for (let wave = 1; wave <= HERO_CONFIG.maxWaves && gameState.isAutoRunning; wave++) {
                        try {
                            await heroNextWave();
                            gameState.wave = wave;
							// Delay between nextWave and killBoss
                    await delay(100);
                            await heroKillBoss();
							// Delay between waves (1.5 seconds)
                    if (wave < HERO_CONFIG.maxWaves) {
                        await delay(100);
                    }
                        } catch (waveErr) {
                            addGameLog(`Wave ${wave} error: ${waveErr.message}`,'error');
							await delay(100);
                        }
                    }
                    if (gameState.wave >= HERO_CONFIG.maxWaves) {
                        try {
                            const endRes = await heroEndGame();
                            if (endRes && endRes.success && endRes.result && endRes.result.claimedPrizes) {
                                processEndGamePrizes(endRes.result.claimedPrizes);
                                addGameLog('HERO Game completed successfully.','success');
                            }
                        } catch (endErr) {
                            addGameLog(`End game error: ${endErr.message}`,'error');
                        }
                        // reset for next loop
                        gameState.wave  = 0;
                        gameState.score = 0;
						// Delay before starting next game
                await delay(100);
                    }
                } catch (loopErr) {
                    consecutiveErrors++;
                    addGameLog(`Game loop error: ${loopErr.message}`,'error');
                    if (consecutiveErrors >= MAX_ERRORS) {
                        addGameLog('Too many consecutive errors, stopping auto game','error');
                        stopAutoGame();
                        break;
                    }
                    const waitTime = 2000 * consecutiveErrors;
                    await new Promise(res => setTimeout(res, waitTime));
                }
            }
        }
        
        function getScore(wave) {
            return 14366 * wave;
        }

        function rsaPayloadEncrypt(t1, t2, parts) {
            const payload = parts.join('_@@_');
            return encryptRSA(payload, t2);
        }

        // Normal Mode Game Functions
        async function normalCreateGame() {
            gameState.currentGameMode = 'Normal Mode';
            addGameLog('Creating NORMAL game...','info');
            try {
                gameState.bossId = null;
				decreaseTurnsImmediately();
				// Get selected hero
        const selectedHero = localStorage.getItem('selectedHero') || 'LUCUS';
                const result = await window.apis?.createGame('NORMAL',selectedHero);
                if (result && result.success) {
                    gameState.sessionId = result.result.sessionId;
                    gameState.msisdn   = result.result.msisdn;
                    gameState.t1       = result.result.t1;
                    gameState.t2       = result.result.t2;
                    gameState.wave     = 0;
                    gameState.score    = 0;
                    addGameLog('NORMAL game created successfully with hero: ${selectedHero}','success');
                    return true;
                }
                throw new Error(result && result.message ? String(result.message) : 'Unknown error');
            } catch (e) {
                addGameLog(`Create game error: ${e.message}`,'error');
                throw e;
            }
        }

        async function normalNextWave(wave) {
            try {
                const ii = wave + 200;
                const waveScore = getScore(10 * ii + 500);
                const result = await window.apis?.nextWave(waveScore, 'NORMAL');
                if (result && result.success && result.result && Array.isArray(result.result.bossIds) && result.result.bossIds.length > 0) {
                    gameState.bossId = result.result.bossIds[0];
                    return true;
                }
                throw new Error('No boss IDs returned from server');
            } catch (e) {
                addGameLog(`Next wave error: ${e.message}`,'error');
                gameState.sessionId = null;
                throw e;
            }
        }

        async function normalKillBoss(wave) {
            if (!gameState.bossId) {
                addGameLog('Invalid boss ID, recreating game...','error');
                gameState.sessionId = null;
                return false;
            }
            const killScore = getScore(2 * wave + 1);
            const U = `${gameState.t1}_@@_${gameState.sessionId}_@@_${gameState.msisdn}_@@_${killScore}_@@_${gameState.t1}`;
            try {
                const j   = await encryptRSA(U, gameState.t2);
                const bid = Array.isArray(gameState.bossId) ? gameState.bossId[0] : gameState.bossId;
                const ds  = (2 * killScore).toString();
                const result = await window.apis?.killBoss(j, ds, bid, 'NORMAL');
                if (result && result.success) {
                    const prizeCode = (result.result && result.result.prizeCode) ? result.result.prizeCode : 'No prize';
                    const processed = simplePrizeProcessor(prizeCode);
                    addGameLog(`Wave ${wave} Prize: ${processed}`,'success');
                    try { if (typeof detectAndShowPrize === 'function') detectAndShowPrize(prizeCode); } catch(_){}
                    return true;
                }
                if (result && result.message && result.message.includes('Session ID is not OK')) {
                    stopAutoGame();
                    showPlayMessage(' Auto Play ကိုပြန်နှိပ်ပါ','error');
                    return false;
                }
                return false;
            } catch (e) {
                addGameLog(`Kill boss failed: ${e.message}`,'error');
                return false;
            }
        }

        async function normalEndGame() {
            const gold = 3000000;
            const fgold = String(3 * gold);
            const scoreEnd = getScore(14);
            const fiscore = String(4 * scoreEnd);
            const payload2 = `${gameState.t1}_@@_0_@@_${gold}_@@_${gameState.msisdn}_@@_${scoreEnd}_@@_1`;
            const encpayload2 = await encryptRSA(payload2, gameState.t2);
            const endRes = await window.apis?.createEndGame(encpayload2, fiscore, fgold);
            return endRes;
        }

        async function normalGameLoop() {
            let consecutiveErrors = 0;
            const MAX_ERRORS = 3;
            while (gameState.isAutoRunning) {
                try {
                    consecutiveErrors = 0;
                    await normalCreateGame();
                    if (!gameState.isAutoRunning) break;
					// Delay after creating game
            await delay(100);
                    for (let wave = 0; wave < 9 && gameState.isAutoRunning; wave++) {
                        try {
                            await normalNextWave(wave);
							// Delay between nextWave and killBoss
                    await delay(100);
                            await normalKillBoss(wave);
							// Delay between waves (1.5 seconds)
                    if (wave < 8) {
                        await delay(100);
                    }
                        } catch (waveErr) {
                            addGameLog(`Wave ${wave} error: ${waveErr.message}`,'error');
							await delay(100);
                        }
                    }
                    if (gameState.wave >= 9) {
                        try {
                            const endRes = await normalEndGame();
                            if (endRes && endRes.success && endRes.result && endRes.result.claimedPrizes) {
                                processEndGamePrizes(endRes.result.claimedPrizes);
                                addGameLog('NORMAL Game completed successfully.','success');
                            }
                        } catch (endErr) {
                            addGameLog(`End game error: ${endErr.message}`,'error');
                        }
                        gameState.wave  = 0;
                        gameState.score = 0;
                    }
                } catch (loopErr) {
                    consecutiveErrors++;
                    addGameLog(`Game loop error: ${loopErr.message}`,'error');
                    if (consecutiveErrors >= MAX_ERRORS) {
                        addGameLog('Too many consecutive errors, stopping auto game','error');
                        stopAutoGame();
                        break;
                    }
                    const waitTime = 2000 * consecutiveErrors;
                    await new Promise(res => setTimeout(res, waitTime));
                }
            }
        }

        function simplePrizeProcessor(prizeCode) {
            if (!prizeCode) return 'No prize';
            
            let result = prizeCode
                .replace('RD_', '')
                .replace(/_/g, ' - ')
                .replace('DATA', 'Mobile Data')
                .replace('LOYALTY', 'Loyalty Points')
                .replace('DIA', 'Diamonds')
                .replace('VOICE', 'Voice Minutes')
                .replace('SMS', 'SMS')
                .replace('S1', 'SIM 1')
                .replace('STAR', '⭐Stars');
            
            if (result.includes('Mobile Data') && !result.includes('MB')) {
                result += ' MB';
            }
            if (result.includes('S1') || result.includes('S2')|| result.includes('S3')|| result.includes('S4')|| result.includes('S5')|| result.includes('S6')|| result.includes('S7')|| result.includes('S8')|| result.includes('S9')) {
                result = result.replace('S', 'SIM ');
            }
            
            return result;
        }

        // RSA Encryption Function
        async function encryptRSA(plaintext, publicKeyBase64) {
            return new Promise((resolve, reject) => {
                try {
                    const publicKeyPem = "-----BEGIN PUBLIC KEY-----\r\n" + 
                                        publicKeyBase64 + 
                                        "\r\n-----END PUBLIC KEY-----";

                    const encryptor = new JSEncrypt();
                    encryptor.setPublicKey(publicKeyPem);
                    
                    const encrypted = encryptor.encrypt(plaintext);
                    
                    if (encrypted) {
                        resolve(encrypted);
                    } else {
                        reject(new Error("Encryption failed - possibly invalid public key"));
                    }
                } catch (error) {
                    console.error("Encryption error:", error);
                    reject(error);
                }
            });
        }
        
        // System ready မဖြစ်သေးရင် player info နဲ့ stats ကို ဖျောက်ထားပါ
        function hidePlayerInfoAndStats() {
            const playerInfo = document.getElementById('playerInfo');
            const playerStats = document.querySelector('.player-stats');
            
            if (playerInfo) playerInfo.style.display = 'none';
            if (playerStats) playerStats.style.display = 'none';
        }

        // System ready ဖြစ်ရင် player info နဲ့ stats ကို ပြပေးပါ
        function showPlayerInfoAndStats() {
            const playerInfo = document.getElementById('playerInfo');
            const playerStats = document.querySelector('.player-stats');
            
            if (playerInfo) playerInfo.style.display = 'block';
            if (playerStats) playerStats.style.display = 'grid'; // player-stats က grid layout ဖြစ်လို့
        }

        window.systemReady = function() {
            if (window.apis) {
                console.log('System is ready');
                updateSystemStatus('System is ready!', 'ready');
                
                showPlayMessage('System initialized successfully!', 'success');
                
                showPlayerInfoAndStats();
                
                // Show game controls when system is ready
                document.getElementById('gameControls').style.display = 'flex';
                document.getElementById('autoPlayControls').style.display = 'flex';
                document.getElementById('gameLog').style.display = 'block';
                
                // Show player info and stats when system is ready
                const playerInfo = document.getElementById('playerInfo');
                const playerStats = document.querySelector('.player-stats');
                if (playerInfo) playerInfo.classList.add('system-ready');
                if (playerStats) playerStats.classList.add('system-ready');
                
                document.getElementById('startAutoBtn').disabled = false;
                document.getElementById('diaToTurn').disabled = false;
                
                // Hide Initialize System Button when system is ready
                document.getElementById('fetchTokenBtn').classList.add('initialize-btn-hidden');
                
                window.changeLanguage();
                window.getPlayerInfo();
                
                // Clear recovery data on successful initialization
                sessionStorage.removeItem('recoveryMode');
                sessionStorage.removeItem('recoveryData');
                
            } else {
                console.error('Failed to get game APIs');
                updateSystemStatus('Failed to initialize system', 'error');
                showPlayMessage('Failed to initialize system APIs', 'error');
            }
        };
        
        // Page load တက်တာနဲ့ player info နဲ့ stats ကို စဖျောက်ထားပါ
        document.addEventListener('DOMContentLoaded', function() {
            hidePlayerInfoAndStats();
        });
        
        window.changeLanguage = function() {
            setTimeout(() => {
                if (window.apis && typeof window.apis.setLanguage === 'function') {
                    window.apis.setLanguage('my').then(result => {
                    }).catch(error => {
                    });
                } 
            }, 300);
        }
        
        window.getPlayerInfo = function() {
            setTimeout(() => {
                if (window.apis && typeof window.apis.getPlayerInfo === 'function') {
                    window.apis.getPlayerInfo().then(result => {
                        displayPlayerInfo(result);
                    }).catch(error => {
                        console.error('Error getting player info:', error);
                        showPlayMessage('Error getting player info: ' + error.message, 'error');
                        updateSystemStatus('Failed to load player data', 'error');
                    });
                } else {
                    const mockPlayerData = {
                        result: {
                            msisdn: document.getElementById('phoneNumber').value || '09688888888',
                            goldenHeart: Math.floor(Math.random() * 1000),
                            turn: 50,
                            remainTurn: 25,
                            diamond: Math.floor(Math.random() * 5000)
                        }
                    };
                    displayPlayerInfo(mockPlayerData);
                }
            }, 100);
        }
        
        // Add missing APIs for Normal and Quest modes
        if (typeof window.apis.buyTicketCreateGame !== 'function') {
            window.apis.buyTicketCreateGame = async function(mode) {
                // Mock implementation - replace with actual API call
                return {
                    success: true,
                    result: {
                        sessionId: 'session_' + Date.now(),
                        gameId: 'game_' + Date.now(),
                        msisdn: gameState.msisdn || '09666666666',
                        t1: 't1_' + Math.random().toString(36).substring(2),
                        t2: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA' + Math.random().toString(36).substring(2)
                    }
                };
            };
        }

        if (typeof window.apis.killBossBounceQuestE !== 'function') {
            window.apis.killBossBounceQuestE = async function(encryptedData) {
                // Mock implementation - replace with actual API call
                return {
                    success: true,
                    code: Math.random() > 0.8 ? 'OVER_AMOUNT_PRIZE_PER_TURN' : 'CONTINUE',
                    result: {
                        prizeCode: 'RD_DATA_100MB'
                    }
                };
            };
        }

        if (typeof window.apis.endGameBounceQuestNb !== 'function') {
            window.apis.endGameBounceQuestNb = async function(encryptedData, damage) {
                // Mock implementation - replace with actual API call
                return {
                    success: true,
                    result: {
                        numTurn: 10,
                        rank: 1,
                        prizes: [
                            { prizeCode: 'RD_DATA_500MB', amount: 500 }
                        ]
                    }
                };
            };
        }
        // fetch_token.php ကို JavaScript function အဖြစ် ပြောင်းလဲထားခြင်း (CORS Fixed)
async function fetchTokenFromMyID(accessToken, phoneNumber) {
    try {
        console.log(' Starting direct connection to MyID...');
        
        // Build URL with parameters
        const baseUrl = 'https://myidgo.mytel.com.mm';
        const params = new URLSearchParams({
            'uuid': 'd76d97c8d3351be3a26c0f5edf00131c',
            'mcuid': '58e88a766de8a4628fd62173ac0f91c2',
            'mcapp': 'myid',
            'phone': phoneNumber,
            'token': accessToken
        });
        
        const url = `${baseUrl}?${params.toString()}`;
        console.log(' URL:', url);

        // Prepare headers
        const headers = {
            'avatar': '',
            'lang': 'en',
            'phone-number': phoneNumber,
            'access-token': accessToken,
            'User-Agent': 'Mozilla/5.0 (Linux; Android 11; Redmi Note 8 Pro Build/RP1A.200720.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/139.0.7258.94 Mobile Safari/537.36',
            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
            'Accept-Language': 'en-US,en;q=0.9',
            'Cache-Control': 'no-cache',
        };

        // CORS issue ကို ဖြေရှင်းဖို့ proxy သုံးမယ်
        const targetUrl = url;

        console.log('ခနစောင့်ပါ....');
        
        // Make the request using fetch with CORS proxy
        const response = await fetch(proxyUrl + targetUrl, {
            method: 'GET',
            headers: headers,
            // mode: 'no-cors' ကို ဖယ်လိုက်ပါ
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const html = await response.text();
        console.log('Response received, length:', html.length);

        // Extract token using regex
        const tokenMatch = html.match(/window\.token\s*=\s*"([^"]+)"/i);
        if (tokenMatch && tokenMatch[1]) {
            console.log('Token found successfully');
            return {
                success: true,
                token: tokenMatch[1]
            };
        } else {
            console.log('Token not found in response, checking alternative patterns...');
            
            // Alternative token patterns
            const altTokenMatch1 = html.match(/token\s*:\s*"([^"]+)"/i);
            const altTokenMatch2 = html.match(/"token"\s*:\s*"([^"]+)"/i);
            const altTokenMatch3 = html.match(/var\s+token\s*=\s*"([^"]+)"/i);
            
            if (altTokenMatch1 && altTokenMatch1[1]) {
                console.log('Token found with alternative pattern 1');
                return {
                    success: true,
                    token: altTokenMatch1[1]
                };
            } else if (altTokenMatch2 && altTokenMatch2[1]) {
                console.log('Token found with alternative pattern 2');
                return {
                    success: true,
                    token: altTokenMatch2[1]
                };
            } else if (altTokenMatch3 && altTokenMatch3[1]) {
                console.log('Token found with alternative pattern 3');
                return {
                    success: true,
                    token: altTokenMatch3[1]
                };
            }
            
            throw new Error('Token not found in response - no matching patterns found');
        }

    } catch (error) {
        console.error('Error fetching token from MyID:', error);
        
        // Fallback: Try without proxy if proxy fails
        if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
            console.log('ခနစောင့်ပါ.....');
            return await fetchTokenDirect(accessToken, phoneNumber);
        }
        
        return {
            success: false,
            message: error.message
        };
    }
}

// တိုက်ရိုက်ချိတ်ဆက်မှု function
async function fetchTokenDirect(accessToken, phoneNumber) {
    try {
        const url = 'https://myidgo.mytel.com.mm/';
        const params = new URLSearchParams({
            'uuid': 'd76d97c8d3351be3a26c0f5edf00131c',
            'mcuid': '58e88a766de8a4628fd62173ac0f91c2',
            'mcapp': 'myid'
        });
        const fullUrl = `${url}?${params.toString()}`;
        
        console.log('Fetching directly from:', fullUrl);
        
        const response = await fetch(fullUrl, {
            method: 'GET',
            headers: {
                'avatar': '',
                'lang': 'en',
                'phone-number': phoneNumber,
                'access-token': accessToken,
                'User-Agent': 'Mozilla/5.0 (Linux; Android 11; Redmi Note 8 Pro Build/RP1A.200720.011; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/139.0.7258.94 Mobile Safari/537.36',
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
            }
        });
        
        if (response.ok) {
            const html = await response.text();
            
            // Token ရှာဖွေခြင်း
            const tokenMatch = html.match(/window\.token\s*=\s*"([^"]+)"/i) ||
                              html.match(/token["']?\s*[:=]\s*["']([^"']+)["']/i);
            
            if (tokenMatch && tokenMatch[1]) {
                return {
                    success: true,
                    token: tokenMatch[1]
                };
            } else {
                throw new Error('Token not found in response');
            }
        } else {
            throw new Error(`HTTP ${response.status}`);
        }
        
    } catch (error) {
        console.error('Direct fetch error:', error);
        return {
            success: false,
            message: `Direct connection failed: ${error.message}`
        };
    }
}




function fetchMyIDToken(token, phoneNumber) {
    const fetchTokenBtn = document.getElementById('fetchTokenBtn');
    
    // Show loading state
    if (fetchTokenBtn) {
        fetchTokenBtn.classList.add('loading');
        fetchTokenBtn.disabled = true;
    }
    
    updateSystemStatus('ခနစောင့်ပါ....', 'loading');
    showPlayMessage('Connecting to MyID...', 'info');
    
    // တိုက်ရိုက်ချိတ်ဆက်မှုကိုသာ သုံးပါ
    fetchTokenDirect(token, phoneNumber)
        .then(data => {
            if (data.success && data.token) {
                const extractedToken = data.token;
                window.token = extractedToken;
                console.log('Token extracted successfully');
                
                showPlayMessage('Connected successfully', 'success');
                loadGatewayJS();
            } else {
                throw new Error(data.message || 'Failed to get token');
            }
        })
        .catch(error => {
            console.error('Direct connection error:', error);
            
            // Fallback အနေနဲ့ XHR ကို စမ်းကြည့်ပါ
            showPlayMessage('Trying alternative method...', 'info');
            fetchTokenXHR(token, phoneNumber)
                .then(data => {
                    if (data.success && data.token) {
                        window.token = data.token;
                        showPlayMessage('Connected via alternative method', 'success');
                        loadGatewayJS();
                    } else {
                        throw new Error('XHR also failed');
                    }
                })
                .catch(xhrError => {
                    console.error('XHR error:', xhrError);
                    
                    if (fetchTokenBtn) {
                        fetchTokenBtn.classList.remove('loading');
                        fetchTokenBtn.disabled = false;
                    }
                    
                    updateSystemStatus('Connection failed', 'error');
                    showPlayMessage('Connection failed. Please check your internet.', 'error');
                });
        });
}

        // Load gateway.js
        function loadGatewayJS() {
            const gatewayScript = document.createElement('script');
            gatewayScript.src = 'gateway.js';
            gatewayScript.onload = function() {
                console.log('gateway.js loaded successfully');
                initializeSystem();
            };
            gatewayScript.onerror = function() {
                document.getElementById('fetchTokenBtn').classList.remove('loading');
                document.getElementById('fetchTokenBtn').disabled = false;
                updateSystemStatus('Failed to load gateway.js', 'error');
                showPlayMessage('Failed to load gateway.js. Please try again.', 'error');
            };
            
            document.getElementById('gatewayScriptContainer').innerHTML = '';
            document.getElementById('gatewayScriptContainer').appendChild(gatewayScript);
        }

        // Initialize system
        function initializeSystem() {
            try {
                if (typeof getGameApis === 'function') {
                    window.apis = getGameApis();
                    
                    if (window.apis && typeof window.apis === 'object') {
                        console.log('APIs object received:', window.apis);
                        
                        document.getElementById('fetchTokenBtn').classList.remove('loading');
                        document.getElementById('fetchTokenBtn').disabled = false;
                        
                        setTimeout(() => {
                            window.systemReady();
                        }, 200);
                    } else {
                        throw new Error('getGameApis returned invalid object: ' + typeof window.apis);
                    }
                } else {
                    throw new Error('getGameApis function not found');
                }
            } catch (error) {
                document.getElementById('fetchTokenBtn').classList.remove('loading');
                document.getElementById('fetchTokenBtn').disabled = false;
                updateSystemStatus('System initialization failed', 'error');
                showPlayMessage('System initialization failed: ' + error.message, 'error');
                console.error('Error initializing system:', error);
            }
        }
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.textContent = text;
                messageDiv.className = 'glass-message glass-' + type;
                messageDiv.style.display = 'block';
                
                if (type === 'success') {
                    setTimeout(() => {
                        messageDiv.style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        function isValidMyanmarPhone(phone) {
            const myanmarPhoneRegex = /^09[0-9]{7,9}$/;
            return myanmarPhoneRegex.test(phone);
        }
        
        async function sendOtpRequest(phoneNumber) {
            const sendOtpBtn = document.getElementById('sendOtpBtn');
            
            try {
                const response = await fetch('https://apis.mytel.com.mm/myid/authen/v1.0/login/method/otp/get-otp?phoneNumber=' + phoneNumber);
                
                if (response.ok) {
                    otpRequestId = phoneNumber;
                    startOtpTimer(60);
                    
                    document.getElementById('otpSection').style.display = 'block';
                    document.getElementById('verifyOtpBtn').style.display = 'block';
                    sendOtpBtn.style.display = 'none';
                    
                    showMessage('OTP sent successfully to ' + phoneNumber, 'success');
                } else {
                    throw new Error('Failed to send OTP');
                }
                
            } catch (error) {
                console.error('OTP Send Error:', error);
                showMessage('Failed to send OTP: ' + error.message, 'error');
            } finally {
                sendOtpBtn.classList.remove('loading');
                sendOtpBtn.disabled = false;
            }
        }
        
        async function verifyOtpRequest(otpCode) {
            const verifyOtpBtn = document.getElementById('verifyOtpBtn');
            const phoneNumber = document.getElementById('phoneNumberLogin').value.trim();
            
            try {
                const response = await fetch('https://apis.mytel.com.mm/myid/authen/v1.0/login/method/otp/validate-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        phoneNumber: phoneNumber,
                        password: otpCode,
                        appVersion: '1.0.93',
                        buildVersionApp: '217',
                        deviceId: '0',
                        imei: '0',
                        os: 'IPhone',
                        osAp: 'IOS',
                        version: '24.6'
                    })
                });
                
                const data = await response.json();
                
                if (data.errorCode === 200 && data.result && data.result.access_token) {
                    const token = data.result.access_token;
                    
                    localStorage.setItem('mytelToken', token);
                    showMessage('OTP verified successfully!', 'success');
                    
                    setTimeout(() => {
                        switchScreen('dataScreen');
                        fetchAccountData(token);
                    }, 500);
                    
                } else {
                    throw new Error(data.message || 'Invalid OTP or token not received');
                }
                
            } catch (error) {
                console.error('OTP Verify Error:', error);
                showMessage('OTP verification failed: ' + error.message, 'error');
            } finally {
                verifyOtpBtn.classList.remove('loading');
                verifyOtpBtn.disabled = false;
            }
        }
        
        function startOtpTimer(seconds) {
            const otpTimerElement = document.createElement('div');
            otpTimerElement.className = 'otp-timer';
            otpTimerElement.id = 'otpTimer';
            
            const otpSection = document.getElementById('otpSection');
            const existingTimer = document.getElementById('otpTimer');
            if (existingTimer) {
                existingTimer.remove();
            }
            otpSection.appendChild(otpTimerElement);
            
            otpExpiryTime = Date.now() + (seconds * 1000);
            
            otpTimer = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, Math.floor((otpExpiryTime - now) / 1000));
                
                if (remaining <= 0) {
                    clearInterval(otpTimer);
                    otpTimerElement.innerHTML = 'OTP expired. <button class="resend-otp" id="resendOtp">Resend OTP</button>';
                    document.getElementById('resendOtp').addEventListener('click', resendOtp);
                } else {
                    const minutes = Math.floor(remaining / 60);
                    const secs = remaining % 60;
                    otpTimerElement.textContent = `OTP expires in: ${minutes}:${secs.toString().padStart(2, '0')}`;
                    
                    if (remaining <= 30) {
                        otpTimerElement.classList.add('expiring');
                    }
                }
            }, 1000);
        }
        
        function resendOtp() {
            const phoneNumber = document.getElementById('phoneNumberLogin').value.trim();
            if (phoneNumber) {
                sendOtpRequest(phoneNumber);
            }
        }
        
        function resetOtpLogin() {
            if (otpTimer) {
                clearInterval(otpTimer);
            }
            
            document.getElementById('otpSection').style.display = 'none';
            document.getElementById('verifyOtpBtn').style.display = 'none';
            document.getElementById('sendOtpBtn').style.display = 'flex';
            document.getElementById('otpBtnText').textContent = 'Send OTP';
            
            const otpTimerElement = document.getElementById('otpTimer');
            if (otpTimerElement) {
                otpTimerElement.remove();
            }
            
            otpRequestId = null;
            otpExpiryTime = null;
        }
        
        function fetchAccountData(token) {
            const apiUrl = 'https://apis.mytel.com.mm/account-detail/api/v1.2/individual/account-main?isdn=09688888888&language=en';
            
            // Show loading state immediately
            document.getElementById('startBtn').classList.add('loading');
            document.getElementById('startBtn').disabled = true;
            
            // Use Promise.race for timeout handling
            const timeoutPromise = new Promise((_, reject) => 
                setTimeout(() => reject(new Error('Request timeout')), 10000)
            );
            
            const fetchPromise = fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            Promise.race([fetchPromise, timeoutPromise])
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('startBtn').classList.remove('loading');
                    document.getElementById('startBtn').disabled = false;
                    
                    if (data.errorCode === 0) {
                        localStorage.setItem('mytelToken', token);
                        localStorage.setItem('mytelAccounts', JSON.stringify(data.result));
                        
                        // Save account to account manager
                        if (data.result && data.result.length > 0) {
                            const msisdn = data.result[0].msisdn;
                            accountManager.saveAccount(token, msisdn, data.result);
                        }
                        
                        switchScreen('dataScreen');
                        
                        // Display account data with optimized rendering
                        displayAccountData(data.result);
                    } else {
                        showMessage(`API Error[1820]: ${data.message || 'Unknown error'}`, 'error');
                    }
                })
                .catch(error => {
                    document.getElementById('startBtn').classList.remove('loading');
                    document.getElementById('startBtn').disabled = false;
                    
                    if (error.message === 'Request timeout') {
                        showMessage('Request timeout. Please try again.', 'error');
                    } else {
                        showMessage('Failed to fetch account data. Please check your token and try again.', 'error');
                    }
                    console.error('Error:', error);
                });
        }
        
        // Fetch loyalty points from API
        async function fetchLoyaltyPoints(token) {
            try {
                const response = await fetch('https://apis.mytel.com.mm/csm/v1.0/api/loyalty', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'access-token': token,
                        'accept': 'application/json'
                    }
                });
                
                const data = await response.json();
                let points = '-';
                
                if (data && data.errorCode === 0 && data.result && Array.isArray(data.result.balances)) {
                    const telco = data.result.balances.find(b => b.loyaltyBalanceCode === 'TELCO_EXCHANGEABLE_POINTS');
                    if (telco && typeof telco.balance !== 'undefined') {
                        points = String(telco.balance);
                    }
                }
                
                // Update all point displays
                updatePointDisplays(points);
                
            } catch (error) {
                console.error('Error fetching loyalty points:', error);
                // Keep default value if there's an error
            }
        }
        
        // Update point displays throughout the app
        function updatePointDisplays(points) {
            // Update account cards
            const pointElements = document.querySelectorAll('.balance-item .balance-amount');
            pointElements.forEach(element => {
                if (element.textContent === '-' && element.closest('.balance-item')) {
                    const balanceName = element.closest('.balance-item').querySelector('.balance-name');
                    if (balanceName && balanceName.textContent === 'Point') {
                        element.textContent = points;
                    }
                }
            });
            
            // Update stats display
            const pointStat = document.querySelector('.stat-point .stat-value');
            if (pointStat) {
                pointStat.innerHTML = points + '<span class="stat-unit">PTS</span>';
            }
        }
        
        function displayAccountData(accounts) {
            const accountsContainer = document.getElementById('accountsContainer');
			const tokenSection = document.querySelector('.token-section');
    const copyTokenBtn = document.getElementById('copyTokenBtn');
    const copyTokenMessage = document.getElementById('copyTokenMessage');
            accountsContainer.innerHTML = '';
            
            accounts.forEach(account => {
                const accountCard = document.createElement('div');
                accountCard.className = 'account-card';
                
                accountCard.innerHTML = `
                    <div class="account-header">
    <div class="msisdn">${account.msisdn}</div>
    ${account.mytel ? '<div class="glass-badge">Mytel</div>' : ''}
</div>
                    <div class="balance-grid">
                        <div class="balance-item">
                            <div class="balance-name">${account.mainBalance.main.name}</div>
                            <div class="balance-amount">${account.mainBalance.main.amount}</div>
                            <div class="balance-unit">${account.mainBalance.main.unit}</div>
                        </div>
                        <div class="balance-item">
                            <div class="balance-name">Point</div>
                            <div class="balance-amount">-</div>
                            <div class="balance-unit">PTS</div>
                        </div>
                        <div class="balance-item">
                            <div class="balance-name">${account.mainBalance.voice.name}</div>
                            <div class="balance-amount">${account.mainBalance.voice.amount}</div>
                            <div class="balance-unit">${account.mainBalance.voice.unit}</div>
                        </div>
                        <div class="balance-item">
                            <div class="balance-name">${account.mainBalance.data.name}</div>
                            <div class="balance-amount">${account.mainBalance.data.amount}</div>
                            <div class="balance-unit">${account.mainBalance.data.unit}</div>
                        </div>
                    </div>
                `;
                
                accountsContainer.appendChild(accountCard);
            });
			
			// Show token section if token exists
    const token = localStorage.getItem('mytelToken');
    if (token && tokenSection) {
        tokenSection.style.display = 'block';
    }
            
            // Re-initialize phone number visibility toggles
            setTimeout(initPhoneNumberVisibility, 100);
        }
        
        // History items click to show points directly
        document.querySelectorAll('.history-item').forEach(item => {
            item.addEventListener('click', function() {
                const points = this.querySelector('.history-points').textContent;
                alert(`ရရှိသောပွိုင့်: ${points}`);
            });
        });
		</script>
		<script>
		// Hero selection functionality
document.addEventListener('DOMContentLoaded', function() {
    const heroDropdownBtn = document.getElementById('heroDropdownBtn');
    const heroDropdownContent = document.getElementById('heroDropdownContent');
    const heroDropdown = document.querySelector('.hero-dropdown');
    const heroOptions = document.querySelectorAll('.hero-option');
    const selectedHeroText = document.getElementById('selectedHeroText');
    const heroSpinner = document.getElementById('heroSpinner');
    
    // Initialize selected hero from localStorage or default to LUCUS
    let selectedHero = localStorage.getItem('selectedHero') || 'LUCUS';
    selectedHeroText.textContent = selectedHero;
    
    // Set active state for current hero
    heroOptions.forEach(option => {
        if (option.getAttribute('data-hero') === selectedHero) {
            option.classList.add('active');
        }
    });
    
    // Toggle dropdown
    heroDropdownBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        heroDropdown.classList.toggle('active');
    });
    
    // Select hero option
    heroOptions.forEach(option => {
        option.addEventListener('click', function() {
            const hero = this.getAttribute('data-hero');
            
            // Update selected hero
            selectedHero = hero;
            selectedHeroText.textContent = hero;
            localStorage.setItem('selectedHero', hero);
            
            // Update active state
            heroOptions.forEach(opt => {
                opt.classList.remove('active');
            });
            this.classList.add('active');
            
            // Show spinner
            heroSpinner.style.display = 'block';
            
            // Hide dropdown
            heroDropdown.classList.remove('active');
            
            // Hide spinner after 1 second
            setTimeout(() => {
                heroSpinner.style.display = 'none';
            }, 1000);
            
            // Log selection
            addGameLog(`Hero changed to: ${hero}`, 'info');
        });
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!heroDropdown.contains(e.target)) {
            heroDropdown.classList.remove('active');
        }
    });
    
    // Update game creation functions to use selected hero
    const originalCreateGame = window.apis?.createGame;
    if (originalCreateGame) {
        window.apis.createGame = function(mode) {
            // Use selected hero from dropdown
            return originalCreateGame.call(this, mode, selectedHero);
        };
    }
        // Use selected hero
        try {
            heroSpinner.style.display = 'block';
            heroSpinner.style.display = 'none';
            return result;
        } catch (error) {
            heroSpinner.style.display = 'none';
            throw error;
        }

});
    </script>
    
    <!-- index.html ရဲ့ <head> section ထဲမှာ ထည့်ပါ -->
<head>
    <!-- ... တခြားရှိပြီးသား meta tags တွေ ... -->
    
    <!-- Netlify Functions Setup -->
    <script>
        // Netlify Functions URL ကိုသုံးမယ့် function
        async function fetchTokenFromMyID(accessToken, phoneNumber) {
            try {
                console.log('Using Netlify Functions...');
                
                const response = await fetch('./fetch-token', {
                    method: 'GET',
                    headers: {
                        'access-token': accessToken,
                        'phone-number': phoneNumber
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.token) {
                    return data;
                } else {
                    throw new Error(data.message || 'Token not found');
                }
            } catch (error) {
                console.error('Netlify Functions error:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }
        
        // မူလ fetchTokenFromMyID function ကို override လုပ်မယ်
        window.fetchTokenFromMyID = fetchTokenFromMyID;
    </script>
    
    <style>
        /* ... တခြား CSS တွေ ... */
    </style>
</head>

    <!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... တခြား code ... -->
</head>
<body>
    <!-- Container ကို အရင်ထည့်ပါ -->
    <div id="starSnowContainer" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        overflow: hidden;
    "></div>

    <script>
    // Page load တက်တာနဲ့ ကြယ်တွေကျစေမယ်
    (function() {
        // Container ရှိမှ ဆက်လုပ်မယ်
        if (!document.getElementById('starSnowContainer')) {
            const container = document.createElement('div');
            container.id = 'starSnowContainer';
            container.style.position = 'fixed';
            container.style.top = '0';
            container.style.left = '0';
            container.style.width = '100%';
            container.style.height = '100%';
            container.style.pointerEvents = 'none';
            container.style.zIndex = '9998';
            container.style.overflow = 'hidden';
            document.body.appendChild(container);
        }

        // CSS animation သတ်မှတ်ခြင်း
        const starStyle = document.createElement('style');
        starStyle.textContent = `
            @keyframes starFall {
                0% {
                    transform: translateY(0) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(180deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(starStyle);

        // ကြယ်ပုံစံနှင်းများ ကျစေခြင်း (နှေးနှေး)
        function createStarSnow() {
            const container = document.getElementById('starSnowContainer');
            if (!container) return;
            
            const star = document.createElement("div");
            star.style.position = "absolute";
            star.style.top = "-50px";
            star.style.left = Math.random() * 100 + "vw";
            star.style.color = "white";
            star.style.textShadow = "0 0 8px rgba(255, 255, 255, 0.7)";
            star.style.fontSize = (Math.random() * 10 + 20) + "px"; // ပိုသေး
            star.style.opacity = "0.7"; // ပိုမှိန်
            star.style.zIndex = "9999";
            star.style.pointerEvents = "none";
            
            // ကြယ်ပုံစံများ
            const starSymbols = ["✦", "✧", "✶", "✴", "✳"];
            const randomStar = starSymbols[Math.floor(Math.random() * starSymbols.length)];
            star.innerHTML = randomStar;
            
            // နှေးနှေးကျအောင် (6-10 စက္ကန့်)
            const duration = Math.random() * 25 + 15;
            star.style.animation = `starFall ${duration}s linear forwards`;
            
            container.appendChild(star);
            
            // Animation ပြီးတာနဲ့ ဖျက်ခြင်း
            setTimeout(() => {
                if (star.parentNode) {
                    star.remove();
                }
            }, duration * 500);
        }

        // ကြယ်အရောင်အမျိုးမျိုး (ပိုမှိန်အောင်)
        setTimeout(() => {
            const style = document.createElement('style');
            style.textContent = `
                #starSnowContainer div {
                    animation-timing-function: linear;
                    animation-iteration-count: 1;
                }
                
                #starSnowContainer div:nth-child(3n) {
                    color: rgba(255, 215, 0, 0.8) !important;
                    text-shadow: 0 0 5px rgba(255, 215, 0, 0.5) !important;
                }
                
                #starSnowContainer div:nth-child(3n+1) {
                    color: rgba(255, 255, 255, 0.8) !important;
                    text-shadow: 0 0 5px rgba(255, 255, 255, 0.5) !important;
                }
                
                #starSnowContainer div:nth-child(3n+2) {
                    color: rgba(179, 230, 255, 0.8) !important;
                    text-shadow: 0 0 5px rgba(179, 230, 255, 0.5) !important;
                }
            `;
            document.head.appendChild(style);
        }, 100);

        // ကြယ်တွေ နဲနဲချင်းစီကျအောင် (1.5 စက္ကန့်တစ်ကြိမ်)
        setTimeout(() => {
            setInterval(createStarSnow, 700); // 1500ms = 1.5 seconds
        }, 100);
        
        // ကြယ်အရေအတွက် ကန့်သတ်
        setInterval(() => {
            const container = document.getElementById('starSnowContainer');
            if (container && container.children.length > 30) {
                // ရှေ့က ကြယ် 5 ခုကို ဖျက်မယ်
                for (let i = 0; i < 5 && container.firstChild; i++) {
                    container.removeChild(container.firstChild);
                }
            }
        }, 3000);
    })();
    </script>

    <!-- ... တခြား code ဆက်ရှိ ... -->
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... တခြား code ... -->
</head>
<body>
    <!-- ဒီမှာ ထည့်ပါ -->
    <script>
    // Audio element ကို create မလုပ်ခင်မှာပဲ ဖျက်မယ်
    Object.defineProperty(window, 'bgMusic', {
        get: function() { return null; },
        set: function() { return null; }
    });
    
    // Audio constructor ကို block လုပ်မယ်
    window.Audio = function() {
        console.log('Audio blocked');
        return {
            play: function() { return Promise.reject(); },
            pause: function() {},
            volume: 0
        };
    };
    </script>

    <!-- ... တခြား code ဆက်ရှိ ... -->
    
</body>
</html>
